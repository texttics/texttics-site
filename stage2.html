<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stage 2: Macrostructure Profile</title>

    <link rel="stylesheet" href="https://pyscript.net/releases/2024.9.1/core.css">
    <script type="module" config="pyscript.toml" src="https://pyscript.net/releases/2024.9.1/core.js"></script>

    <link rel="stylesheet" href="styles.css">
    <style>
        /* --- Stage 2 Layout & Typography --- */
        body { background-color: #f8f9fa; color: #212529; }
        .masthead { background: #fff; border-bottom: 1px solid #e9ecef; padding: 1rem 2rem; }
        
        h2.table-title { font-size: 1.2rem; margin-top: 2rem; margin-bottom: 0.5rem; color: #495057; border-left: 4px solid #0d6efd; padding-left: 0.75rem; }
        p.table-desc { font-size: 0.9rem; color: #6c757d; margin-bottom: 1rem; margin-left: 1rem; }

        /* --- Table Base --- */
        table.matrix { width: 100%; border-collapse: collapse; font-size: 0.85rem; background: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 3rem; }
        table.matrix th, table.matrix td { padding: 6px 8px; text-align: center; border: 1px solid #dee2e6; }
        table.matrix thead th { background-color: #f1f3f5; color: #495057; font-weight: 600; position: sticky; top: 0; }
        table.matrix tbody tr:hover { background-color: #f8f9fa; }

        /* --- Interactive Bridge Link --- */
        a.bridge-link { color: #0d6efd; font-family: monospace; text-decoration: none; border-bottom: 1px dashed currentColor; cursor: pointer; }
        a.bridge-link:hover { border-bottom: 1px solid currentColor; font-weight: bold; }

        /* --- Heatmap & Conditional Formatting --- */
        /* Critical Threats (Binary) */
        .cell-critical { background-color: #ffebee !important; color: #c62828; font-weight: bold; }
        .cell-warning  { background-color: #fff3e0 !important; color: #e65100; }
        
        /* Texture Map (Gradient calculated in Python) */
        .texture-cell { color: #000; } /* Always black text for contrast */
        
        /* Statistics Columns */
        .stat-cell { background-color: #f8f9fa; font-family: monospace; font-weight: 600; color: #343a40; }

      /* --- Sparkline / Seismograph Styles --- */
        .sparkline-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr; /* 3 columns */
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .spark-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .spark-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        
        .spark-svg {
            width: 100%;
            height: 60px; /* Compact height */
            display: block;
        }
        
        /* SVG Elements */
        .spark-line { fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .spark-area { stroke: none; opacity: 0.2; }
        .spark-bar  { stroke: none; shape-rendering: crispEdges; }
        .spark-grid { stroke: #e9ecef; stroke-width: 1; stroke-dasharray: 2,2; }
        .spark-axis { stroke: #adb5bd; stroke-width: 1; }
        
    </style>
</head>
<body>
  <header class="masthead">
    <h1 class="app-title">Stage 2</h1>
    <p class="spec">The "Altitude View": Macrostructure Profile</p>
    <p><a href="index.html" title="Go back to the main app">← Back to Stage 1 (Microscope)</a></p>
    <div class="controls">
        <button id="btn-copy-report" type="button" class="app-button" disabled>Copy JSON Report</button>
    </div>
  </header>

<main id="main" style="padding: 0 2rem 4rem 2rem;">
    <div id="loading-status" style="margin: 2rem 0; font-weight: bold;">Loading Stage 2...</div>
    
    <div id="sparkline-output"></div>
    
    <h2 class="table-title">1. Macro-MRI: Density & Integrity Overview</h2>
    <p class="table-desc">High-level scan for structural density, invisible gaps, and threat concentrations.</p>
    <div id="macro-table-output">
        </div>

    <h2 class="table-title">2. Texture-MRI: Content Rhythm & Entropy</h2>
    <p class="table-desc">Forensic fingerprint of content runs (1–15+ graphemes). Detecting machine-generated patterns and hidden payloads.</p>
    <div id="texture-table-output">
        </div>

  </main>
  
  <script type="py" src="stage2.py"></script>
</body>
</html>
