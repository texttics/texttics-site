<!doctype html>
<html>
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.9.1/core.css" />
  <script type="module" src="https://pyscript.net/releases/2024.9.1/core.js"></script>

  <style>
    body { font: 16px/1.4 system-ui, sans-serif; max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    textarea { width: 100%; height: 220px; box-sizing: border-box; }
    
    /* NEW: Changed minmax to 110px to fit 8 cards */
    .stats { display: grid; grid-template-columns: repeat(auto-fit,minmax(110px,1fr)); gap: .8rem; margin-top: 1rem; }
    .card { padding: .8rem 1rem; border: 1px solid #ddd; border-radius: 10px; }

    /* Styles for the formatted output area */
    h2 { margin-top: 2rem; }

    #formatted-output {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 1.5rem;
      row-gap: 0.5rem;
      word-break: break-all;
    }

    .percentile-label {
      font-family: monospace;
      font-size: 0.9rem;
      color: #333;
      padding-top: 1rem; 
    }
    
    .percentile-text-block {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 1rem;
      line-height: 1.6;
      background: #fdfdfd;
      border-bottom: 2px solid #aaa; 
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h1>Word Counter (client-side Python)</h1>
  
  <textarea id="text" py-input="update_all" placeholder="Paste or type here..."></textarea>
  
  <div class="stats" id="stats"></div>

  <h2>Text Dissected by Character Count Decile</h2>
  <div id="formatted-output"></div>

  <script type="py">
from pyscript import document
import string

# Create a set of all punctuation characters for fast checking
PUNCTUATION_SET = set(string.punctuation)

# *** NEW: compute_stats function rewritten for 8 granular counters ***
def compute_stats(t: str):
    # Initialize all our new counters
    total = len(t)
    letters = 0
    numbers = 0
    whitespace = 0 # ' '
    control = 0    # '\n', '\t', '\b' etc.
    punctuation = 0
    emoji = 0
    symbols = 0    # $, +, €, © etc.

    # Loop through the entire text one character at a time
    # The order of these checks is important
    for char in t:
        if char == ' ':
            whitespace += 1
        elif char.isalpha():
            letters += 1
        elif char.isdigit():
            numbers += 1
        elif char.iscntrl(): # This catches \n, \t, \b, etc.
            control += 1
        elif char in PUNCTUATION_SET:
            punctuation += 1
        # This is a simple proxy for most emojis.
        # Unicode is complex, but this catches common ranges.
        elif ord(char) >= 0x1F300: 
            emoji += 1
        # Anything left that isn't one of the above is a symbol
    
    # "Symbols" is what's left over
    symbols = total - (whitespace + letters + numbers + control + punctuation + emoji)

    # Return the new dictionary of 8 stats
    return {
        "Characters (any)": total,
        "Letters": letters,
        "Numbers": numbers,
        "Space (' ')": whitespace,
        "Punctuation": punctuation,
        "Control Chars": control,
        "Emoji": emoji,
        "Symbols": symbols,
    }


# This function remains unchanged.
# Its job is to dissect the text based on NON-WHITESPACE characters,
# which is still the correct and precise logic.
def format_text(t: str):
    if not t.strip():
        return ""

    # --- 1. Get total non-space character count ---
    # We build a list of only the non-space characters
    # 'isspace()' correctly handles ' ', '\n', '\t', etc.
    clean_text = [ch for ch in t if not ch.isspace()]
    total_non_space_chars = len(clean_text)

    if total_non_space_chars == 0:
        return ""

    # --- 2. Define decile cutoffs based on this count ---
    decile_cutoffs = [(total_non_space_chars * (i / 10.0)) for i in range(1, 10)]
    
    labels = [
        "0-10%", "10-20%", "20-30%", "30-40%", "40-50%",
        "50-60%", "60-70%", "70-80%", "80-90%", "90-100%"
    ]
    
    # --- 3. Build HTML by iterating through the *original* text ---
    html_output = ""
    running_non_space_count = 0
    decile_index = 0
    current_text_chunk = []

    html_output += f'<div class="percentile-label">{labels[decile_index]}</div>'
    html_output += f'<div class="percentile-text-block">'
    
    for char in t:
        current_text_chunk.append(char)
        
        # Only count if it's not whitespace
        if not char.isspace():
            running_non_space_count += 1
            
            if decile_index < 9 and running_non_space_count > decile_cutoffs[decile_index]:
                html_output += "".join(current_text_chunk)
                html_output += '</div>'
                decile_index += 1
                html_output += f'<div class="percentile-label">{labels[decile_index]}</div>'
                html_output += f'<div class="percentile-text-block">'
                current_text_chunk = []

    html_output += "".join(current_text_chunk)
    html_output += '</div>'
    
    return html_output


def update_all(event=None):
    t = document.getElementById("text").value
    
    # 1. Update the stats cards
    stats = compute_stats(t)
    stats_html = "".join(f'<div class="card"><strong>{k}</strong><div>{v}</div></div>'
                         for k,v in stats.items())
    document.getElementById("stats").innerHTML = stats_html
    
    # 2. Update the formatted text output
    formatted_html = format_text(t)
    document.getElementById("formatted-output").innerHTML = formatted_html

# Run once on load
update_all()
  </script>
</body>
</html>
