<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Text...tics — A Structural Profiler</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='white'/><text x='50' y='75' font-size='80' text-anchor='middle' font-family='sans-serif' fill='black'>T</text></svg>">
  <!-- PyScript (will be needed for app.py) -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.9.1/core.css">
  <script type="module" config="pyscript.toml" src="https://pyscript.net/releases/2024.9.1/core.js"></script>

  <!-- Main application stylesheet -->
  <link rel="stylesheet" href="styles.css">
  
</head>
<body>
  <!-- Visible, first-focusable skip link for accessibility -->
  <a class="skip-link" href="#main">Skip to main content</a>

  <!-- Zone 0: Lab Instrument Masthead (Static Header) -->
  <header class="masthead" role="banner">
    <details class="masthead-details">
      <summary><h1 class="app-title">Text...tics</h1></summary>
      
      <div class="stage-indicator">
        <span class="stage-pill">Stage 1: The Profiler</span>
        <span class="stage-desc">Focus: Metrics, Lists, Integrity Flags</span>
      </div>

      <p class="spec">The Algorithmically Deterministic Structural Profiler of Textual Particles (Unicode-based)</p>
      <p class="method">Method: Deterministic particle-level analysis of the post-clipboard string, leveraging the Unicode Technical Standards (UAX/UTS) to profile composition, logical identity, perceptual boundaries, and integrity risks.</p>
    </details>
  </header>

  <!-- Two-column "Lab Bench" layout -->
  <div class="lab-bench">
    
    <!-- Column 1: Sticky In-Page Jump List -->
    <nav class="jump-list" aria-label="Sections">
      <ol>
        <li>
          <a href="#control-plane">
            <span class="jump-list-title">Text Input</span>
            <span class="jump-list-subtitle">Source &amp; Status</span>
          </a>
        </li>
        
        <li>
          <a href="#hud-panel-wrapper">
            <span class="jump-list-title">Head-Up Display</span>
            <span class="jump-list-subtitle">Live Metrics</span>
          </a>
        </li>

        <li>
          <a href="#inspector-panel-wrapper">
            <span class="jump-list-title">Character Inspector</span>
            <span class="jump-list-subtitle">Interactive Tool</span>
          </a>
        </li>
        
        <li>
          <a href="#actions-panel-wrapper">
            <span class="jump-list-title">Actions</span>
            <span class="jump-list-subtitle">Controls</span>
          </a>
        </li>

        <li>
          <a href="#dual-atom">
            <span class="jump-list-title">Dual-Atom</span>
            <span class="jump-list-subtitle">Profile <span id="toc-dual-count" class="count">(0)</span></span>
          </a>
        </li>

        <li>
          <a href="#structural-integrity">
            <span class="jump-list-title">Structural Integrity</span>
            <span class="jump-list-subtitle">Profile <span id="toc-integrity-count" class="count">(0)</span></span>
          </a>
        </li>

        <li>
          <a href="#threat-hunting">
            <span class="jump-list-title">Threat-Hunting</span>
            <span class="jump-list-subtitle">Profile <span id="toc-threat-count" class="count">(0)</span></span>
          </a>
        </li>

        <li>
          <a href="#provenance-context">
            <span class="jump-list-title">Provenance &amp; Context</span>
            <span class="jump-list-subtitle">Profile <span id="toc-prov-count" class="count">(0)</span></span>
          </a>
        </li>

        <li>
          <a href="#emoji-forensics">
            <span class="jump-list-title">Emoji Qualification</span>
            <span class="jump-list-subtitle">Profile <span id="toc-emoji-count" class="count">(0)</span></span>
          </a>
        </li>

        <li>
          <a href="#structural-shape">
            <span class="jump-list-title">Structural Shape</span>
            <span class="jump-list-subtitle">Profile <span id="toc-shape-count" class="count">(0)</span></span>
          </a>
        </li>
      </ol>
    </nav>

    <!-- Column 2: Main Analysis Content (Scrollable) -->
    <main id="main">

      <!-- Group 1: Analysis Configuration (Control Plane) -->
     <section id="control-plane" aria-labelledby="control-plane-title">
        <div class="section-header"><h2 id="control-plane-title" class="section-title" style="border:none; margin:0;">Text Input</h2></div>
          <div class="control-stack">
          <label for="text-input" class="visually-hidden">Text input</label>
            <textarea id="text-input" placeholder="Loading Unicode data files..." disabled></textarea>
              <div class="status-bar">
            <div class="status-bar-left">
              <span id="status-line" role="status" aria-live="polite" class="status-loading">Initializing engine...</span>
              <span id="hud-stepper-status" class="status-details" style="display:none; margin-left: 12px;"></span>
            </div>
            
              <div class="status-bar-right">
              <button id="btn-reveal2" class="tool-btn" style="display:none; margin-right: 0.5rem;" title="Highlight invisible characters without replacing them">Highlight Non-Std Inv. &#x26AA;&#xFE0E;&#x26AB;&#xFE0E;</button>
              <button id="btn-reveal" class="tool-btn" style="display:none;" title="Replace invisible characters (ZWSP, Bidi, Tags) with visible tags">Deobfuscate Non-Std Inv. &#x21C4;</button>
              <span id="reveal-details" class="status-details"></span>
            </div>
          </div>
            </div>
      </section>
       
     <details class="profile-section" id="hud-panel-wrapper">
          <summary><h2 class="section-title">Head-Up Display</h2></summary>
          
          <div>
            
            <div id="forensic-hud" class="hud-container"></div>
            
            <div id="hud-console" class="hud-console-strip">
                <div class="console-row" id="console-row-primary">
                    <div class="c-cell-def">
                        <span class="console-key" id="c-p-key">PRIMARY:</span>
                        <span class="console-val" id="c-p-def">Hover over a metric for definition.</span>
                    </div>
                    <div class="c-cell-meta">
                        <span class="console-key">LOGIC:</span>
                        <span class="console-val" id="c-p-logic"></span>
                    </div>
                    <div class="c-cell-meta">
                        <span class="console-key">STD:</span>
                        <span class="console-val" id="c-p-std"></span>
                    </div>
                </div>

                <div class="console-row" id="console-row-secondary">
                    <div class="c-cell-def">
                        <span class="console-key" id="c-s-key">SECONDARY:</span>
                        <span class="console-val" id="c-s-def">Secondary context will appear here.</span>
                    </div>
                    <div class="c-cell-meta">
                        <span class="console-key">LOGIC:</span>
                        <span class="console-val" id="c-s-logic"></span>
                    </div>
                    <div class="c-cell-meta">
                        <span class="console-key">STD:</span>
                        <span class="console-val" id="c-s-std"></span>
                    </div>
                </div>
            </div>

            <div class="encoding-dashboard">
                <div id="encoding-integrity" class="enc-integrity-panel"></div>
                <div id="encoding-provenance" class="enc-provenance-strip"></div>
            </div>
            
            <div id="encoding-synthesis" class="enc-synthesis-row"></div>
            
            <div class="enc-legend-wrapper">
                <button type="button" id="btn-legend-toggle" class="legend-header" aria-expanded="false">
                    <span class="legend-trigger-text">How to read this dashboard</span>
                    <span class="legend-icon">▼</span>
                </button>
                
                <div id="enc-legend-content" class="enc-legend-panel" hidden>
                    <div class="legend-col">
                        <span class="legend-title">METRICS</span>
                        <div class="legend-item">
                            <span class="leg-key">S (Signal):</span> % of <em class="highlight-text">Non-ASCII</em> characters this encoding explains.<br>High S = Strong Candidate.
                        </div>
                        <div class="legend-item">
                            <span class="leg-key">C (Compatibility):</span> % of <em class="highlight-text">ALL</em> characters that fit in this encoding.
                        </div>
                        <div class="legend-item" style="margin-top:6px; font-style:italic; font-size:0.65rem; color:#9ca3af;">
                            Note: Percentages are independent compatibility scores.<br>They do not sum to 100%.
                        </div>
                    </div>

                    <div class="legend-col">
                        <span class="legend-title">STATUS COLORS</span>
                        <div class="legend-item">
                            <span class="leg-badge leg-green">100%</span> <strong>SAFE:</strong> Full compatibility. No data loss.
                        </div>
                        <div class="legend-item">
                            <span class="leg-badge leg-orange">&lt;100%</span> <strong>PARTIAL:</strong> Data loss / Mojibake risk.
                        </div>
                        <div class="legend-item">
                            <span class="leg-badge leg-gray">0%</span> <strong>NONE:</strong> Incompatible / Irrelevant.
                        </div>
                    </div>

                    <div class="legend-col">
                        <span class="legend-title">FLAGS & ANCHORS</span>
                        <div class="legend-item">
                            <span class="leg-icon">◈</span> <strong>Unique:</strong> The sole legacy encoding that supports specific characters.
                        </div>
                        <div class="legend-item">
                            <span class="leg-badge leg-blue">BASELINE</span> <strong>ASCII:</strong> Universal 7-bit text. Safe reference, but not a candidate.
                        </div>
                        <div class="legend-item">
                            <span class="leg-key leg-violet">UNI-ONLY:</span> Characters impossible in legacy sets.
                        </div>
                    </div>
                </div>
           
            </div>

          </div> 
     </details>


<details class="profile-section" id="inspector-panel-wrapper">
          <summary><h2 class="section-title">Character Inspector</h2></summary>
          <div id="inspector-panel-content">
             <div class="inspector-placeholder">
                 Click within the text input. Properties will be shown for the character immediately to the right of the cursor.
             </div>
          </div>
      </details>

      <details class="profile-section" id="actions-panel-wrapper">
          <summary><h2 class="section-title">Actions</h2></summary>
          
          <div class="action-bar">
            
            <div class="action-row-top">
              <button id="btn-toggle-profiles" class="tool-btn" title="Toggle all profile sections">
                ↕ Expand All Profiles
              </button>

              <div class="action-spacer"></div>

              <div class="copy-group">
                <button id="btn-copy-hud" class="tool-btn" title="Copy only the Live Metrics table">
                  Copy HUD Data
                </button>
                <button id="btn-copy-inspector" class="tool-btn" title="Copy only the current Inspector data">
                  Copy Inspector Data
                </button>
                <button id="copy-report-btn" class="tool-btn report-btn" title="Copy the complete dataset (Input + All Profiles)">
                  Copy Full Profile Data
                </button>
                <button id="btn-copy-all-everything" class="tool-btn" title="Copy HUD + Inspector + Full Profile into one clipboard">
                  Copy All Data
                </button>
                
              </div>
            </div>
            
            <div class="workbench-row">
                <div class="wb-group">
                    <button id="btn-sanitize-strict" class="tool-btn wb-btn-strict" title="Strict Mode: Drops Bidi, Invisibles, Tags, Private Use, and non-std formats. Normalizes to NFC.">
                        Sanitize Strictly
                    </button>
                    <button id="btn-sanitize-conservative" class="tool-btn wb-btn-cons" title="Conservative Mode: Keeps RGI Emoji & valid ZWJ sequences. Drops Bidi/Tags. Normalizes to NFC.">
                        Sanitize Conservatively
                    </button>
                </div>

                <div class="wb-group">
                    <button id="btn-copy-py" class="tool-btn wb-btn-code" title="Copy as Safe Python String (Escaped)">
                        Copy as Python
                    </button>
                    <button id="btn-copy-js" class="tool-btn wb-btn-code" title="Copy as Safe JavaScript String (ES6 Escaped)">
                        Copy as JavaScript
                    </button>
                </div>

                <div class="wb-group">
                    <button id="btn-export-json" class="tool-btn wb-btn-evidence" title="Download Full Forensic Artifact (JSON)">
                        Download as JSON
                    </button>
                </div>
            </div>

            <div class="action-row-bottom">
              <button id="btn-run-stage2" class="tool-btn macro-btn" title="Run macro-analysis on this text">
                ▥ Analyze Macrostructure
              </button>
            </div>

            <p class="action-bar-desc">
              Opens the "Structural MRI" (Stage 2) in a new tab to analyze the macro-shape and anomaly distribution.
            </p>
          </div>
      </details>
      
    
      <!-- GROUP 2: THE STRUCTURAL PROFILE -->

         <details class="fingerprint-section profile-section" id="dual-atom" aria-labelledby="dual-atom-title">
        <summary><h2 id="dual-atom-title" class="section-title">
          <span>Dual-Atom Profile</span>
        </h2></summary>

        <div class="tabs">
          <div role="tablist" aria-label="Dual-Atom tabs">
            <button role="tab" id="tab-overview" aria-selected="true" aria-controls="panel-overview">Overview</button>
            <button role="tab" id="tab-breakdown" aria-selected="false" tabindex="-1" aria-controls="panel-breakdown">Full Breakdown (30)</button>
          </div>

          <div id="panel-overview" role="tabpanel" aria-labelledby="tab-overview">
            <h3 class="subsection-title">Core Metrics (Totals)</h3>
            <div class="cards" id="meta-totals-cards"></div>
            <h3 class="subsection-title">Grapheme Structural Integrity</h3>
            <div class="cards" id="grapheme-integrity-cards"></div>
            <h3 class="subsection-title">Combining Class Profile (Zalgo)</h3>
            <table class="matrix" id="ccc-matrix">
              <caption>Canonical Combining Class (ccc) Counts</caption>
              <thead><tr><th scope="col">Class</th><th scope="col">Count</th><th scope="col">Description</th></tr></thead>
              <tbody id="ccc-matrix-body"></tbody>
            </table>
            <h3 class="subsection-title">Major Category Parallel View</h3>
            <table class="matrix" id="major-parallel-table">
              <caption>Major Categories - Code Points vs. Graphemes</caption>
              <thead><tr><th scope="col">Category</th><th scope="col">Code Points (Logical)</th><th scope="col">Graphemes (Perceptual)</th></tr></thead>
              <tbody id="major-parallel-body"></tbody>
            </table>
          </div>

          <div id="panel-breakdown" role="tabpanel" aria-labelledby="tab-breakdown" hidden>
            <h3 class="subsection-title">Minor Category Parallel View</h3>
            <table class="matrix" id="minor-parallel-table">
              <caption>Full Breakdown (30 minor categories)</caption>
              <thead><tr><th scope="col">Minor Category</th><th scope="col">Code Points (Logical)</th><th scope="col">Graphemes (Perceptual)</th></tr></thead>
              <tbody id="minor-parallel-body"></tbody>
            </table>
          </div>
       </div>
      </details>

      <details class="fingerprint-section profile-section" id="structural-integrity" aria-labelledby="integrity-title">
        <summary><h2 id="integrity-title" class="section-title">Structural Integrity Profile</h2></summary>
        <table class="matrix" id="integrity-matrix">
          <caption>Integrity Flags (Invisibles, Modifiers, IVS)</caption>
            <thead><tr><th scope="col">Metric</th><th scope="col">Count</th><th scope="col">Details / Positions</th></tr></thead>
            <tbody id="integrity-matrix-body"></tbody>
          </table>
      </details>

      <details class="fingerprint-section profile-section" id="threat-hunting" aria-labelledby="threat-title">
        <summary><h2 id="threat-title" class="section-title">Threat-Hunting Profile</h2></summary>
        <div id="threat-banner" class="banner-warning" role="alert" hidden></div>
        <h3 class="subsection-title">Threat Flags</h3>
        <table class="matrix" id="threat-report-table">
            <caption>High-level security flags and high-risk runs</caption>
            <thead><tr><th scope="col">Metric</th><th scope="col">Count</th><th scope="col">Details / Positions</th></tr></thead>
            <tbody id="threat-report-body"></tbody>
        </table>
        <h3 class="subsection-title">Normalization Hashes</h3>
        <table class="matrix" id="threat-hash-report">
            <caption>State Hashes (Forensic, NFKC, NFKC-Casefold, UTS #39 Skeleton)</caption>
            <thead><tr><th scope="col">State</th><th scope="col">Hash (SHA-256)</th></tr></thead>
            <tbody id="threat-hash-report-body"><tr><td colspan="2" class="placeholder-text">No data.</td></tr></tbody>
        </table>
        <h3 class="subsection-title">Perceived vs Encoded Character(s)</h3>
        <pre id="confusable-diff-report" class="confusable-report"><p class="placeholder-text">No confusable runs detected.</p></pre>
      </details>

      <details class="fingerprint-section profile-section" id="provenance-context" aria-labelledby="prov-title">
        <summary><h2 id="prov-title" class="section-title">Provenance &amp; Context Profile</h2></summary>
        <table class="matrix" id="provenance-matrix">
          <caption>Script, Script-Extension, Block, Age &amp; Numeric Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th><th scope="col">Positions</th></tr></thead>
          <tbody id="provenance-matrix-body"></tbody>
        </table>
        <h3 class="subsection-title">Script Run-Length Analysis</h3>
        <table class="matrix" id="script-run-matrix">
          <caption>Sequence (Run) Analysis of Script & Script-Extension Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th><th scope="col">Positions</th></tr></thead>
          <tbody id="script-run-matrix-body"></tbody>
        </table>
      </details>

      <details class="fingerprint-section profile-section" id="emoji-forensics" aria-labelledby="emoji-title">
        <summary><h2 id="emoji-title" class="section-title">Emoji Qualification Profile</h2></summary>
        <h3 class="subsection-title">Emoji Unit Qualification</h3>
        <p id="emoji-summary" class="emoji-summary"></p>
        <table class="matrix" id="emoji-qualification-matrix">
          <caption>Qualification status for all detected emoji units</caption>
          <thead><tr><th scope="col">Sequence</th><th scope="col">Kind</th><th scope="col">Base</th><th scope="col">RGI?</th><th scope="col">Status</th><th scope="col">Count</th><th scope="col">Positions</th></tr></thead>
          <tbody id="emoji-qualification-body"></tbody>
        </table>
      </details>

      <details class="fingerprint-section profile-section" id="structural-shape" aria-labelledby="shape-title">
        <summary><h2 id="shape-title" class="section-title">Structural Shape Profile</h2></summary>
        
        <h3 class="subsection-title">Major Category Run Analysis</h3>
        <table class="matrix" id="shape-matrix">
          <caption>Sequence (Run) Analysis of 7 Major Categories</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="shape-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Minor Category Run Analysis</h3>
        <table class="matrix" id="minor-shape-matrix">
          <caption>Sequence (Run) Analysis of 30 Minor Categories</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="minor-shape-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Line Break Run Analysis (UAX #14)</h3>
        <table class="matrix" id="linebreak-run-matrix">
          <caption>Sequence (Run) Analysis of Line Break Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="linebreak-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Bidi Class Run Analysis (UAX #9)</h3>
        <table class="matrix" id="bidi-run-matrix">
          <caption>Sequence (Run) Analysis of Bidi Class Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="bidi-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Word Break Run Analysis (UAX #29)</h3>
        <table class="matrix" id="wordbreak-run-matrix">
          <caption>Sequence (Run) Analysis of Word Break Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="wordbreak-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Sentence Break Run Analysis (UAX #29)</h3>
        <table class="matrix" id="sentencebreak-run-matrix">
          <caption>Sequence (Run) Analysis of Sentence Break Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="sentencebreak-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Grapheme Break Run Analysis (UAX #29)</h3>
        <table class="matrix" id="graphemebreak-run-matrix">
          <caption>Sequence (Run) Analysis of Grapheme Break Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="graphemebreak-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">East Asian Width Run Analysis</h3>
        <table class="matrix" id="eawidth-run-matrix">
          <caption>Sequence (Run) Analysis of East Asian Width Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="eawidth-run-matrix-body"></tbody>
        </table>

        <h3 class="subsection-title">Vertical Orientation Run Analysis</h3>
        <table class="matrix" id="vo-run-matrix">
          <caption>Sequence (Run) Analysis of Vertical Orientation Properties</caption>
          <thead><tr><th scope="col">Metric</th><th scope="col">Count</th></tr></thead>
          <tbody id="vo-run-matrix-body"></tbody>
        </table>
      </details>
</main>
</div> <!-- /.lab-bench -->
<script type="py" src="app.py"></script>
<script src="ui-glue.js" defer></script>
</body>
</html>
