<!doctype html>
<html>
<head>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KKG6C4ZW');</script>
<meta charset="UTF-8" />

<script>
  // Define dataLayer + gtag *first*
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }

  // 1) Set Consent Mode *defaults* BEFORE loading gtag.js
  // This will remain, but users will have no way to accept
  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'wait_for_update': 500
  });

  // (optional hardening)
  gtag('set', 'url_passthrough', true);
  gtag('set', 'ads_data_redaction', true);
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-HKGZL0K924"></script>

<script>
  // 3) Initialize & configure GA4
  gtag('js', new Date());
  gtag('config', 'G-HKGZL0K924');  // OK to run with denied defaults
</script>

<link rel="stylesheet" href="https://pyscript.net/releases/2024.9.1/core.css" />
<script type="module" src="https://pyscript.net/releases/2024.9.1/core.js"></script>


  <style>
    body {  
      font: 16px/1.4 system-ui, sans-serif;  
      max-width: 1400px;  
      margin: 2rem auto;  
      padding: 0 1rem;  
      padding-bottom: 150px;  
    }
    textarea { width: 100%; height: 220px; box-sizing: border-box; }
    
    .stats {  
      display: grid;
      gap: .8rem;  
      margin-top: 1rem;  
    }
    
    #stats {
      grid-template-columns: repeat(9, 1fr);
    }
    
    .card {  
      padding: .8rem 1rem;  
      border: 1px solid #ddd;  
      border-radius: 10px;  
    }
    
    #stats .card:first-child {
      grid-column: span 2;
    }
    
    .stats.sequence-stats {
      grid-template-columns: repeat(7, 1fr);
    }

    /* Styles for the formatted output area */
    h2 { margin-top: 2rem; }

    #formatted-output {
      display: grid;
      grid-template-columns: auto 1fr;
      column-gap: 1.5rem;
      row-gap: 0.5rem;
      word-break: break-all;
    }

    .percentile-label {
      font-family: monospace;
      font-size: 0.9rem;
      color: #333;
      padding-top: 1rem;  
    }
    
    .percentile-text-block {
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 1rem;
      line-height: 1.6;
      background: #fdfdfd;
      border-bottom: 2px solid #aaa;  
      margin-bottom: 1rem;
    }
h1 { text-align: center; }
    /* ALL COOKIE BANNER CSS REMOVED */

/* --- Tooltip Styles --- */
.tooltip {
  position: relative;
  display: inline-block;
  cursor: help;
  font-size: 1rem;
  font-weight: 600;
  color: #007bff;
  margin-left: 6px;
}

.tooltip .tooltip-text {
  /* Visibility (hidden by default) */
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.3s;

  /* Box Styling */
  width: 300px;
  background-color: #333;
  color: #fff;
  text-align: left;
  font-weight: normal; /* Un-bold the text */
  font-size: 0.9rem;
  line-height: 1.4;
  border-radius: 6px;
  padding: 10px;
  
  /* Positioning */
  position: absolute;
  z-index: 1;
  bottom: 125%; /* Position above the '?' */
  left: 50%;
  margin-left: -150px; /* Center it (half of the 300px width) */
}

/* Show the tooltip on hover */
.tooltip:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
/* --- End Tooltip Styles --- */
    
  </style>

  
</head>
<body>
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKG6C4ZW"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  
<h1>Text...tics</h1>
  
<h2>Text Input</h2>  
<textarea id="text" py-input="update_all" placeholder="Paste or type here..."></textarea>
  
<h2>
  Character Composition
  <span class="tooltip">(?)
    <span class="tooltip-text">
      Measures the static properties of the text by counting the frequency of 8 different character classes (e.g., Letters, Numbers, Punctuation, etc.).
    </span>
  </span>
</h2>
<div class="stats" id="stats"></div>
  
<h2>
  Character Sequence Analysis
  <span class="tooltip">(?)
    <span class="tooltip-text">
      Performs a Run-Length Analysis to count uninterrupted sequences (or 'runs') of the same character type (e.g., 'Hello-100%' has 4 sequences).
    </span>
  </span>
</h2>
<div class="stats sequence-stats" id="sequence-stats"></div>


  <h2>Text Dissected by Character Count Decile</h2>
  <div id="formatted-output"></div>


  <script type="py">
from pyscript import document
import string

PUNCTUATION_SET = set(string.punctuation)
CONTROL_CHARS = set(string.whitespace) - {' '}

def compute_stats(t: str):
    total = len(t)
    letters = 0
    numbers = 0
    whitespace = 0
    control = 0
    punctuation = 0
    emoji = 0
    symbols = 0

    for char in t:
        if char == ' ':
            whitespace += 1
        elif char.isalpha():
            letters += 1
        elif char.isdigit():
            numbers += 1
        elif char in CONTROL_CHARS:
            control += 1
        elif char in PUNCTUATION_SET:
            punctuation += 1
        elif ord(char) >= 0x1F300:  
            emoji += 1
    
    symbols = total - (whitespace + letters + numbers + control + punctuation + emoji)

    return {
        "Characters (any)": total,
        "Letters": letters,
        "Numbers": numbers,
        "Space (' ')": whitespace,
        "Punctuation": punctuation,
        "Control Chars": control,
        "Emoji": emoji,
        "Symbols": symbols,
    }

    
def get_char_type(char):
    if char == ' ':
        return 'Space'
    if char.isalpha():
        return 'Letters'
    if char.isdigit():
        return 'Numbers'
    if char in CONTROL_CHARS:
        return 'Control'
    if char in PUNCTUATION_SET:
        return 'Punctuation'
    if ord(char) >= 0x1F300:
        return 'Emoji'
    return 'Symbols'

def compute_sequence_stats(t: str):
    counters = {
        "Letters": 0, "Numbers": 0, "Space": 0,
        "Punctuation": 0, "Control": 0, "Emoji": 0, "Symbols": 0,
    }
    
    if not t:
        return counters

    current_state = 'NONE'
    
    for char in t:
        new_state = get_char_type(char)
        
        if new_state != current_state:
            if current_state in counters:
                counters[current_state] += 1
            current_state = new_state
            
    if current_state in counters:
        counters[current_state] += 1
        
    return counters

def format_text(t: str):
    if not t.strip():
        return ""
    clean_text = [ch for ch in t if not ch.isspace()]
    total_non_space_chars = len(clean_text)
    if total_non_space_chars == 0:
        return ""
    decile_cutoffs = [(total_non_space_chars * (i / 10.0)) for i in range(1, 10)]
    labels = [
        "0-10%", "10-20%", "20-30%", "30-40%", "40-50%",
        "50-60%", "60-70%", "70-80%", "80-90%", "90-100%"
    ]
    html_output = ""
    running_non_space_count = 0
    decile_index = 0
    current_text_chunk = []
    html_output += f'<div class="percentile-label">{labels[decile_index]}</div>'
    html_output += f'<div class="percentile-text-block">'
    for char in t:
        current_text_chunk.append(char)
        if not char.isspace():
            running_non_space_count += 1
            if decile_index < 9 and running_non_space_count > decile_cutoffs[decile_index]:
                html_output += "".join(current_text_chunk)
                html_output += '</div>'
                decile_index += 1
                html_output += f'<div class="percentile-label">{labels[decile_index]}</div>'
                html_output += f'<div class="percentile-text-block">'
                current_text_chunk = []
    html_output += "".join(current_text_chunk)
    html_output += '</div>'
    return html_output

# ADDING THIS FUNCTION DEFINITION BACK TO FIX THE NameError
def update_all(event=None):
    t = document.getElementById("text").value
    stats = compute_stats(t)
    stats_html = "".join(f'<div class="card"><strong>{k}</strong><div>{v}</div></div>'
                         for k,v in stats.items())
    document.getElementById("stats").innerHTML = stats_html
    seq_stats = compute_sequence_stats(t)
    seq_stats_renamed = {
        "Letters": seq_stats["Letters"], "Numbers": seq_stats["Numbers"],
        "Space (' ')": seq_stats["Space"], "Punctuation": seq_stats["Punctuation"],
        "Control Chars": seq_stats["Control"], "Emoji": seq_stats["Emoji"],
        "Symbols": seq_stats["Symbols"],
    }
    seq_stats_html = "".join(f'<div class="card"><strong>{k}</strong><div>{v}</div></div>'
                             for k,v in seq_stats_renamed.items())
    document.getElementById("sequence-stats").innerHTML = seq_stats_html
    formatted_html = format_text(t)
    document.getElementById("formatted-output").innerHTML = formatted_html

# This call will now work
update_all()
    
  </script>

</body>

</html>
