/* ---
Root Variables & Reset
--- */
:root {
  --font-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
  --font-mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  
  --color-bg: #f9fafb;
  --color-text: #111827;
  --color-text-muted: #4b5563;
  --color-border: #d1d5db;
  --color-border-light: #e5e7eb;
  --color-white: #ffffff;
  --color-primary: #2563eb;
  --color-primary-focus: #3b82f6;

  --width-jump-list: 150px;
  --spacing-1: 0.25rem;
  --spacing-2: 0.5rem;
  --spacing-3: 0.75rem;
  --spacing-4: 1rem;
  --spacing-5: 1.25rem;
  --spacing-6: 1.5rem;
  --spacing-8: 2rem;
  --radius: 0.5rem; /* 8px */
  --radius-sm: 0.25rem; /* 4px */
}

*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-sans);
  font-size: 16px;
  line-height: 1.5;
  background-color: var(--color-bg);
  color: var(--color-text);
  margin: 0;
}

/* ---
Accessibility & Utilities
--- */
.skip-link {
  position: absolute;
  top: -100px;
  left: var(--spacing-4);
  background: var(--color-primary);
  color: var(--color-white);
  padding: var(--spacing-2) var(--spacing-4);
  border-radius: var(--radius-sm);
  z-index: 1000;
  transition: top 0.3s;
}
.skip-link:focus {
  top: var(--spacing-4);
}

.visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

.placeholder-text {
  padding: var(--spacing-4);
  color: var(--color-text-muted);
  font-style: italic;
  text-align: center;
  border: 1px dashed var(--color-border);
  border-radius: var(--radius);
}

/* ---
Zone 0: Masthead (Static Header)
--- */
.masthead {
  padding: var(--spacing-6) var(--spacing-8); /* Increased top/bottom padding slightly for balance */
  border-bottom: 1px solid var(--color-border);
  background: var(--color-white);
  
  /* CENTER ALIGNMENT FIX */
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center; /* Ensures child elements center-align */
}

.app-title {
  font-size: 1.75rem; /* Slight bump for hierarchy */
  color: var(--color-text);
  margin-bottom: var(--spacing-2);
}

/* NEW: Stage Indicator Styles */
.stage-indicator {
  display: flex;
  gap: var(--spacing-2);
  align-items: center;
  justify-content: center;
  margin-bottom: var(--spacing-3);
  font-size: 0.85rem;
}

.stage-pill {
  background-color: var(--color-primary);
  color: var(--color-white);
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: uppercase;
}

.stage-desc {
  color: var(--color-text-muted);
  font-family: var(--font-mono); /* Lab instrument feel */
  font-size: 0.8rem;
  /* UPDATED VALUES: */
  font-size: 1rem;   /* Increased from 0.8rem */
  font-weight: 700;     /* Makes it bold */
  letter-spacing: -0.02em; /* Optional: Tightens it slightly for a technical look */
}

/* UPDATED: Centered Text blocks */
.spec, .method {
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-top: var(--spacing-1);
  
  /* Limit width for readability when centered */
  max-width: 800px; 
  line-height: 1.5;
}

.spec {
  font-weight: 600;
  margin-bottom: var(--spacing-1);
}

/* ---
Main Two-Column "Lab Bench" Layout
--- */
.lab-bench {
  display: grid;
  grid-template-columns: var(--width-jump-list) 1fr;
  max-width: 1700px;
  margin: 0 auto;
  gap: var(--spacing-8);
  padding: var(--spacing-8);
}

/* ---
Column 1: Sticky Jump List (Nav)
--- */
.jump-list {
  position: sticky;
  top: var(--spacing-8); /* Sticks below masthead */
  align-self: start;
  max-height: calc(100vh - var(--spacing-8) * 2);
  overflow-y: auto;
}
.jump-list ol {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: var(--spacing-3);
}

.jump-list a {
  display: flex;
  flex-direction: column; 
  align-items: flex-start;
  text-decoration: none;
  color: var(--color-text-muted);
  padding: var(--spacing-2) var(--spacing-3);
  border-radius: var(--radius-sm);
  transition: all 0.2s;
  line-height: 1.3; 
}

.jump-list-title {
  font-weight: 500;
  font-size: 0.95rem; 
  color: var(--color-text); 
}

.jump-list-subtitle {
  font-weight: 400;
  font-size: 0.85rem;
  color: var(--color-text-muted);
  display: flex; 
  align-items: center;
}

.jump-list a:hover {
  background-color: var(--color-border-light);
  color: var(--color-text);
}

.jump-list .count {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--color-primary);
  background-color: var(--color-border-light);
  padding: 2px 8px;
  border-radius: 12px;
  flex-shrink: 0;
  margin-left: var(--spacing-2); 
}

.jump-list a:hover .jump-list-title,
.jump-list a:hover .jump-list-subtitle {
  color: var(--color-primary);
}

/* ---
Column 2: Main Analysis Content
--- */
#main {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-8);
  min-width: 0; /* Prevents overflow */
}

.section-title {
  font-size: 1.25rem;
  color: var(--color-text);
  margin-bottom: var(--spacing-4);
  padding-bottom: var(--spacing-2);
  border-bottom: 1px solid var(--color-border-light);
  display: flex; /* For copy button alignment */
  justify-content: space-between;
  align-items: center;
}
.subsection-title {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text-muted);
  margin-top: var(--spacing-6);
  margin-bottom: var(--spacing-3);
}
.fingerprint-section:first-of-type .subsection-title:first-of-type {
  margin-top: 0;
}

/* ---
Group 1: Control Plane
--- */
/* [FIX] Enforce identical font stack for Input and Inspector */
#text-input, 
.inspector-glyph, 
.ctx-item {
  font-family: "Consolas", "Monaco", "Lucida Console", "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", monospace;
}
#text-input {
  width: 100%;
  height: 180px;
  box-sizing: border-box;
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  padding: var(--spacing-4);
  font-size: 1rem;
/* font-family is now handled by the group rule above */
  line-height: 1.6;
}
#text-input:focus {
  outline: 2px solid var(--color-primary-focus);
  border-color: var(--color-primary-focus);
}
.status {
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-top: var(--spacing-2);
}

/* --- 
   State: Immutable Reveal (Deobfuscation Mode) 
   Visual Cues: Amber Palette + Diagonal Hatching
--- */

/* Control Plane Toolbar */
.section-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-2);
  border-bottom: 1px solid var(--color-border-light);
  padding-bottom: var(--spacing-2);
}

/* --- Control Plane Buttons --- */
.control-buttons-container {
  display: flex; 
  gap: 0.75rem; 
  margin: 0.5rem 0 1rem 0; 
}

.tool-btn {
  /* Core Layout */
  display: flex;
  align-items: center;
  justify-content: center; 
  gap: var(--spacing-2);
  
  /* Typography & Size */
  font-size: 0.9rem; 
  font-weight: 600;
  padding: 0.65rem 1rem; 

  /* Colors */
  background-color: var(--color-white);
  border: 1px solid var(--color-border);
  color: var(--color-text-muted);
  
  /* Interactive */
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s ease;
}

.tool-btn:hover {
  border-color: var(--color-primary);
  color: var(--color-primary);
  background-color: #eff6ff; /* Light blue tint */
}

.tool-btn:active {
  transform: translateY(1px);
}
.tool-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  background-color: var(--color-border);
}

/* ---
Group 2.A: Dual-Atom Tabs
--- */
.tabs [role="tablist"] {
  display: flex;
  gap: var(--spacing-2);
  border-bottom: 1px solid var(--color-border);
}
.tabs [role="tab"] {
  font-size: 1rem;
  font-weight: 600;
  padding: var(--spacing-2) var(--spacing-4);
  border: 1px solid transparent;
  border-bottom: 0;
  border-radius: var(--radius-sm) var(--radius-sm) 0 0;
  background: none;
  cursor: pointer;
  color: var(--color-text-muted);
  margin-bottom: -1px; /* Sits on top of the border */
}
.tabs [role="tab"]:hover {
  color: var(--color-text);
}
.tabs [role="tab"][aria-selected="true"] {
  background: var(--color-white);
  border-color: var(--color-border);
  color: var(--color-primary);
}
.tabs [role="tabpanel"] {
  padding: var(--spacing-6) var(--spacing-4);
  background: var(--color-white);
  border: 1px solid var(--color-border);
  border-top: 0;
  border-radius: 0 0 var(--radius) var(--radius);
}
.tabs [role="tabpanel"][hidden] {
  display: none;
}

/* ---
Group 2.A: Card Layout (for Meta-Analysis)
--- */
.cards {
  display: grid;
  gap: var(--spacing-4);
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
.card {
  padding: var(--spacing-4);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius);
  background: var(--color-white);
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}
.card strong {
  display: block;
  font-size: 0.9rem;
  color: var(--color-text-muted);
  margin-bottom: var(--spacing-1);
}
.card div {
  font-size: 1.75rem;
  font-weight: 600;
  color: var(--color-text);
}

/* ---
Groups 2.B, 2.C, 2.D: "Matrix of Facts" Table Layout
--- */
.matrix {
  width: 100%;
  border-collapse: collapse;
  background: var(--color-white);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius);
  overflow: hidden; /* For border-radius */
}
.matrix caption {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text-muted);
  padding: var(--spacing-3);
  text-align: left;
  background: var(--color-bg);
}
.matrix th, .matrix td {
  padding: var(--spacing-3) var(--spacing-4);
  text-align: left;
  border-bottom: 1px solid var(--color-border-light);
}
.matrix thead th {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-text-muted);
  background-color: var(--color-bg);
}
.matrix tbody tr:last-child th,
.matrix tbody tr:last-child td {
  border-bottom: 0;
}
.matrix tbody th {
  font-weight: 600;
  color: var(--color-text);
}
.matrix td {
  font-family: var(--font-mono);
  color: var(--color-text);
}
.matrix td:nth-child(2) {
  font-weight: 600;
  color: var(--color-primary);
}

/* ---
Responsive Design
--- */
@media (max-width: 1024px) {
  .lab-bench {
    grid-template-columns: 1fr; /* Stack columns */
    padding: var(--spacing-4);
    gap: var(--spacing-6);
  }
  
  .jump-list {
    position: static; /* Un-stick the nav */
    max-height: none;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: var(--spacing-4);
  }
  .jump-list ol {
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .masthead {
    padding: var(--spacing-4) var(--spacing-6);
  }
}

@media (max-width: 640px) {
  body {
    font-size: 14px;
  }
  .masthead {
    padding: var(--spacing-4);
  }
  .lab-bench {
    padding: var(--spacing-4);
  }
  .section-title {
    font-size: 1.1rem;
  }
  .tabs [role="tab"] {
    padding: var(--spacing-2) var(--spacing-3);
    font-size: 0.9rem;
  }
  .matrix th, .matrix td {
    padding: var(--spacing-2) var(--spacing-3);
  }
  .cards {
    grid-template-columns: 1fr 1fr; /* 2-column cards on mobile */
  }
}

/* ---
Section Header & Copy Button
--- */

.copy-btn {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-text);
  background-color: var(--color-white);
  border: 1px solid var(--color-border-light);
  padding: var(--spacing-1) var(--spacing-3);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
}

.copy-btn:hover {
  background-color: var(--color-white);
  border-color: var(--color-border);
  color: var(--color-primary);
}

.copy-btn:active {
  background-color: var(--color-border-light);
}

/* 'Copied!' confirmation state */
.copy-btn.copied {
  color: #15803d; /* A success green */
  background-color: #f0fdf4;
  border-color: #bbf7d0;
}


/* ---
Group 3: Threat-Hunting
--- */

/* Style for the <pre> container */
.confusable-report {
  background-color: var(--color-white);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius);
  padding: var(--spacing-4);
  font-family: var(--font-mono);
  font-size: 1rem;
  line-height: 1.6;
  white-space: pre-wrap; /* Allow wrapping */
  word-break: break-all; /* Break long words */
}

/* Style for the highlighted confusable character */
.confusable {
  background-color: #fffbeb; /* Yellow-100 */
  color: #b45309; /* Amber-700 */
  border-bottom: 2px dotted #f59e0b; /* Amber-500 */
  cursor: help;
  font-weight: 600;
}

/* Style for the "Bidi Control" banner */
.banner-warning {
  padding: var(--spacing-4);
  background-color: #fef2f2; /* Red-50 */
  color: #b91c1c; /* Red-700 */
  border: 1px solid #fca5a5; /* Red-300 */
  border-radius: var(--radius);
  font-weight: 600;
  font-size: 1.1rem;
}

/* Make the banner hidden by default */
.banner-warning[hidden] {
  display: none;
}

/* ---
Legends & Badges
--- */
.legend {
  margin-top: -0.5rem; /* Pulls it closer to the title */
  margin-bottom: 1.25rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
  align-items: center;
  font-size: 0.8rem;
  color: var(--color-text-muted);
}

.legend-label {
  font-weight: 600;
  margin-right: 0.25rem;
}

/* For Emoji Profile */
.legend-pill {
  padding: 0.1rem 0.5rem;
  border-radius: 999px;
  border: 1px solid var(--color-border);
  background: var(--color-bg);
  font-size: 0.75rem;
  white-space: nowrap;
}
.legend-pill-ok {
  border-color: #a7f3d0; /* green-200 */
  background-color: #f0fdf4; /* green-50 */
  color: #065f46; /* green-800 */
}
.legend-pill-warn {
  border-color: #fde68a; /* yellow-200 */
  background-color: #fefce8; /* yellow-50 */
  color: #854d0e; /* yellow-800 */
}
.legend-pill-neutral {
  border-color: #e5e7eb; /* gray-200 */
  background-color: #f9fafb; /* gray-50 */
  color: #374151; /* gray-700 */
}

/* For Threat Profile */
.legend-badge {
  padding: 0.1rem 0.5rem;
  border-radius: 0.25rem;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  border: 1px solid;
}
.legend-badge-danger {
  background-color: #fef2f2; /* red-50 */
  color: #b91c1c; /* red-700 */
  border-color: #fca5a5; /* red-300 */
}
.legend-badge-high {
  background-color: #fffbeb; /* yellow-50 */
  color: #b45309; /* amber-700 */
  border-color: #fcd34d; /* yellow-300 */
}
.legend-badge-suspicious {
  background-color: #eff6ff; /* blue-50 */
  color: #1e40af; /* blue-800 */
  border-color: #bfdbfe; /* blue-200 */
}
/* NEW: Style for the RGI/Component summary line */
.emoji-summary {
  margin-top: 0.25rem;
  margin-bottom: 0.75rem; 
  font-size: 0.9rem;
  color: var(--color-text-muted);
  padding-left: var(--spacing-3);
  font-weight: 600;
}

/*
---
Stage 2: Heatmap Row Classes
---
*/

/* We set a transition on the <tbody> rows so that if the data is 
  re-calculated, the colors will fade smoothly.
*/
#macro-table-body tr {
  transition: background-color 0.3s ease-in-out;
}

/* Normal / Baseline */
.heatmap-normal {
  /* No change */
}

/* Low Anomaly */
.heatmap-low {
  background-color: #FFFBEA; /* Light yellow */
}

/* High Anomaly */
.heatmap-high {
  background-color: #FFF3E0; /* Light orange */
  font-weight: bold;
}

/* Critical Threat */
.heatmap-critical {
  background-color: #FFEBEE; /* Light red */
  color: #B71C1C; /* Dark red text for high contrast */
  font-weight: bold;
}


/* --- Character Inspector Panel --- */

/* Wrapper */
#inspector-panel-wrapper {
  border: none;
  border-radius: var(--radius);
  background-color: transparent;
}

/* --- Inspector Layout v7: The Perfect Hybrid --- */

#inspector-panel-content {
  
  /* 1. Allow the user to drag the height if they want */ /*resize: vertical; */
  height: 275px; /* Default starting height */
  min-height: 275px;
  
  /* 2. Handle overflow */
  overflow: auto; /* Shows resize handle + scrollbars */
  
  padding: 0;
  background-color: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: var(--radius);
  display: flex;
  flex-direction: column;
}

/* Empty State Centering */
.inspector-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-text-muted);
  font-style: italic;
  text-align: center;
  padding: var(--spacing-4);
}

.inspector-layout-v3 {
  display: grid;
  
  /* 1. FORCE SINGLE ROW */
  grid-template-rows: 100%; 
  
  /* 2. DEFINE THE 7 COLUMNS EXPLICITLY 
     (Context | Target | Context | Risk | Identity | Structure | Bytes) */
  /* ADJUSTED COLUMNS:
     1. Prev (50)
     2. Target (170)
     3. Next (50)
     4. RISK (165) - WIDENED (was 110)
     5. Identity (minmax(160, 1fr)) - TIGHTENED (was 200)
     6. Structure (260)
     7. Bytes (180)
  */
  /* WIDENED Column 4 (Risk) to 215px */
  grid-template-columns: 50px 170px 50px 215px minmax(155px, 1fr) 260px 180px;
/* REMAP COLUMN 4 NAME TO NEW SIGNAL PROCESSOR */
  
  .col-signal-processor { 
    grid-area: auto; /* Ensures it fits */
    /* Update: The new column is called 'col-signal-processor' in app.py HTML */
  }
  /* 3. FORCE SCROLL */
  /* This ensures the grid never squashes. 
     It triggers the scrollbar on the parent #inspector-panel-content */
  min-width: 1000px; 
  
  height: 100%;
  width: 100%;
  text-align: left;
  font-size: 0.85rem;
  
  /* Reset any inherited border issues */
  border: none;
}

/* --- Cols 1 & 3: Context (Restored Gray & Borders) --- */
.col-context {
  background-color: #ffffff; /* Changed from #f8fafc to White */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-right: 1px solid var(--color-border-light);
  color: var(--color-text-muted);
  flex-direction: column;
}
.col-prev { border-right: 1px dashed var(--color-border-light); }
.col-next { border-left: 1px dashed var(--color-border-light); }

.ctx-label {
  font-size: 0.6rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  opacity: 0.6;
  flex-direction: column;
}
.ctx-glyph {
  font-family: var(--font-mono);
  font-size: 1.5rem;
  opacity: 0.5;
  filter: grayscale(100%);
  flex-direction: column;
}

/* --- Col 2: Target (Absolute Constraint Pattern) --- */
.col-target {
  background-color: var(--color-white);
  border-right: 1px solid var(--color-border-light);
  position: relative; /* Crucial anchor for the viewport */
  height: 100%;
  /* Remove flex rules from here if they exist */
}

/* The Scrollable Window */
.glyph-viewport {
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 2.2rem; /* Leave space for label */
  /* FIX: Push scrollbar to the very bottom edge */
  bottom: 0;
  overflow: auto; 
  /* Block layout for robust scrolling */
  display: block; 
  text-align: center; /* Horizontally centers the inline-block child */
  white-space: nowrap; /* Prevent wrap */
  padding: 0;
}

.inspector-glyph {
  font-family: var(--font-mono);
  font-size: 4.25rem;
  line-height: 1; /* Tight line height to keep the "center" predictable */
  
  display: inline-block;
  vertical-align: middle;
  
  /* The "Ghost Ink" Fix: Massive Padding forces the scroll area */
  /* --- THE CHANGE --- */
  /* 10rem = Top/Bottom Buffer (Vertical) */
  /* 8rem  = Left/Right Buffer (Horizontal) -> Increased from 2rem */
  padding: 10rem 8rem; 
  font-variant-ligatures: none;
  white-space: nowrap; 
  color: var(--color-text);
}

.inspector-codepoint {
  position: absolute;
  /* FIX: Lift it up so it floats above the scrollbar track */
  bottom: 30px;
  left: 45%;
  transform: translateX(-50%);
  
  font-family: var(--font-mono);
  font-weight: 700;
  /* color: var(--color-primary); REMOVED to allow Python injection */
  font-size: 1.5rem;
  
  /* Make sure the label sits ON TOP of the scrolling text */
  /* High contrast & Shadow so it pops over the text/scrollbar */
  background-color: rgba(255, 255, 255, 0.95);
  box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* Add shadow for separation */
  
  border: 2px solid var(--color-border-light);
  padding: 3px 10px;
  border-radius: 12px; /* Pill shape */
  z-index: 20;
  transition: color 0.2s, border-color 0.2s; /* Smooth transition when clicking different chars */
}


/* --- Col 4: The Signal Processor (RISK) --- */

.col-signal-processor {
  color: var(--color-text-muted);
  border-right: 1px solid var(--color-border-light);
  display: flex;
  flex-direction: column;
  padding: 0; 
  overflow: hidden;
}

/* Zone A: Verdict Header (Split Rows) */
.risk-header {
  height: auto; /* Allow expansion for 2 rows */
  min-height: 44px;
  display: flex;
  flex-direction: column; /* Stack them */
  align-items: center;
  justify-content: center;
  padding: 6px 0;
  gap: 2px;
  border-bottom: 1px solid var(--color-border-light);
  font-family: var(--font-sans);
  text-transform: uppercase;
  fill: currentColor;
  stroke: currentColor;
}

.risk-header-top {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 0.6rem;
    font-weight: 700;
    opacity: 0.9;
    letter-spacing: 0.05em;
}

.risk-verdict-text {
    font-size: 0.85rem;
    font-weight: 800;
    letter-spacing: 0.02em;
}

.risk-header-icon svg {
  display: block;
}

/* Header States (5-Tier Scale) */

/* Level 0: BASELINE (Green - Affirmative Safety) */
.header-baseline {
  background-color: #F0FDF4; /* Green-50 */
  color: #15803D; /* Green-700 */
  border-bottom: 1px solid #BBF7D0; /* Green-200 */
}

/* Level 1: NON-STD (Blue/Teal - Informational) */
.header-complex {
  background-color: #F0F9FF; /* Very light blue (Sky-50) */
  color: #0369A1; /* Sky-700 */
  border-bottom-color: #BAE6FD; /* Sky-200 */
}

/* Level 2: ANOMALOUS (Yellow - Sensitive/Sophisticated) */
.header-anomalous {
  background-color: #FEF9C3; /* Yellow-100 */
  color: #A16207; /* Yellow-700 */
  border-bottom-color: #FDE047;
}

/* Level 3: SUSPICIOUS (Orange - Zalgo/Confusable) */
.header-suspicious {
  background-color: #FFEDD5; /* Orange-100 */
  color: #C2410C; /* Orange-700 */
  border-bottom-color: #FDBA74;
}

/* Level 4: CRITICAL (Red/Black - Real Danger) */
.header-critical {
  background-color: #111827; /* Gray-900 (Black box look) */
  color: #F87171; /* Red-400 (Glowing red text) */
  border-bottom: 1px solid #EF4444;
}

/* Zone B: Diagnostic Matrix (Space-Between Layout) */
.risk-matrix {
  padding: 12px 10px; /* Increased padding slightly for air */
  display: flex;
  flex-direction: column;
  justify-content: space-between; /* Key Fix: Pushes items apart */
  flex-grow: 1; /* Fills all remaining vertical space */
  min-height: 0; /* Prevents overflow issues */
}

.risk-row {
  display: flex;
  justify-content: space-between;
  align-items: flex-start; /* Top-align so multi-line text hangs correctly */
  font-family: var(--font-mono);
  font-size: 0.7rem;
  
  /* Remove borders - space-between handles separation cleanly now */
  border-bottom: 1px dotted #f3f4f6; 
  padding-bottom: 4px;
}

/* Remove border from the last item so it sits flush */
.risk-row:last-child {
  border-bottom: none;
  padding-bottom: 0;
}

/* Left Side: Facet Label (Icon + Text) */
.risk-facet {
  display: flex;
  align-items: center;
  gap: 8px; /* More space between icon and text */
  color: #111827; /* Gray-900 (Black) - Was Slate-500 */
  font-weight: 700;
  padding-top: 2px; /* Optical alignment with the Status text */
}

.facet-icon svg {
  display: block;
  opacity: 0.6; /* Subtle icons */
  width: 14px;  /* Slightly larger for clarity */
  height: 14px;
}

/* Right Side: Content Container (Fluid) */
.risk-cell-right {
    text-align: right;
    display: flex;
    flex-direction: column;
    gap: 1px;
    
    /* FLUID MECHANICS */
    flex: 1;             /* Grow to fill all empty space in the row */
    min-width: 0;        /* Critical: Allows flex child to shrink below content size */
    margin-left: 8px;    /* Ensure gap between Left Label and Right Text */
}

/* Line 1: Status (PASS / EXTENDED / HIDDEN) */
.risk-status {
  font-weight: 800;
  font-size: 0.75rem; /* Bumped up for readability */
  color: #000000; /* Pure Black */
  letter-spacing: 0.02em;
}
.risk-pass {
  color: #15803D; /* Green-700 (Was Gray Slate-400) */
}
.risk-info {
  color: #0369A1; /* Sky-700 (Matches Level 1 Header) */
}
.risk-warn {
  color: #B45309; /* Amber-700 */
}
.risk-fail {
  color: #111827; /* Gray-900 (Black) */
}

/* Line 2: Detail (The "Why") */
.risk-detail {
    font-family: var(--font-sans);
    font-size: 0.65rem;
    font-weight: 500;
    color: #9CA3AF; /* Muted Gray */
    
    /* SINGLE LINE FLUIDITY */
    white-space: nowrap;     /* No wrapping */
    overflow: hidden;        /* Clip content that doesn't fit */
    text-overflow: ellipsis; /* Add "..." at the end if cut off */
    
    /* Fill the fluid parent */
    width: 100%;
    line-height: 1.2;
    margin-top: 1px;
}

/* Zone C: Evidence Block (Static Footer) */
.risk-footer {
  background-color: #ffffff;
  border-bottom: 1px solid var(--color-border-light);
  /* Fixed height container to prevent jitter */
  min-height: 48px; 
  padding: 8px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.risk-footer-label {
    font-family: var(--font-sans);
    font-size: 0.6rem;
    font-weight: 800;
    margin-bottom: 3px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
}

.risk-footer-content {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    font-weight: 700;
    line-height: 1.2;
    
    /* Handle overflow */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
/* Footer State Colors */

/* Level 0: Neutral/Gray */
.footer-neutral {
    color: #15803D; /* Green for Baseline Analysis */
}

/* Level 1: Info/Blue */
.footer-info {
    color: #3B82F6; /* Blue-500 */
}

/* Level 2-3: Warn/Amber */
.footer-warn {
    color: #B45309; /* Amber-700 */
}

/* Level 4: Crit/Red */
.footer-crit {
    color: #DC2626; /* Red-600 */
}

/* --- Col 5: Identity (Restored Fluid) --- */
.col-identity {
  padding: 1rem;
  display: flex;
  flex-direction: column;
  justify-content: flex-start; /* CRITICAL FIX: Align to top, don't float in the middle */
  overflow-y: auto;
  border-right: 1px solid var(--color-border-light); /* Border restored */
}
.inspector-header {
  flex: 0 0 auto; /* CRITICAL FIX: Never let the header shrink/collapse */
  font-size: 1.1rem;
  font-weight: 700;
  color: var(--color-text);
  margin-bottom: 0.75rem;
  border-bottom: 2px solid var(--color-border-light);
  padding-bottom: 0.25rem;
  white-space: nowrap;
  text-overflow: ellipsis;
  text-align: center; /* CENTERS THE TITLE */
}

/* --- Col 6: Structure (Restored Scroll & Headers) --- */
.col-structure {
  border-right: 1px solid var(--color-border-light); /* Border restored */
  background-color: #fff;
  display: flex;
  flex-direction: column;
}
.section-label {
  font-size: 0.8rem; /* Increased from 0.65rem */
  font-weight: 800;
  color: var(--color-text-muted);
  padding: 8px 10px;  /* Slightly more padding for the larger text */
  background-color: #ffffff; /* Changed from #f1f5f9 to White */
  border-bottom: 1px solid var(--color-border-light);
  text-align: center;
  letter-spacing: 0.02em; /* Slight spacing for readability */
}
.structure-table-wrapper {
  flex-grow: 1;
  overflow-y: auto; /* SCROLL RESTORED */
  height: 100%;
}
.structure-table {
  width: 100%;
  font-size: 0.75rem;
}
.structure-table th, 
.structure-table td {
  text-align: left;
  /* Tighter padding to fit 4 columns in 260px */
  padding: 4px 4px; 
  border-bottom: 1px solid var(--color-border-light);
  white-space: nowrap;
}

/* Optional: Fix the header top position */
.structure-table th {
  background-color: #fff;
  color: var(--color-text-muted);
  font-weight: 600;
  position: sticky;
  top: 0;
  z-index: 2;
}

/* --- Col 7: Bytes (Restored Gray) --- */
.col-bytes {
  color: var(--color-text-muted); /* Changed from #f8fafc */
  display: flex;
  flex-direction: column;
  overflow-y: auto;
  overflow: hidden; /* Fixes the header in place */
}
.byte-grid {
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 0.75rem;
  font-family: var(--font-mono);

  /* SCROLL LOGIC */
  flex: 1;          /* Fill the remaining vertical space */
  overflow: auto;   /* Enable X and Y scrollbars */
  
  /* PREVENT WRAPPING (Forces X-Scroll) */
  white-space: nowrap; 
  word-break: keep-all; 

  color: var(--color-text-muted);
}

/* The "Key:" in "Key: Value" */
.byte-grid .label {
  color: #111827;     /* Dark Gray */
  font-weight: 800;   /* Extra Bold */
  font-size: 0.7rem;
  
  /* THE FIX: Sit on the same line */
  display: inline-block; 
  margin-right: 6px;  /* Spacing between Key and Value */
  margin-bottom: 0;   /* Remove bottom margin */
  
  /* Fixed width ensures alignment (optional, but looks pro) */
  min-width: 45px; 
}

/* Optional: A subtle separator class for the rows */
.byte-row {
    border-bottom: 1px solid #f1f5f9;
    padding-bottom: 2px;
}

/* --- 
   Dynamic Badge Synchronization 
   Matches the Inspector Verdict Colors
--- */

/* Level 0: BASELINE (Green) */
.inspector-codepoint.risk-tier-0 { 
  color: #15803D; 
  border-color: #15803D; 
}

/* Level 1: NON-STD (Blue) */
.inspector-codepoint.risk-tier-1 { 
  color: #0369A1; 
  border-color: #0369A1; 
}

/* Level 2: ANOMALOUS (Yellow/Amber) */
.inspector-codepoint.risk-tier-2 { 
  color: #A16207; 
  border-color: #A16207; 
}

/* Level 3: SUSPICIOUS (Orange) */
.inspector-codepoint.risk-tier-3 { 
  color: #C2410C; 
  border-color: #C2410C; 
}

/* Level 4: CRITICAL (Red) */
.inspector-codepoint.risk-tier-4 { 
  color: #DC2626; 
  border-color: #DC2626; 
  background-color: #FEF2F2; /* Subtle red tint for critical */
}


/* --- Macro Analysis Control --- */
.macro-analysis-control {
  margin-top: 1.5rem;
  padding: 1rem;
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  background: var(--color-bg);
  align-items: center;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.macro-analysis-control .tool-btn {
  flex-grow: 1;
  border-color: var(--color-border);
  background-color: var(--color-white);
  color: var(--color-text);
  font-size: 1.25rem;
}

.macro-analysis-description {
  font-size: 1rem;
  color: var(--color-text-muted);
  line-height: 1.4;
  margin: 0;
  text-align: center;
}

.macro-btn {
  width: 50%;
  background-color: var(--color-primary);
  border-color: var(--color-primary);
  color: var(--color-white);
}

.macro-btn:hover {
  background-color: var(--color-white);
  color: var(--color-primary-focus);
  border-color: var(--color-primary-focus);
}


/* =========================================
   STATUS BAR (Consolidated & Precision Spaced)
   ========================================= */

/* 1. The Main Container */
.status-bar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
  padding: 0;
  margin-top: 0.5rem;
  box-sizing: border-box;
  gap: 15px; /* Ensures space if Left/Right meet in middle */
}

/* 2. Unified Wrappers (Left & Right) */
.status-bar-left, 
.status-bar-right {
  background-color: transparent !important;
  border: none !important;
  padding: 0 !important;
  margin: 0 !important;
  
  /* FORCE FLEX to make 'gap' work */
  display: flex !important;
  align-items: center !important;
  
  /* THE ONLY SOURCE OF TRUTH FOR SPACING */
  gap: 15px !important; 
}

/* 3. SAFETY RESET: Remove ALL margins from buttons/pills inside */
/* This kills the 'margin-right: 1rem' and any other hidden margins */
.status-bar-left > *,
.status-bar-right > * {
  margin: 0 !important; 
}

/* --- Repertoire Card Styling --- */

.card.card-repertoire {
  position: relative; 
  padding-bottom: 2rem; 
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.card-main-value {
  font-size: 2rem; 
  font-weight: 600;
  color: #0d6efd; 
  line-height: 1.2;
  margin-top: 0.5rem;
}

.card-badge-full {
  position: absolute;
  bottom: 8px;
  right: 8px;
  font-size: 0.5rem; /* FIXED: was 0.25rem which is too small */
  font-weight: 600;
  color: #198754; 
  background-color: #e9f7ef; 
  padding: 1px 4px;
  border-radius: 4px;
  border: 1px solid #bbf7d0;
}

.card-percentage {
  position: absolute;
  bottom: 8px;
  right: 8px;
  font-size: 0.5rem;
  font-weight: 600;           /* Slightly bolder to read */
  color: var(--color-primary); /* Uses your App's Blue (#2563eb) */
  background-color: #eff6ff;   /* Very light blue background */
  padding: 1px 5px;            /* Slightly wider */
  border-radius: 4px;
  border: 1px solid #bfdbfe;   /* Light blue border */
}

/* --- Integrity Badge Styling --- */

.integrity-badge {
  font-size: 0.7rem;
  font-weight: 600;
  padding: 3px 7px;
  border-radius: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  display: inline-block;
}

.integrity-badge-ok {
  color: #198754; 
  background-color: #e9f7ef;
}

.integrity-badge-warn {
  color: #ffc107; 
  background-color: #fff9e6;
  border: 1px solid #ffecb3;
}

.integrity-badge-crit {
  color: #dc3545; 
  background-color: #fdebee;
}

/* Special styling for critical flag rows */
.matrix .flag-row-critical th {
  color: #dc3545;
  font-weight: 600;
}

/* Position Links in Matrix Tables */
.pos-link {
    font-family: var(--font-mono);
    color: var(--color-primary);
    text-decoration: none;
    border-bottom: 1px dotted var(--color-primary);
    transition: all 0.1s ease;
    margin-right: 1px;
}

.pos-link:hover {
    background-color: var(--color-primary);
    color: var(--color-white);
    border-bottom: none;
    border-radius: 2px;
    cursor: zoom-in; 
}

.pos-link:focus {
    outline: 2px solid var(--color-primary-focus);
    outline-offset: 1px;
}

/* Row Styling for the "Integrity Level" Header */
tr.flag-row-ok {
  background-color: #f0fdf4; 
}
tr.flag-row-warn {
  background-color: #fffbeb; 
}
tr.flag-row-crit {
  background-color: #fef2f2; 
}


/* =========================================
   FORENSIC LEDGER STYLES (Threat & Integrity)
   ========================================= */

/* Container & Summary Styling */
.threat-ledger-details summary,
.integrity-ledger-details summary { /* Assuming you add this class to Integrity details */
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 650;
  color: #000000;
  display: list-item; /* This forces the native browser triangle to appear */
  /* 3. ALIGNMENT FIX (Stop Levitation) */
  margin: 0;           /* Remove default vertical margins */
  padding-top: 4px;    /* Slight nudge to align with badge */
  padding-bottom: 4px;

  user-select: none;
  transition: opacity 0.2s ease;
}

.threat-ledger-details summary:hover,
.integrity-ledger-details summary:hover {
  color: var(--color-primary);
}

/* Optional: Give the triangle a bit more breathing room */
.threat-ledger-details summary::marker,
.integrity-ledger-details summary::marker {
  color: #000000; /* Ensure arrow is also black */
  font-size: 0.8em;
}
/* The Table Frame */
.threat-ledger-table,
.integrity-ledger-table {
  width: 100%;
  max-width: 650px; /* Slightly wider for readability */
  border-collapse: separate; /* Allows border-radius on rows */
  border-spacing: 0;
  font-size: 0.85rem;
  background-color: var(--color-white);
  border: 1px solid var(--color-border-light);
  border-radius: 6px;
  margin-top: 0.25rem;
  box-shadow: 0 2px 4px rgba(0,0,0,0.03), 0 1px 0 rgba(0,0,0,0.02);
  overflow: hidden; /* Clips the corners */
}

/* Header Styling */
.threat-ledger-table th,
.integrity-ledger-table th {
  text-align: left;
  padding: 8px 16px; /* More breathing room */
  background-color: #f8f9fa; /* Very subtle gray */
  color: var(--color-text-muted);
  font-weight: 700;
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  border-bottom: 1px solid var(--color-border);
}

/* Cell Styling */
.threat-ledger-table td,
.integrity-ledger-table td {
  padding: 8px 16px;
  border-bottom: 1px solid var(--color-border-light);
  vertical-align: middle;
  color: var(--color-text);
  transition: background-color 0.15s ease;
}

/* Row Hover Effect (The "Active Scan" feel) */
.threat-ledger-table tr:hover td,
.integrity-ledger-table tr:hover td {
  background-color: #f9fafb;
}

/* Last row cleanup */
.threat-ledger-table tr:last-child td,
.integrity-ledger-table tr:last-child td {
  border-bottom: none;
}

/* Column 1: The Vector (Primary Data) */
.threat-ledger-table td:first-child,
.integrity-ledger-table td:first-child {
  font-weight: 500;
  color: #1f2937; /* Gray-900 */
}

/* Column 2: Severity Badge Container (Centered & Shrink-wrapped) */
.threat-ledger-table td:nth-child(2),
.integrity-ledger-table td:nth-child(2) {
  width: 1%;
  white-space: nowrap;
  text-align: center;
  padding-left: 8px;
  padding-right: 8px;
}

/* Refined Badge Look inside Ledger */
.threat-ledger-table .integrity-badge,
.integrity-ledger-table .integrity-badge {
  font-size: 0.65rem;
  padding: 2px 6px;
  border-radius: 4px;
  letter-spacing: 0.02em;
  border: 1px solid transparent; /* Adds definition */
}

/* Column 3: The Score (The Math) */
.score-val {
  font-family: var(--font-mono);
  font-weight: 700;
  text-align: right;
  color: #b91c1c; /* Red-700 */
  width: 1%; /* Align tight to right */
  white-space: nowrap;
  font-variant-numeric: tabular-nums; /* Aligns numbers vertically */
}

/* Noise Rows (Filtered Data) */
.ledger-noise td {
  background-color: #fdfdfd; /* Almost white */
  color: #9ca3af; /* Gray-400 - very muted */
  font-style: italic;
  font-size: 0.8rem;
  border-top: 1px dashed var(--color-border-light); /* Distinctive separator */
}

.ledger-noise .integrity-badge {
  opacity: 0.7;
  filter: grayscale(100%); /* De-emphasize badges in noise rows */
}

/* --- Integrity Ledger (Data Health Receipt) --- */

.integrity-ledger-table {
  width: 100%;
  max-width: 600px;
  border-collapse: collapse;
  font-size: 0.85rem;
  background-color: var(--color-white);
  border: 1px solid var(--color-border);
  border-radius: 4px;
  margin-top: 0.5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

.integrity-ledger-table th {
  text-align: left;
  padding: 4px 10px;
  background-color: #f3f4f6; /* Gray-100 */
  color: var(--color-text-muted);
  font-weight: 700;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid var(--color-border);
}

.integrity-ledger-table td {
  padding: 4px 10px;
  border-bottom: 1px solid var(--color-border-light);
  vertical-align: middle;
}

.integrity-ledger-table tr:last-child td {
  border-bottom: none;
}

/* Score Value Column */
.integrity-ledger-table .score-val {
  font-family: var(--font-mono);
  font-weight: 700;
  text-align: right;
  color: #b91c1c;
}

/* --- FORENSIC SPEC SHEET V2 (UTS #39 Compliant) --- */

/* 1. IDENTITY CAPSULE (Chips) */
.spec-capsule {
  display: flex;
  flex-wrap: wrap;
  gap: 0.35rem;
  margin: 0.35rem 0 0.75rem 0;
}

.spec-chip {
  display: inline-flex;
  align-items: center;
  height: 18px;
  padding: 0 6px;
  border-radius: 4px; /* Techy box look, not pill */
  font-size: 0.65rem;
  font-weight: 700;
  font-family: var(--font-mono);
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

.spec-chip.codepoint {
  background-color: #111827;
  color: #fff;
}

.spec-chip.category {
  background-color: #e5e7eb;
  color: #374151;
  border: 1px solid #d1d5db;
}

.spec-chip.block {
  background-color: #eff6ff;
  color: #1d4ed8;
  border: 1px solid #bfdbfe;
}

.spec-chip.ascii {
  background-color: #ecfdf5;
  color: #047857;
  border: 1px solid #a7f3d0;
}

/* 2. SPEC ROWS (Enhanced) */
.spec-group {
  display: flex;
  flex-direction: column;
  gap: 2px; /* Tight stacking */
}

.spec-sub {
  color: #9ca3af;
  font-weight: 400;
  font-size: 0.7rem;
  margin-left: 4px;
}

/* ID Status Colors */
.id-status-allowed { color: #15803d; font-weight: 700; }
.id-status-restricted { color: #b91c1c; font-weight: 700; }
.id-status-technical { color: #a16207; font-weight: 700; }

/* 3. CALM MATRIX (Layout Grid) */
.spec-matrix {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 0.75rem;
  background-color: #ffffff;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #f3f4f6;
}

.matrix-item {
  display: flex;
  flex-direction: column;
  padding: 8px 12px; /* Add internal breathing room */
  /* Add internal borders */
  align-items: center; /* CENTERS ITEMS HORIZONTALLY */
  text-align: center;  /* CENTERS TEXT */
  border-bottom: 1px solid var(--color-border-light);
  border-right: 1px solid var(--color-border-light);
}

/* Remove borders from edge items to avoid double lines */
.matrix-item:nth-child(2n) {
    border-right: none; /* Right items have no right border */
}

.matrix-item:nth-last-child(-n+2) {
    border-bottom: none; /* Bottom items have no bottom border */
}

.matrix-val {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  font-weight: 700;
  color: #1f2937; /* Dark Neutral (Calm) */
  line-height: 1.2;
}

.matrix-sub {
  font-family: var(--font-sans);
  font-size: 0.6rem;
  font-weight: 500;
  color: #9ca3af; /* Muted Label */
  margin-top: 1px;
  text-transform: none; /* Allow mixed case for descriptions */
}

/* --- HUD v3 EXTENSIONS --- */

/* Ghost Strip (Normalization Chain) */
.ghost-section {
  margin-top: 10px;
  background-color: #ffffff;
  border: 2px solid #ffedd5;
  border-radius: 4px;
  padding: 8px;
  /* CENTER CONTENT */
  justify-content: center;
  text-align: center;
  gap: 10px; /* Space between Label and Value */
}

/* Style for the "STABLE" label specifically */
/* Specific Override for "Stable" State (Pure White + Gray Border) */
.ghost-section.stable {
  background-color: #ffffff;
  border-color: #e5e7eb; /* Neutral Gray Border */
  border: 1px solid #e5e7eb;
  gap: 10px;
  
}
/* "NORMALIZATION:" (Black) */
.ghost-key {
  color: #000000; /* Dark Black/Gray */
  font-weight: 600;
  font-size: 0.75rem;
  letter-spacing: 0.05em;
}

/* "STABLE" (Green) */
.ghost-val-ok {
  color: #16a34a; /* Bright Green */
  font-weight: 700;
  font-size: 0.75rem;
  letter-spacing: 0.05em;
}
.ghost-section .spec-label {
    margin-bottom: 0;
    color: #000000; 
    font-weight: 600;
    background-color: #ffffff;
    font-size: 0.75rem;
    letter-spacing: 0.05em;
}
.ghost-strip {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-family: var(--font-mono);
  width: 100%; /* Ensure strip fills container */
}
.ghost-step {
  text-align: center;
  font-size: 0.6rem;
  color: #9a3412; /* Dark Orange */
  font-weight: 700;
}
.ghost-step span {
  display: block;
  font-size: 1rem;
  margin-top: 2px;
  color: #000;
}
.ghost-arrow {
  color: #cbd5e1;
  font-size: 1.5rem;
}

/* --- Lookalikes Section (Blue Frame) --- */

/* Override for "Lookalikes" State (Blue Border) */
.ghost-section.lookalikes {
  background-color: #ffffff;
  /* Blue border matching "NOTE" level */
  border: 1px solid #bfdbfe; 
  gap: 8px;
  
  /* Allow wrapping if there are many lookalikes */
  flex-wrap: wrap;
}

/* Label Color (Dark Blue) */
.ghost-key.blue {
  color: #0369a1; /* Sky-700 */
}

/* Value List Styling */
.lookalike-list {
  font-family: var(--font-sans); /* Use Sans for clarity, or Mono if preferred */
  font-size: 0.8rem;
  color: #334155; /* Slate-700 */
  line-height: 1.4;
  font-weight: 500;
  word-break: break-all; /* Prevent layout break on massive lists */
}

/* --- Lookalike Chips (High Density) --- */

.lookalike-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  justify-content: center;
  width: 100%;
  margin-top: 4px;
}

.lookalike-chip {
  display: inline-flex;
  align-items: center;
  background-color: #ffffff;
  border: 1px solid #cbd5e1; /* Slate-300 */
  border-radius: 4px;
  padding: 3px 6px;
  gap: 8px;
  text-decoration: none;
  transition: all 0.2s;
  cursor: help;
}

.lookalike-chip:hover {
  background: #f1f5f9;
  border-color: #94a3b8;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* The Glyph (Visual) */
.lk-glyph {
  font-family: var(--font-mono); /* Use system fonts to ensure rendering */
  font-size: 1.2rem;
  line-height: 1;
  color: #0f172a; /* Slate-900 */
}

/* The Meta Data (Technical) */
.lk-meta {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  line-height: 1;
  gap: 2px;
}

.lk-cp {
  font-size: 0.65rem;
  font-weight: 700;
  color: #334155; /* Slate-700 */
  font-family: var(--font-mono);
}

.lk-script {
  font-size: 0.55rem;
  text-transform: uppercase;
  color: #64748b; /* Slate-500 */
  font-weight: 700;
  letter-spacing: 0.03em;
}


/* --- Dynamic Risk Borders for Lookalikes --- */

/* Default / Note (Blue) - Matches risk-info */
.ghost-section.lookalikes.risk-info {
  border-color: #bfdbfe; /* Blue-200 */
}
.ghost-section.lookalikes.risk-info .ghost-key {
  color: #0369a1; /* Sky-700 */
}

/* Suspicious / Ambiguous (Orange) - Matches risk-warn */
.ghost-section.lookalikes.risk-warn {
  border-color: #fed7aa; /* Orange-200 */
  background-color: #ffffff;
}
.ghost-section.lookalikes.risk-warn .ghost-key {
  color: #c2410c; /* Orange-700 */
}

/* Critical (Red) - Matches risk-fail */
.ghost-section.lookalikes.risk-fail {
  border-color: #fecaca; /* Red-200 */
  background-color: #ffffff;
}
.ghost-section.lookalikes.risk-fail .ghost-key {
  color: #b91c1c; /* Red-700 */
}

/* =========================================
   FORENSIC HUD (The Data Matrix - V7 Scientific)
   ========================================= */

.hud-container {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  gap: 0; 
  margin-top: 1rem;
  
  /* MERGED BOTTOM: Remove margin/radius to attach to console */
  margin-bottom: 0; 
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
  border-bottom: none; 
  
  background-color: var(--color-white);
  border: 1px solid var(--color-border);
  
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  font-family: var(--font-sans);
  
  /* Visible overflow allows for potential future tooltips if needed */
  overflow: visible !important; 
  
  position: relative;
  z-index: 50;
  width: 100%;
}

/* --- HUD CONSOLE (Structured Grid) --- */
.hud-console-strip {
  display: flex;
  flex-direction: column;
  justify-content: center;
  width: 100%;
  height: 54px;
  padding: 0; /* Padding handled by cells now */
  gap: 0;
  
  background-color: #fafafa; /* Ultra-light Gray (almost white) */
  border: 1px solid var(--color-border);
  border-top: 1px solid var(--color-border);
  border-radius: 0;
  
  margin-bottom: 1.5rem;
  font-family: var(--font-mono);
  font-size: 0.7rem;
}

.console-row {
  display: flex;
  align-items: center;
  width: 100%;
  height: 50%;
  border-bottom: 2px solid #f3f4f6; /* Separator between Primary/Secondary */
}

.console-row:last-child {
  border-bottom: none;
}

/* --- CONSOLE CELLS (The 2:1:1 Ratio) --- */
.c-cell-def {
  flex: 2; /* 50% width */
  display: flex;
  align-items: center;
  padding: 0 12px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  
}

.c-cell-meta {
  flex: 1; /* 25% width */
  display: flex;
  align-items: center;
  padding: 0 12px;
  border-left: 1px solid #e5e7eb; /* Vertical Dividers */
  color: #6b7280;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}

/* --- TEXT STYLING --- */
.console-key {
  font-weight: 800;
  font-size: 0.6rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-right: 8px;
  min-width: 50px; /* Fixed width for alignment */
  color: #cbd5e1;
}

.console-val {
  font-weight: 500;
  color: var(--color-text);
  color: #cbd5e1;
}

/* Primary Row Colors */
#console-row-primary .console-key { 
  color: #374151;    /* <--- Darker Gray (High Contrast) */ 
  font-weight: 900;
}
#console-row-primary .console-val { 
  color: #6b7280; 
}

/* Secondary Row Colors */
#console-row-secondary .console-key { 
  color: #374151;    /* <--- Darker Gray (High Contrast) */ 
  font-weight: 900;
}
#console-row-secondary .console-val { 
  color: #6b7280; 
}

.console-label {
  font-weight: 800;
  font-size: 0.6rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  min-width: 40px; /* Alignment anchor */
  text-align: right;
  user-select: none;
}

.console-content {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-grow: 1;
}

.console-meta {
  margin-left: auto;
  font-size: 0.65rem;
  font-weight: 500;
}
#console-row-main .console-meta { color: #b45309; } /* Amber */
#console-row-sub  .console-meta { color: #9ca3af; } /* Gray */


/* --- HUD TEXT UTILITIES (Zero-State Logic) --- */
.txt-normal { color: var(--color-text); }
.txt-muted  { color: #d1d5db; } /* Gray for 0 values */
.txt-good   { color: #059669; } /* Deep Emerald for Critical Safety (Integrity/Threat) */
.txt-clean  { color: #bef4db; } /* Light Green for 0 Anomalies */
.txt-warn   { color: #d97706; } /* Orange for >0 risks */
.txt-crit   { color: #dc2626; } /* Red for critical risks */
.txt-safe   { color: #059669; } /* Deep Emerald for Safe Status */


/* --- HUD COLUMNS (9-Column Layout) --- */
.hud-col {
  display: flex;
  flex-direction: column;
  justify-content: space-between; 
  padding: 6px 4px;
  border-right: 1px solid var(--color-border-light);
  text-align: center;
  position: relative;
  /* Force equal width distribution */
  flex: 1 1 0px;
  min-width: 0;
}

.hud-col:last-child {
  border-right: none;
}

/* --- ROW EQUALIZATION --- */
/* Scientific Header */
.hud-row-sci {
  background-color: #ffffff;
  color: #6b7280;
  
  /* Bigger & Thicker */
  font-size: 0.65rem; 
  font-weight: 800; 
  
  /* Alignment: Center Middle */
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  
  /* Spacing */
  padding: 8px 4px; /* Increased padding for vertical centering */
  border-bottom: 1px solid #e5e7eb;
  margin-bottom: 4px;
  
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Metric Groups (Main & Sub are identical) */
.hud-metric-group {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1; 
  min-height: 2.5em; /* Prevent collapse on empty */
}

.hud-label {
  font-size: 0.6rem;
  font-weight: 750;
  color: #9ca3af;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 0;
  line-height: 1;
}

.hud-val {
  font-size: 1.1rem; /* UNIFIED SIZE */
  font-weight: 700;
  line-height: 1.2;
  font-variant-numeric: tabular-nums;
}

/* Subtle separator between Main and Sub groups */
.hud-metric-divider {
  width: 40%;
  height: 1px;
  background-color: #f3f4f6;
  margin: 3px auto;
}

/* Remove old classes to prevent conflicts */
.hud-row-extra { display: none !important; }




/* --- Collapsible Masthead --- */

/* Ensure the details container spans the full width to keep centering working */
.masthead-details {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Style the Title as a Button */
.masthead-details summary {
  list-style: none; /* Hide standard arrow */
  cursor: pointer;
  user-select: none; /* Prevent text selection when clicking rapidly */
  outline: none;
}

/* Hide Webkit standard arrow (Chrome/Safari) */
.masthead-details summary::-webkit-details-marker {
  display: none;
}

/* Add a visual interaction hint on hover */
.masthead-details summary:hover .app-title {
  color: var(--color-primary); /* Turns blue on hover */
  opacity: 0.8;
}

/* Optional: Smooth transition for the color change */
.app-title {
  transition: color 0.2s ease;
}


/* --- Profile Section Alignment & Visuals (Native Firefox Arrow) --- */
/* --- Section Title Icons --- */
.section-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
  color: var(--color-primary); /* Make it Pop */
  opacity: 0.8;
  vertical-align: middle;
  transform: translateY(-1px); /* Optical alignment */
}


/* --- Highlight/Deobfuscate Buttons (Pill Shape) --- */
#btn-reveal,
#btn-reveal2 {
  border-radius: 999px; /* Fully rounded pill shape */
  padding-left: 0.75rem;
  padding-right: 0.75rem;
  font-size: 0.75rem; /* Slightly smaller text for elegance */
  letter-spacing: 0.03em;
  background-color: #ffffff; /* White background */
  border-color: #d1d5db;     /* Light Gray border */
  color: #000000;            /* Black text */
  text-transform: none;      /* Standard casing (not all caps) */
  font-weight: 600;
  margin-right: 0; /* Ensures it touches the right edge */
}
/* --- Special Forensic Reveal Buttons (Violet Hover) --- */
#btn-reveal:hover,
#btn-reveal2:hover {
    border-color: #7c3aed;       /* Rigorous Violet Border */
    color: #7c3aed;              /* Rigorous Violet Text */
    background-color: #f5f3ff;   /* Very subtle lavender tint */
    cursor: pointer;
}

/* --- Fix Right Alignment & Spacing --- */

/* 1. Push the text to the far right and remove its right-side gap */
#reveal-details {
    margin-left: auto;   /* Forces the element to the far right of the flex container */
    margin-right: 0em;  
}

/* =========================================
   FORENSIC ENCODING STRIP (The "14" Row)
   ========================================= */

.encoding-strip {
  display: flex;
  width: 100%;
  height: 50px; /* Compact height */
  overflow-x: auto; /* Horizontal Scroll enabled */
  overflow-y: hidden;
  background-color: #ffffff;
  border: 1px solid var(--color-border);
  border-top: none; /* Merge with console above */
  
  /* Scrollbar styling for sleek look */
  scrollbar-width: thin;
  scrollbar-color: #e5e7eb transparent;
}

.encoding-strip::-webkit-scrollbar {
  height: 4px;
}
.encoding-strip::-webkit-scrollbar-thumb {
  background-color: #e5e7eb;
  border-radius: 4px;
}

/* Individual Cell */
.enc-cell {
  flex: 0 0 auto; /* Don't shrink, fixed width based on content */
  min-width: 85px; /* Ensure enough space for labels */
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border-right: 1px solid #f3f4f6;
  padding: 0 8px;
  font-family: var(--font-mono);
  transition: background-color 0.2s;
}

.enc-cell:last-child {
  border-right: none;
  background-color: #f9fafb; /* Slight tint for "Other" */
}

/* Upper Row: Label */
.enc-label {
  font-size: 0.6rem;
  font-weight: 700;
  color: #6b7280;
  margin-bottom: 2px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
}

/* Lower Row: Value */
.enc-val {
  font-size: 0.85rem;
  font-weight: 700;
}

/* Status Colors (Forensic Signals) */
.enc-safe { color: #15803d; background-color: #f0fdf4; width: 100%; text-align: center; } /* 100% */
.enc-risk { color: #b45309; } /* 1-99% */
.enc-dead { color: #d1d5db; opacity: 0.6; } /* 0% */

/* Hover effect for inspection */
.enc-cell:hover {
  background-color: #f3f4f6;
  cursor: help;
}

/* =========================================
   FORENSIC ENCODING DASHBOARD v6.0
   ========================================= */

.encoding-dashboard {
  display: flex;
  width: 100%;
  height: 58px;
  background-color: #ffffff;
  
  /* 1. Force a solid, visible border on ALL sides (Darker Gray) */
  border: 1px solid var(--color-border); 
  
  /* 2. Ensure top border is NOT removed */
  border-top-width: 1px;
  border-top-style: solid;
  border-top-color: var(--color-border); 
  
  /* 3. Alignment Tweaks */
  /* -1px pulls it up to overlap the console's bottom border slightly, 
     creating a clean single line instead of a double-thick one. */
  margin-top: -1px; 
  
  /* 4. Ensure it sits on top of any background overlap */
  position: relative;
  z-index: 5;
  
  font-family: var(--font-mono);
}

/* --- LEFT: Integrity Panel (Static) --- */
.enc-integrity-panel {
  display: flex;
  flex: 0 0 auto; /* Fixed width based on content */
  border-right: 2px solid var(--color-border-light); /* Strong divider */
  background-color: #fafafa;
}

/* --- RIGHT: Provenance Strip (Scrollable) --- */
.enc-provenance-strip {
  display: flex;
  flex: 1; /* Takes remaining space */
  overflow-x: auto;
  overflow-y: hidden;
  
  /* Scrollbar styling */
  scrollbar-width: thin;
  scrollbar-color: #e5e7eb transparent;
}

.enc-provenance-strip::-webkit-scrollbar {
  height: 4px;
}
.enc-provenance-strip::-webkit-scrollbar-thumb {
  background-color: #e5e7eb;
  border-radius: 4px;
}

/* --- UNIVERSAL CELL STYLES --- */
.enc-cell {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 0 8px;
  min-width: 90px;
  border-right: 1px solid #f3f4f6;
  position: relative; /* For absolute badges if needed */
  transition: background-color 0.2s;
}

.enc-cell:hover {
  background-color: #f3f4f6;
  cursor: help;
}

/* Labels */
.enc-label {
  font-size: 0.6rem;
  font-weight: 700;
  color: #6b7280;
  margin-bottom: 2px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Exclusivity Badge (Diamond) */
.enc-badge-unique {
  color: #d97706; /* Amber */
  font-size: 0.7rem;
}

/* --- DUAL METRIC ROW --- */
.enc-metrics {
  display: flex;
  align-items: baseline;
  gap: 6px;
  line-height: 1;
}

/* Primary Value (Total) */
.enc-val-primary {
  font-size: 0.9rem;
  font-weight: 700;
}

/* Secondary Value (Signal) */
.enc-val-secondary {
  font-size: 0.65rem;
  font-weight: 500;
  color: #9ca3af;
}

/* Status Colors */
.status-safe { color: #15803d; } /* Green */
.status-risk { color: #b45309; } /* Orange */
.status-dead { color: #d1d5db; } /* Gray */
.status-uniq { color: #d97706; } /* Exclusive Amber */

/* Integrity Anchor Specifics */
.enc-integrity-panel .enc-cell {
  background-color: #fafafa;
  min-width: 70px;
}

/* --- Forensic Synthesis Row (The Explanation) --- */
.enc-synthesis-row {
  background-color: #f8fafc;
  border: 1px solid var(--color-border);
  border-top: none;
  /* TIGHTER PADDING: Was 12px 16px */
  padding: 6px 12px; 
  font-family: var(--font-sans);
  /* SMALLER FONT: Was 0.9rem */
  font-size: 0.8rem;
  color: var(--color-text);
  display: flex;
  align-items: center;
  gap: 10px;
  border-radius: 0; /* No radius (Legend attaches below) */
}

/* Badge Styles for the Synthesis */
.syn-badge {
  /* SMALLER BADGE TEXT: Was 0.75rem */
  font-size: 0.7rem;
  font-weight: 700;
  text-transform: uppercase;
  /* TIGHTER BADGE PADDING: Was 4px 10px */
  padding: 2px 8px;
  border-radius: 4px;
  letter-spacing: 0.05em;
  white-space: nowrap;
}

.syn-universal { background-color: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }
.syn-modern    { background-color: #eff6ff; color: #1d4ed8; border: 1px solid #bfdbfe; }
.syn-match     { background-color: #fffbeb; color: #b45309; border: 1px solid #fcd34d; }
.syn-critical  { background-color: #fef2f2; color: #b91c1c; border: 1px solid #fca5a5; }

/* The Text Explanation */
.syn-text {
  line-height: 1.3; /* Tighter line height */
  flex-grow: 1;
}

.syn-text strong {
  font-weight: 600;
  color: #111827;
}

/* --- v10.0 Progressive Disclosure Styles --- */

/* ASCII Baseline Badge */
.enc-val-baseline {
  font-size: 0.65rem;
  font-weight: 700;
  color: #6b7280; /* Gray-500 */
  background-color: #f3f4f6; /* Gray-100 */
  padding: 1px 6px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  letter-spacing: 0.03em;
}

/* "Show More" Expand Button */
.enc-expand-btn {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-width: 60px;
  padding: 0 12px;
  cursor: pointer;
  background-color: #f9fafb;
  border-left: 1px dashed #d1d5db;
  color: #6b7280;
  font-size: 0.75rem;
  font-weight: 600;
  transition: all 0.2s;
}

.enc-expand-btn:hover {
  background-color: #f3f4f6;
  color: #374151;
}

/* Hidden Class for Low-Signal Items */
.enc-hidden {
  display: none !important;
}

/* =========================================
   FORENSIC LEGEND (Collapsible & Responsive)
   ========================================= */

.enc-legend-wrapper {
  background-color: #f9fafb;
  border: 1px solid var(--color-border);
  border-top: 1px dashed var(--color-border-light);
  border-radius: 0 0 var(--radius) var(--radius);
  margin-top: -1px; /* Merge borders */
  overflow: hidden; /* Contain the sliding content */
}

/* The Clickable Toggle Bar */
.legend-header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 16px;
  background: none;
  border: none;
  cursor: pointer;
  color: #6b7280; /* Muted text */
  font-family: var(--font-sans);
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: background-color 0.2s, color 0.2s;
}

.legend-header:hover {
  background-color: #f3f4f6;
  color: var(--color-primary);
}

.legend-icon {
  font-size: 0.65rem;
  transition: transform 0.2s ease;
}

/* Rotate arrow when open */
.legend-header[aria-expanded="true"] .legend-icon {
  transform: rotate(180deg);
}

/* The Content Panel */
.enc-legend-panel {
  display: grid;
  /* Responsive Grid: Fit as many as possible, min 220px wide */
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  padding: 16px;
  border-top: 1px solid var(--color-border-light);
  background-color: #ffffff;
  
  /* Hidden State */
  display: none; 
}

/* Show when active (JS toggles 'hidden' attribute, but we use class for grid) */
.enc-legend-panel.active {
  display: grid;
}

/* Column Styling */
.legend-col {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.legend-title {
  font-weight: 800;
  font-size: 0.65rem;
  color: #9ca3af; /* Light Gray Headers */
  text-transform: uppercase;
  letter-spacing: 0.05em;
  border-bottom: 1px solid #f3f4f6;
  padding-bottom: 4px;
  margin-bottom: 4px;
}

/* Item Typography */
.legend-item {
  font-size: 0.75rem;
  color: #4b5563; /* Softer Gray for body text */
  line-height: 1.4;
}

/* Inline Highlights */
.highlight-text {
  color: #111827;
  font-style: normal;
  font-weight: 600;
}

.leg-key {
  font-weight: 700;
  color: #374151;
  font-family: var(--font-mono);
}

/* Badges (Smaller & Softer) */
.leg-badge {
  display: inline-block;
  font-weight: 700;
  padding: 0 5px;
  border-radius: 3px;
  font-size: 0.65rem;
  min-width: 35px;
  text-align: center;
  margin-right: 6px;
  border: 1px solid transparent;
}

.leg-icon {
  color: #d97706;
  font-weight: bold;
  margin-right: 4px;
}

/* --- Status Colors v12 --- */
.status-safe     { color: #15803d; background-color: #f0fdf4; } /* Green (Candidate) */
.status-risk     { color: #b45309; background-color: #fffbeb; } /* Orange (Partial) */
.status-dead     { color: #9ca3af; background-color: #f3f4f6; } /* Gray (Incompatible) */
.status-uniq     { color: #b45309; background-color: #fffbeb; border-bottom: 3px solid #d97706; } /* Unique */
.status-modern   { color: #7c3aed; background-color: #f5f3ff; font-weight: 800; } /* Violet (Uni-Only) */

/* NEW: Blue Baseline (Safe but Reference) */
.status-baseline { 
    color: #2563eb; 
    background-color: #eff6ff; 
    border: 1px solid #bfdbfe; 
    padding: 1px 6px;
    border-radius: 999px;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.03em;
}

/* Legend Badges to match */
.leg-green    { color: #15803d; background: #f0fdf4; border: 1px solid #bbf7d0; }
.leg-orange   { color: #b45309; background: #fffbeb; border: 1px solid #fcd34d; }
.leg-gray     { color: #9ca3af; background: #f3f4f6; border: 1px solid #e5e7eb; }
.leg-blue     { color: #2563eb; background: #eff6ff; border: 1px solid #bfdbfe; }
.leg-violet   { color: #7c3aed; background: #f5f3ff; border: 1px solid #ddd6fe; }

/* =========================================
   INTERACTIVE HUD METRICS (Stepper)
   ========================================= */

.hud-interactive {
  cursor: pointer;
  border-bottom: 2px dotted currentColor; /* Visual hint */
  transition: all 0.15s ease-in-out;
  position: relative;
  z-index: 10;
}

/* Hover Effects */
.hud-interactive:hover {
  transform: scale(1.1);
  z-index: 20;
}

/* Click Feedback */
.hud-interactive:active {
  transform: scale(0.95);
}

/* Risk-Specific Tints (On Hover) */
.hud-interactive-risk:hover {
  color: #d97706; /* Amber */
  background-color: #fffbeb;
  box-shadow: 0 0 0 4px #fffbeb; /* Faux padding */
  border-radius: 2px;
  border-bottom-style: solid;
}

.hud-interactive-crit:hover {
  color: #dc2626; /* Red */
  background-color: #fef2f2;
  box-shadow: 0 0 0 4px #fef2f2; /* Faux padding */
  border-radius: 2px;
  border-bottom-style: solid;
}

/* =========================================
   INTERACTIVE HUD METRICS (Stepper)
   ========================================= */

/* The Base Interactive Class */
.hud-interactive {
  cursor: pointer;
  border-bottom: 2px dotted currentColor; /* Visual hint: "I am actionable" */
  transition: all 0.15s ease-in-out;
  position: relative;
  z-index: 10;
}

/* Hover Effects (Scale Up) */
.hud-interactive:hover {
  transform: scale(1.1);
  z-index: 20;
  border-bottom-style: solid; /* Solid line on hover */
}

/* Click Feedback (Press Down) */
.hud-interactive:active {
  transform: scale(0.95);
}

/* --- Risk-Specific Tints (On Hover) --- */

/* Amber Tint for Warnings (e.g. Non-Std Whitespace) */
.hud-interactive-risk:hover {
  color: #d97706; /* Amber-600 */
  background-color: #fffbeb; /* Amber-50 */
  box-shadow: 0 0 0 4px #fffbeb; /* Faux padding bloom */
  border-radius: 2px;
}

/* Red Tint for Criticals (e.g. Threat, Integrity) */
.hud-interactive-crit:hover {
  color: #dc2626; /* Red-600 */
  background-color: #fef2f2; /* Red-50 */
  box-shadow: 0 0 0 4px #fef2f2; /* Faux padding bloom */
  border-radius: 2px;
}

/* --- HUD Stepper Status (Center-Left) --- */

/* Active State (Blue/Indigo Theme) */
.status-hud-active {
  background-color: #fffbeb; /* Amber-50 */
  color: #000000;            /* PURE BLACK TEXT */
  border-color: #fcd34d;     /* Amber-300 (The Orange Border) */
  
  /* Visibility Logic */
  display: inline-flex !important;
  opacity: 1;
  visibility: visible;
}

/* Ensure the icon inside matches the border color (Dark Orange) */
.status-hud-active svg {
  stroke: #d97706; 
}



/* =========================================
   UNIFIED ACTIONS PANEL & WORKBENCH (Compact & Centered)
   ========================================= */

/* 1. The "Actions" Toggle Button (Violet Theme - FIXED) */
#actions-panel-wrapper > summary {
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* Positioning */
    width: fit-content;
    
  /* CHANGED: -10px (Top), Auto (Right), 4px (Bottom gap), Auto (Left) */
    margin: -10px auto 4px auto;
    
    /* STYLE: Transparent + Violet Border */
    background-color: transparent;
    border: 1px solid #8b5cf6;
    color: #7c3aed !important; 
    
    /* SIZE: Padding controls the size now. */
    padding: 3px 24px; 
    /* removed height: ... let padding handle it */
    border-radius: 8px;
    
    list-style: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

/* 2. NEW: Wrapper Spacing Logic (The "Pick Up" Fix) */
/* This targets the <details> container itself */
#actions-panel-wrapper {
    /* Pulls the next section (HUD) up significantly to sit under the button */
    /* This eats into the page's default 2rem gap */
    margin-bottom: -1.5rem; 
}

/* SAFETY: When you click to OPEN the panel, restore space so it fits */
#actions-panel-wrapper[open] {
    margin-bottom: 0;
}

/* This targets the <h2> or text inside the button specifically */
#actions-panel-wrapper > summary .section-title,
#actions-panel-wrapper > summary h2 {
    border: none !important;     /* REMOVES THE HORIZONTAL LINE */
    margin: 0 !important;        /* REMOVES THE EMPTY SPACE BELOW */
    padding: 0 !important;       /* REMOVES ANY EXTRA PADDING */
    
    font-size: 0.8rem !important;
    font-weight: 800 !important;
    color: #7c3aed !important;   /* Violet Text */
    line-height: 1 !important;   /* Ensures text sits tight */
}

/* Hide the default triangle */
#actions-panel-wrapper > summary::-webkit-details-marker { display: none; }

/* Hover State */
#actions-panel-wrapper > summary:hover {
    background-color: #f5f3ff; 
    border-color: #7c3aed;     
    transform: translateY(-1px);
    box-shadow: 0 1px 3px rgba(124, 58, 237, 0.15);
}

#actions-panel-wrapper > summary:hover .section-title,
#actions-panel-wrapper > summary:hover h2 {
    color: #6d28d9 !important; /* Darker Violet on Hover */
}

/* 2. The Main Container (CENTERED LAYOUT) */
.action-bar {
    display: flex;
    flex-direction: column;
    gap: 12px;
    
    /* CENTER ALIGNMENT CONSTRAINT */
    width: 100%; 
    max-width: 100%; /* CHANGED: Was 900px. Now allows full width to fit 5 buttons. */
    margin: 0 auto;    /* Centers the panel itself */
    
    padding: 16px; 
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    box-shadow: 0 1px 3px rgba(0,0,0,0.03);
}

/* 3. Row Layouts (CENTERED CONTENT) */
.action-row-top, .workbench-row, .copy-group {
    display: flex;
    width: 100%;
    gap: 12px;
    align-items: stretch;
    justify-content: center; /* Ensures buttons are centered in the row */
}

/* Specific spacing for middle row */
.workbench-row {
    padding: 12px 0;
    border-top: 1px dashed var(--color-border-light);
    border-bottom: 1px dashed var(--color-border-light);
}

.wb-group { display: contents; }
.action-spacer { display: none; }

/* 4. UNIVERSAL BUTTON STYLING (The "Unifier" Engine) */
.action-bar .tool-btn,
.action-btn, /* ADDED: Ensures the new 'action-btn' class gets styled */
.macro-btn,
.wb-btn-strict, 
.wb-btn-cons, 
.wb-btn-code, 
.wb-btn-evidence {
    flex: 1; /* Keeps them equal width */
    max-width: 250px; /* Stop them from becoming huge on wide screens */
    
    display: inline-flex;
    align-items: center;
    justify-content: center;
    
    /* UNIFIED TYPOGRAPHY */
    font-family: var(--font-sans) !important;
    font-size: 0.85rem !important; /* CHANGED: Was 0.9rem (Slightly smaller text) */
    font-weight: 600 !important;
    line-height: 1;
    white-space: nowrap;
    letter-spacing: normal;
    
    /* UNIFIED BOX MODEL */
    height: 42px;
    padding: 0 8px; /* CHANGED: Was 0 12px (Makes buttons narrower) */
    gap: 6px;       /* CHANGED: Slightly tighter gap between text/icon */
    border-radius: 4px;
    
    /* UNIFIED COLORS: TRANSPARENT DEFAULT */
    background-color: transparent !important;
    border: 1px solid #d1d5db !important; 
    color: #4b5563 !important;            
    
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    box-shadow: none !important;
}

/* Special Case: Macro Button (Bottom) - Centered but wider */
.macro-btn {
    flex: 0 1 auto; /* Don't force stretch */
    width: 100%;    /* Allow fill up to max-width */
    max-width: 100%; /* Fill the container (which is already constrained to 900px) */
}

/* 5. UNIVERSAL HOVER EFFECT */
.action-bar .tool-btn:hover,
.action-btn:hover, /* ADDED: Hover state for new class */
.macro-btn:hover,
.wb-btn-strict:hover, 
.wb-btn-cons:hover, 
.wb-btn-code:hover, 
.wb-btn-evidence:hover {
    background-color: #f5f3ff !important; 
    border-color: #8b5cf6 !important;      
    color: #7c3aed !important;             
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(124, 58, 237, 0.1) !important;
    z-index: 2;
}

/* Click Effect */
.action-bar .tool-btn:active {
    transform: translateY(0);
    box-shadow: none;
}

/* 6. Layout Fixes */
.action-row-bottom {
    width: 100%;
    margin-top: 4px;
    display: flex;
    justify-content: center; /* Center the bottom button */
}

/* Responsive: Stack on Mobile */
@media (max-width: 1000px) {
    .action-row-top, .workbench-row, .copy-group {
        flex-wrap: wrap;
    }
    .action-bar .tool-btn {
        flex: 1 1 45%;
        max-width: none; /* Allow full width on mobile */
    }
}

/* SVG Icon Sizing */
.section-icon svg {
  width: 1.1em;
  height: 1.1em;
}

/* =========================================
   SMART TOOLTIP ENGINE (Violet Forensic Theme)
   ========================================= */

/* 1. Base Button Prep */
.macro-btn {
    position: relative; /* Anchors the tooltip to the button */
    /* ... existing macro-btn styles ... */
}

/* 2. The Tooltip Body (Hidden by default) */
.macro-btn::before {
    content: attr(data-tooltip); /* Pulls text from HTML */
    
    /* Positioning (Above the button) */
    position: absolute;
    bottom: 100%;       
    left: 50%;
    transform: translateX(-50%) translateY(-8px); /* Center & lift slightly */
    
    /* Box Model */
    width: max-content;
    max-width: 260px;   /* Constrains width for readability */
    padding: 8px 12px;
    margin-bottom: 8px; /* Space for the arrow */
    border-radius: 6px;
    
    /* Visual Style (Dark Violet Theme) */
    background-color: #1e1b4b; /* Very Dark Violet (Indigo-950) */
    color: #e0e7ff;            /* Light Indigo Text */
    border: 1px solid #4338ca; /* Indigo-700 Border */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    
    /* Typography */
    font-family: var(--font-sans);
    font-size: 0.75rem;
    font-weight: 500;
    line-height: 1.4;
    text-align: center;
    white-space: pre-wrap; /* Allows the line break (&#xa;) to work */
    z-index: 100;
    
    /* Animation State: Hidden */
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none; 
}

/* 3. The Little Triangle Arrow */
.macro-btn::after {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(0px);
    
    /* Triangle Shape */
    border-width: 6px;
    border-style: solid;
    border-color: #1e1b4b transparent transparent transparent; /* Arrow matches Background */
    
    /* Animation State: Hidden */
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
}

/* 4. HOVER STATE (Reveal) */
.macro-btn:hover::before,
.macro-btn:hover::after {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(-12px); /* Float Up Effect */
}

/* Arrow specific transform adjust */
.macro-btn:hover::after {
    transform: translateX(-50%) translateY(-4px);
}

/* =========================================
   RESTORE: GENERAL PROFILE HOVERS & LAYOUT (Fixed)
   ========================================= */

/* 1. Target all standard sections */
details.profile-section > summary {
    display: list-item;       /* Keep native arrow */
    cursor: pointer;
    outline: none;
    transition: color 0.2s ease;
    
    /* FORCE ONE LINE */
    white-space: nowrap;      /* Prevents wrapping */
    list-style-position: inside; /* Keeps arrow tight to text */
}

/* 2. Target the Title Text inside */
details.profile-section > summary .section-title {
    display: inline-block !important; /* Sit naturally next to arrow */
    width: auto !important;           /*  FIX: Stops the line break */
    vertical-align: middle;           /* Centers text with arrow */
    margin: 0;
    padding-left: 6px;                /* Tiny gap between arrow and text */
    
    transition: color 0.2s ease;
}

/* 3. THE BLUE HOVER RESTORATION */
details.profile-section > summary:hover {
    color: #2563eb; 
}

details.profile-section > summary:hover .section-title {
    color: #2563eb; 
}

details.profile-section > summary:hover::marker {
    color: #2563eb;
}

/* --- INTEL CONSOLE (DOSSIER) --- */
.intel-console-wrapper {
    background: #fff;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    margin-top: 1rem;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

/* Zone A: Seal */
.intel-seal-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: #f9fafb;
    border-bottom: 1px solid var(--color-border);
}

.intel-badge {
    font-weight: 800;
    font-size: 1.1rem;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    background: #e5e7eb;
    color: #374151;
}
.intel-badge-safe { background: #dcfce7; color: #166534; border: 1px solid #86efac; }
.intel-badge-warn { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
.intel-badge-danger { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }

.intel-meta { font-size: 0.75rem; color: #6b7280; font-family: var(--font-mono); }
.meta-label { font-weight: 600; opacity: 0.7; }
.meta-val { font-weight: 700; color: #374151; }
.meta-sep { margin: 0 8px; opacity: 0.3; }

/* Zone B: Grid */
.intel-grid-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border-bottom: 1px solid var(--color-border);
}
.intel-stat-card {
    padding: 1rem;
    text-align: center;
    border-right: 1px solid var(--color-border);
}
.intel-stat-card:last-child { border-right: none; }
.stat-label { font-size: 0.7rem; font-weight: 700; color: #6b7280; letter-spacing: 0.05em; margin-bottom: 4px; }
.stat-val { font-size: 1.5rem; font-weight: 700; color: #111827; line-height: 1.2; }
.stat-desc { font-size: 0.7rem; color: #9ca3af; }

/* Zone C: Targets */
.intel-target-list { background: #fff; }
.target-header {
    padding: 0.5rem 1rem;
    font-size: 0.7rem;
    font-weight: 700;
    color: #6b7280;
    background: #f3f4f6;
    border-bottom: 1px solid var(--color-border);
    letter-spacing: 0.05em;
}
.target-row {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #f3f4f6;
    display: flex;
    flex-direction: column;
    gap: 6px;
}
.target-row:last-child { border-bottom: none; }

.t-head { display: flex; justify-content: space-between; align-items: center; }
.t-token { font-family: var(--font-mono); font-weight: 700; color: #111827; font-size: 0.9rem; }
.t-verdict { font-size: 0.7rem; font-weight: 700; color: #dc2626; background: #fef2f2; padding: 2px 6px; border-radius: 4px; border: 1px solid #fecaca; }

.t-vectors { display: flex; gap: 1rem; font-size: 0.75rem; flex-wrap: wrap; }
.vec-item { display: flex; align-items: center; gap: 6px; }
.v-lbl { font-weight: 600; color: #6b7280; font-size: 0.7rem; }
.v-val { font-family: var(--font-mono); color: #4b5563; background: #f3f4f6; padding: 1px 4px; border-radius: 3px; user-select: all; }

/* --- INTEL HIERARCHY (EXPANDABLE) --- */
.intel-details {
    margin-top: 4px;
    width: 100%;
}
.intel-summary {
    font-size: 0.7rem;
    color: #6b7280;
    cursor: pointer;
    font-weight: 600;
    user-select: none;
    list-style: none; /* Hide default triangle */
    display: flex;
    align-items: center;
    gap: 4px;
}
.intel-summary::before {
    content: "";
    font-size: 0.6rem;
    transition: transform 0.2s;
}
.intel-details[open] .intel-summary::before {
    transform: rotate(90deg);
}
.intel-summary:hover { color: #374151; }

.intel-stack-body {
    margin-top: 8px;
    padding: 8px 12px;
    background: #f9fafb;
    border-radius: 4px;
    border: 1px solid #e5e7eb;
}

.th-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 4px;
    font-family: var(--font-mono);
}
.th-row:last-child { margin-bottom: 8px; }

.th-badge {
    font-size: 0.65rem;
    padding: 1px 4px;
    border-radius: 3px;
    font-weight: 700;
    min-width: 35px;
    text-align: center;
}
.th-crit { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }
.th-high { background: #ffedd5; color: #9a3412; border: 1px solid #fdba74; }
.th-med  { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; }
.th-low  { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; }

.th-desc {
    font-size: 0.75rem;
    color: #374151;
}

/* Adjust the existing vector styling to fit inside */
.intel-stack-body .t-vectors {
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px dashed #d1d5db;
}

/* --- DRIFT REPORT (FORENSIC STYLING) --- */
.drift-details {
    background: #fff;
    border: 1px solid #e5e7eb; /* var(--color-border) fallback */
    border-radius: 6px;
    margin-bottom: 12px;
    overflow: hidden;
}

/* The Header */
.drift-summary {
    padding: 12px 16px;
    cursor: pointer;
    font-weight: 600;
    list-style: none;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.2s;
}
.drift-summary::-webkit-details-marker { display: none; }

/* Status Colors - CRITICAL for the 'Alert' look */
.drift-clean { background: #f0fdf4; color: #166534; border-left: 4px solid #22c55e; }
.drift-warn  { background: #fffbeb; color: #92400e; border-left: 4px solid #f59e0b; }
.drift-alert { background: #fef2f2; color: #991b1b; border-left: 4px solid #ef4444; }

.drift-content {
    padding: 16px;
    border-top: 1px solid #e5e7eb;
}

/* The Comparison Table (Grid Layout) */
.drift-comparison-table {
    display: grid;
    grid-template-columns: 1fr 40px 1fr; /* The Side-by-Side Magic */
    gap: 10px;
    align-items: center;
    margin-top: 10px;
}

.drift-col {
    background: #f9fafb;
    padding: 10px;
    border-radius: 4px;
    border: 1px solid #e5e7eb;
}

.drift-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    color: #6b7280;
    font-weight: 700;
    margin-bottom: 6px;
}

.drift-value {
    font-family: monospace; /* var(--font-mono) fallback */
    font-size: 0.95rem;
    word-break: break-all;
    max-height: 120px;
    overflow-y: auto;
    white-space: pre-wrap;
    color: #111827;
}

.drift-arrow {
    text-align: center;
    color: #9ca3af;
    font-size: 1.5rem;
    font-weight: bold;
}

/* --- Forensic Metric Pack (Lab UI) --- */
.metric-card {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 80px; /* Ensure visual consistency */
}

.card-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.7rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #71797E; /* Or opacity: 0.7 */
    margin-bottom: 4px;
}

.card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.8;
}

.metric-value, 
.metric-value-warn {
    font-family: 'SF Mono', 'Segoe UI Mono', 'Roboto Mono', monospace;
    font-size: 1.8rem;
    font-weight: 400;
    letter-spacing: -0.03em;
    line-height: 1.2;
    color: var(--color-text-main);
}

.metric-value-warn {
    color: #d97706; /* Amber-600 - Matches your existing warning palette */
}

.metric-sub {
    font-size: 0.75rem;
    margin-top: 6px;
    white-space: nowrap;
    opacity: 0.8;
}


/* --- Forensic Header Layout (Hierarchical Stack) --- */

/* 1. Main Container: Stack Vertically */
#meta-totals-cards {
    display: flex !important;
    flex-direction: column; /* Stack Quad on top of Context */
    gap: 12px;
}

/* 2. The "Quad" (Top Row): 4 Columns, Tighter Visuals */
.forensic-quad-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 cards in one row */
    gap: 12px;
    width: 100%;
}

/* Reduce visual bulk for the Quad */
.forensic-quad-grid .metric-card {
    min-height: 70px; /* Shorter cards */
}

/* Override font size specifically for the Quad to stop them being "ridiculous" */
.forensic-quad-grid .metric-value,
.forensic-quad-grid .metric-value-warn {
    font-size: 1.4rem; /* Down from 1.8rem */
}

/* 3. The "Context" (Bottom Row): Responsive Grid */
.forensic-context-grid {
    display: grid;
    /* Match the 'Ideal' behavior of the Grapheme section */
    /* 190px min-width ensures 6 fit on a standard 1200px+ screen */
    grid-template-columns: repeat(auto-fill, minmax(190px, 1fr)); 
    gap: 12px;
    width: 100%;
}

/* --- Responsive Safety Nets --- */

/* Laptop/Tablet: Break 4->2x2 and 6->3x2 */
@media (max-width: 1100px) {
    .forensic-quad-grid {
        grid-template-columns: 1fr 1fr; /* 2x2 */
    }
    .forensic-context-grid {
        grid-template-columns: repeat(3, 1fr); /* 3 in a row */
    }
}

/* Mobile: Stack everything */
@media (max-width: 600px) {
    .forensic-quad-grid,
    .forensic-context-grid {
        grid-template-columns: 1fr;
    }
}

/* FORCE 2x2 GRID for the Top 4 Metrics */
.cards-2x2 {
  display: grid;
  grid-template-columns: 1fr 1fr; /* 50% split */
  gap: 16px; /* Match your spacing variables */
  margin-bottom: 16px;
  width: 100%;
}

/* On mobile, stack them */
@media (max-width: 600px) {
  .cards-2x2 { grid-template-columns: 1fr; }
}

/* --- High Density Metric Card Layout --- */

/* Split the card body into Main (Left) and Facts (Right) */
.metric-body {
    display: flex;
    justify-content: space-between;
    align-items: flex-end; /* Align bottom */
    width: 100%;
}

.metric-main {
    display: flex;
    flex-direction: column;
}

.metric-facts {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
    margin-bottom: 4px; /* Align visually with baseline */
}

/* --- High Specificity Override for Right-Side Facts --- */

/* 1. Target the Container to ensure it doesn't shrink */
.metric-facts {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    justify-content: flex-end; /* Push to bottom */
    gap: 4px; /* Give them breathing room */
    min-width: 80px; /* Prevent text wrapping/squashing */
}

/* 2. Target the Row (The Label) - Force Size */
.card .metric-facts .fact-row {
    /* Use high specificity (.card .metric-facts .fact-row) to win */
    font-size: 1.5rem !important; /* ~13px - Legible Label */
    line-height: 1.2 !important;
    
    color: var(--color-text-muted);
    font-family: var(--font-sans);
    white-space: nowrap;
    text-align: right;
    margin-bottom: 0;
    letter-spacing: 0.01em;
}

/* 3. Target the Value (The Number) - Override .card strong */
.card .metric-facts .fact-row strong {
    /* Override global .card strong which was forcing 0.9rem */
    font-size: 1.5rem !important; /* ~17px - Big, clear Number */
    font-weight: 700;
    color: var(--color-text);
    font-family: var(--font-mono);
    display: inline !important; /* Ensure it flows with text */
    margin-left: 6px; /* Separation from label */
}

/* --- FORCE HEADER COLOR OVERRIDE --- */
/* We target the parent (.metric-card) AND the child (.card-header) 
   to beat existing specificity scores. */

.metric-card .card-header {
    color: #71797E !important; /* Steel Gray */
}

/* Force the icon SVG to adopt the color explicitly */
.metric-card .card-header svg {
    stroke: #71797E !important;
    color: #71797E !important;
}

/* --- METRIC SUBTITLE OVERRIDE --- */
.metric-card .metric-sub {
    color: #71797E !important;  /* Steel Gray (Matches Header) */
    font-size: 0.65rem !important; /* Smaller (Matches right-side facts) */
    font-weight: 500;           /* Clean weight */
    opacity: 1 !important;      /* Ensure color isn't faded */
    margin-top: 2px;            /* Tighter spacing to the number */
}

/* =========================================
   SUSPICION DASHBOARD (Adversarial Forensics)
   ========================================= */

/* --- The Main Wrapper --- */
.intel-console-wrapper {
    background: #ffffff;
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
    margin-top: 1rem;
    padding: 0;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.03);
    font-family: var(--font-sans);
}

/* --- ZONE A: The Seal (Restriction Context) --- */
.intel-seal-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #f9fafb; /* Slate-50 */
    border-bottom: 1px solid var(--color-border-light);
}

/* The Status Badge (e.g. "ANALYZING...") */
.intel-badge {
    font-weight: 800;
    font-size: 0.8rem;
    padding: 4px 10px;
    border-radius: 4px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    
    /* Default Neutral State */
    background: #e5e7eb;
    color: #374151;
    border: 1px solid #d1d5db;
}

/* Risk Variants for the Badge */
.intel-badge-safe { 
    background: #dcfce7; color: #166534; border-color: #86efac; 
}
.intel-badge-warn { 
    background: #fef9c3; color: #854d0e; border-color: #fde047; 
}
.intel-badge-danger { 
    background: #fee2e2; color: #991b1b; border-color: #fca5a5; 
}

/* Metadata (Protocol / Scope) */
.intel-meta { 
    font-size: 0.7rem; 
    color: #6b7280; 
    font-family: var(--font-mono); 
    display: flex;
    align-items: center;
}
.meta-label { font-weight: 600; opacity: 0.7; }
.meta-val { font-weight: 700; color: #374151; margin-left: 4px; }
.meta-sep { margin: 0 10px; opacity: 0.3; color: #9ca3af; }


/* --- ZONE B: The Scoreboard (4-Card Grid) --- */
.intel-grid-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border-bottom: 1px solid var(--color-border-light);
}

.intel-stat-card {
    padding: 16px;
    text-align: center;
    border-right: 1px solid var(--color-border-light);
    transition: background-color 0.2s ease;
}
.intel-stat-card:last-child { border-right: none; }
.intel-stat-card:hover { background-color: #f8fafc; }

.stat-label { 
    font-size: 0.65rem; 
    font-weight: 800; 
    color: #64748b; 
    letter-spacing: 0.05em; 
    text-transform: uppercase;
    margin-bottom: 6px;
}

.stat-val { 
    font-family: var(--font-mono);
    font-size: 1.6rem; 
    font-weight: 700; 
    color: #111827; 
    line-height: 1;
    margin-bottom: 4px;
}

.stat-desc { 
    font-size: 0.7rem; 
    color: #9ca3af; 
    font-weight: 500;
}


/* --- ZONE C: Paranoia Peak (Top Offender Highlight) --- */
.intel-peak-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    background-color: #fff1f2; /* Light Rose background */
    border-bottom: 1px solid #ffe4e6;
    color: #be123c; /* Rose-700 */
}

.peak-label {
    font-size: 0.7rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #9f1239;
}

.peak-val {
    display: flex;
    align-items: center;
    gap: 8px;
    background: #ffffff;
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid #fecdd3; /* Rose-200 */
}

.peak-token {
    font-family: var(--font-mono);
    font-weight: 700;
    color: #111827;
    font-size: 0.9rem;
}

.peak-score {
    font-size: 0.7rem;
    font-weight: 700;
    color: #e11d48; /* Rose-600 */
    background: #ffe4e6;
    padding: 1px 6px;
    border-radius: 99px;
}

.peak-reasons {
    font-size: 0.75rem;
    color: #881337;
    font-weight: 500;
    margin-left: auto; /* Push to right */
    display: flex;
    gap: 6px;
}

.peak-tag {
    background: rgba(255,255,255,0.6);
    padding: 1px 6px;
    border-radius: 3px;
    border: 1px solid rgba(190, 18, 60, 0.2);
}


/* --- ZONE D: Findings List (The Detail Table) --- */
.intel-target-list { 
    background: #ffffff; 
}

.target-header {
    padding: 8px 16px;
    font-size: 0.7rem;
    font-weight: 800;
    color: #6b7280;
    background: #f9fafb;
    border-bottom: 1px solid var(--color-border-light);
    letter-spacing: 0.05em;
    text-transform: uppercase;
}

.target-body {
    display: flex;
    flex-direction: column;
}

.target-row {
    padding: 10px 16px;
    border-bottom: 1px solid var(--color-border-light);
    display: flex;
    flex-direction: column;
    gap: 4px;
    transition: background-color 0.15s ease;
}
.target-row:last-child { border-bottom: none; }
.target-row:hover { background-color: #fcfcfc; }

/* The Row Header (Badge + Token + Verdict) */
.t-head { 
    display: flex; 
    align-items: center; 
    width: 100%;
}

.t-token { 
    font-family: var(--font-mono); 
    font-weight: 600; 
    color: #1f2937; 
    font-size: 0.85rem; 
}

.t-verdict { 
    font-size: 0.75rem; 
    font-weight: 500; 
    color: #6b7280; 
    margin-left: auto; /* Push to far right */
    font-style: italic;
}

/* Findings Badges */
.th-badge {
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 3px;
    font-weight: 700;
    min-width: 60px;
    text-align: center;
    margin-right: 10px;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

/* Severity Colors */
.th-crit { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; } /* Red */
.th-high { background: #ffedd5; color: #9a3412; border: 1px solid #fdba74; } /* Orange */
.th-med  { background: #fef9c3; color: #854d0e; border: 1px solid #fde047; } /* Yellow */
.th-low  { background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; } /* Gray */


/* --- X-Ray Wrapper (Perception vs Reality) --- */
.xray-wrapper {
    background-color: var(--color-white);
    border: 1px solid var(--color-border-light);
    border-radius: var(--radius);
    padding: 0; /* Let internal clusters handle padding */
    font-family: var(--font-mono);
    font-size: 1rem;
    overflow-x: auto;
}

/* Mobile Responsive Tweaks for Dashboard */
@media (max-width: 768px) {
    .intel-grid-row {
        grid-template-columns: 1fr 1fr; /* 2x2 grid */
    }
    .intel-stat-card:nth-child(2) { border-right: none; }
    .intel-stat-card:nth-child(3) { border-bottom: none; } 
    
    .intel-peak-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    .peak-reasons { margin-left: 0; }
}

/* =========================================
   UNIFIED ADVERSARIAL X-RAY (Hybrid Engine)
   ========================================= */

/* The Main Container inside the white box */
.xray-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 16px;
    font-family: var(--font-mono);
    width: 100%;
}

/* 1. Legend Bar (Top) */
.xray-legend-bar {
    display: flex;
    gap: 16px;
    font-size: 0.7rem;
    color: #6b7280;
    border-bottom: 1px dashed #e5e7eb;
    padding-bottom: 8px;
    margin-bottom: 8px;
    text-transform: uppercase;
    font-weight: 700;
}

.xl-item { display: flex; align-items: center; gap: 6px; }
.xl-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.dot-red { background: #fee2e2; border: 1px solid #f87171; }
.dot-gray { background: #f3f4f6; border: 1px solid #d1d5db; }

/* 2. Context Cluster Card (The Wrapper) */
.xray-cluster {
    border: 1px solid #e5e7eb;
    border-radius: 8px; /* Restored 8px radius */
    background-color: #ffffff;
    overflow: hidden;
    margin-bottom: 12px; /* Increased gap */
    box-shadow: 0 2px 4px rgba(0,0,0,0.03); /* Restored Shadow */
    display: flex;
    flex-direction: column;
}

/* Restored Header Layout */
.xray-meta {
    background: #f8fafc; /* Slate-50 */
    padding: 10px 16px;
    font-size: 0.7rem;
    font-weight: 700;
    color: #64748b; /* Slate-500 */
    border-bottom: 1px solid #f1f5f9;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

/* 3. The Horizontal Strip (CRITICAL FIX) */
.xray-strip {
    display: flex;       /* This forces horizontal layout */
    flex-direction: row; /* Aligns items side-by-side */
    overflow-x: auto;    /* Allows scrolling if text is long */
    padding: 16px 20px;  /* Restored generous padding */
    gap: 2px;
    align-items: stretch;
    background-color: #ffffff;
    min-height: 80px; /* Ensure vertical height */
}

/* Scrollbar Polish (Restored) */
.xray-strip::-webkit-scrollbar { height: 8px; }
.xray-strip::-webkit-scrollbar-thumb { background-color: #e5e7eb; border-radius: 4px; }
.xray-strip::-webkit-scrollbar-track { background-color: transparent; }

/* 4. Individual Character Columns */
.xray-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    min-width: 32px; /* Slightly wider for readability */
    padding: 6px 4px;
    border-radius: 4px;
    border: 1px solid transparent;
    transition: all 0.15s ease;
    cursor: help;
}

.xray-col:hover { 
    background: #ffffff; 
    border-color: #e2e8f0;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transform: translateY(-1px);
    z-index: 10;
}

/* Top Row (Raw Character) */
.x-raw {
    font-size: 1.4rem; /* Restored size */
    line-height: 1;
    margin-bottom: 12px;
    color: #1f2937;
    height: 30px; 
    display: flex;
    align-items: flex-end; 
    font-weight: 700;
}

/* Bottom Row (Skeleton Character) */
.x-skel {
    font-size: 0.85rem;
    color: #94a3b8; /* Slate-400 */
    border-top: 1px dotted #e2e8f0;
    padding-top: 6px;
    width: 100%;
    text-align: center;
    font-weight: 600;
    text-transform: uppercase;
}

/* --- 5. DRIFT STATES (The Red Highlight) --- */
.xray-drift {
    background-color: #fff1f2; /* Rose-50 */
    border: 1px solid #fecaca; /* Red-200 */
}
.xray-drift .x-raw { color: #dc2626; font-weight: 800; }
.xray-drift .x-skel { color: #b91c1c; font-weight: 700; border-color: #fca5a5; }

/* --- 6. VOID STATES (Hidden Chars) --- */
.xray-void {
    background-color: #f8fafc; /* Slate-50 */
    border: 1px dashed #e2e8f0;
    opacity: 0.9;
    min-width: 26px; 
}
.xray-void .x-raw { color: #7c3aed; /* Violet for hidden */ }
.xray-void .x-skel { color: #cbd5e1; }

/* --- 7. TAGS ([HID], [ZWJ]) --- */
.x-tag {
    font-size: 0.6rem;
    font-weight: 800;
    color: #64748b;
    background: #f1f5f9;
    padding: 2px 5px;
    border-radius: 4px;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border: 1px solid #e2e8f0;
}

/* --- 8. RESTORED BUTTONS & BADGES (For Future Use) --- */
.safe-copy-btn {
    background-color: #ffffff;
    border: 1px solid #cbd5e1;
    border-radius: 4px;
    color: #475569;
    font-family: var(--font-sans);
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 10px;
    cursor: pointer;
    transition: all 0.15s ease;
    white-space: nowrap;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    margin-left: auto; /* Push to right */
}

.safe-copy-btn:hover {
    border-color: #2563eb;
    color: #2563eb;
    background-color: #eff6ff;
}

/* Cluster Badges (Restored) */
.cluster-badge {
    display: inline-flex;
    align-items: center;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 4px;
    text-transform: uppercase;
    border: 1px solid transparent;
    margin-left: 8px;
}
.badge-spoof { background: #fef2f2; color: #dc2626; border-color: #fecaca; }
.badge-invis { background: #f5f3ff; color: #7c3aed; border-color: #ddd6fe; }
.badge-bidi  { background: #fffbeb; color: #d97706; border-color: #fcd34d; }

/* =========================================
   FORENSIC STACK (Layering Logic)
   ========================================= */

.forensic-stack {
    display: flex;
    flex-direction: column;
    gap: 0;
    width: 100%;
}

.stack-layer {
    width: 100%;
}

/* The divider between the Card View and the X-Ray View */
.stack-separator {
    text-align: center;
    font-size: 0.65rem;
    font-weight: 800;
    color: #94a3b8; /* Slate-400 */
    background-color: #f8fafc;
    border-top: 1px dashed #e2e8f0;
    border-bottom: 1px dashed #e2e8f0;
    padding: 4px 0;
    margin: 12px 0;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    user-select: none;
}

/* =========================================
   RESTORED: LEGACY STREAM STYLES (Fixes Top View)
   ========================================= */

/* The Wrapper */
.xray-stream-wrapper {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 12px;
}

/* The Card (Legacy) */
.cluster-card {
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    background-color: #ffffff;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
}

/* Header (Legacy) */
.cluster-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background-color: #f8fafc; /* Slate-50 */
    border-bottom: 1px solid #f1f5f9;
}

.cluster-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.cluster-id {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 700;
    color: #64748b;
    margin-right: 4px;
}

/* The Horizontal Scroll Area (Legacy) */
.cluster-body {
    padding: 16px;
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: #1f2937;
    background-color: #ffffff;
    display: block; 
    white-space: pre; /* Crucial for horizontal layout */
    overflow-x: auto;
    overflow-y: hidden;
    line-height: 1.8; 
}

.cluster-body::-webkit-scrollbar { height: 8px; }
.cluster-body::-webkit-scrollbar-thumb { background-color: #e5e7eb; border-radius: 4px; }

/* The Stacks (The "Chips" in the top view) */
.xray-stack {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
    margin: 0 2px;
    padding: 2px 5px;
    border-radius: 4px;
    cursor: help;
    min-width: 1.8em;
    border: 1px solid transparent;
    line-height: 1;
    background-color: #f8fafc;
}

.xray-stack:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    background-color: #ffffff;
    z-index: 10;
}

/* Stack Colors */
.stack-spoof { background-color: #fff1f2; border-color: #fecaca; }
.stack-invis { background-color: #f5f3ff; border-color: #ddd6fe; }
.stack-bidi  { background-color: #fffbeb; border-color: #fcd34d; }

.xray-top {
    font-size: 1rem;
    font-weight: 800;
    color: #1f2937;
    padding-bottom: 2px;
}
.stack-spoof .xray-top { color: #dc2626; }
.stack-invis .xray-top { color: #7c3aed; }

.xray-bot {
    font-size: 0.55rem;
    font-weight: 700;
    color: #64748b;
    text-transform: uppercase;
    border-top: 1px dotted rgba(0,0,0,0.2);
    width: 100%;
    text-align: center;
    padding-top: 2px;
}

/* Badges & Summary Bar */
.xray-summary-bar {
    background-color: #f0f9ff; 
    border: 1px solid #bae6fd;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.85rem;
    color: #0369a1;
    margin-bottom: 12px;
}

.xray-summary-title {
    font-weight: 800;
    text-transform: uppercase;
    margin-right: 6px;
    font-size: 0.75rem;
}

.xray-legend {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-top: 4px;
    font-size: 0.7rem;
    color: #64748b;
    padding: 8px;
    border-top: 1px dashed #e2e8f0;
}

.xray-legend-item {
    display: flex;
    align-items: center;
    gap: 4px;
}

/* Dots for Legend */
.xray-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.dot-spoof { background-color: #fca5a5; }
.dot-invis { background-color: #c4b5fd; }
.dot-bidi  { background-color: #fcd34d; }

/* --- Forensic Summary Bar (FORCED NEUTRAL GRAY) --- */
.xray-summary-bar {
  background-color: #f3f4f6 !important; /* Slate-100 */
  border: 1px solid #d1d5db !important; /* Slate-300 */
  color: #1f2937;            /* Slate-900 */
  
  border-radius: 6px;
  padding: 8px 12px;
  font-size: 0.85rem;
  margin-bottom: 12px;
  font-family: var(--font-sans);
}

.xray-summary-title {
  color: #4b5563; /* Slate-600 */
  font-weight: 800;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-right: 6px;
  font-size: 0.75rem;
}

/* =========================================
   VERIFICATION BENCH (PRO GRADE)
   ========================================= */

.verdict-box {
    margin-top: 1rem;
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: all 0.2s ease;
}

.verdict-box.hidden {
    display: none;
}

/* Header: The Big Verdict */
.verdict-header {
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.verdict-icon-box {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    background: rgba(255,255,255,0.5);
}

.verdict-title-group {
    display: flex;
    flex-direction: column;
}

.verdict-label {
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 700;
    opacity: 0.7;
}

.verdict-value {
    font-size: 1.1rem;
    font-weight: 800;
    letter-spacing: -0.01em;
}

/* Body: The Evidence */
.verdict-body {
    padding: 16px;
    font-size: 0.9rem;
    color: var(--text-main);
    background: #fafafa; /* Slight contrast for body */
}


/* STATUS COLORS (Theming) */

/* SAFE (Identity Match) */
.verdict-safe {
    border-left: 4px solid #10b981; /* Green-500 */
}
.verdict-safe .verdict-header { background-color: #ecfdf5; color: #065f46; }
.verdict-safe .verdict-icon-box { background-color: #d1fae5; color: #059669; }

/* CRITICAL (Spoof) */
.verdict-crit {
    border-left: 4px solid #ef4444; /* Red-500 */
}
.verdict-crit .verdict-header { background-color: #fef2f2; color: #991b1b; }
.verdict-crit .verdict-icon-box { background-color: #fee2e2; color: #dc2626; }

/* WARNING (Normalization/Case) */
.verdict-warn {
    border-left: 4px solid #f59e0b; /* Amber-500 */
}
.verdict-warn .verdict-header { background-color: #fffbeb; color: #92400e; }
.verdict-warn .verdict-icon-box { background-color: #fef3c7; color: #d97706; }

/* NEUTRAL (Distinct) */
.verdict-neutral {
    border-left: 4px solid #94a3b8; /* Slate-400 */
}
.verdict-neutral .verdict-header { background-color: #f8fafc; color: #475569; }
.verdict-neutral .verdict-icon-box { background-color: #e2e8f0; color: #64748b; }

/* Suspect Monitor (Active Feedback) */
.suspect-box {
    width: 100%;
    padding: 0.5rem;
    background-color: #f3f4f6; /* Gray-100 */
    border: 1px solid var(--border-subtle);
    border-radius: 4px;
    color: var(--text-main);
    font-family: var(--font-mono);
    font-size: 0.9rem;
    min-height: 38px;
    white-space: pre-wrap; /* Preserve formatting */
    word-break: break-all;
    overflow-y: auto;
    max-height: 80px;
}

.scope-badge-full {
    background: #e5e7eb;
    color: #4b5563;
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    text-transform: uppercase;
    font-weight: 700;
}

.scope-badge-select {
    background: #dbeafe; /* Blue-100 */
    color: #1e40af;      /* Blue-800 */
    font-size: 0.65rem;
    padding: 2px 6px;
    border-radius: 4px;
    margin-left: 8px;
    text-transform: uppercase;
    font-weight: 700;
}

/* --- Forensic Suspect Monitor (The Lens) --- */
.suspect-highlight-box {
    font-family: var(--font-mono);
    line-height: 1.5;
    color: #6b7280; /* Default: Dark Gray (Context) */
}

/* The Intersection (Matched Skeleton) */
.f-match {
    color: #111827; /* Black */
    font-weight: 700;
    font-size: 1.05em; /* Slightly bigger */
}

/* The Deviation (Spoof/Diff) */
.f-diff {
    color: #dc2626; /* Red */
    font-weight: 800;
    background-color: #fef2f2;
    border-radius: 2px;
    padding: 0 2px;
    text-decoration: underline;
    text-decoration-style: dotted;
}

/* The Match Meter */
.match-meter {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 4px;
    font-size: 0.75rem;
    font-family: var(--font-sans);
}

.meter-track {
    flex: 1;
    height: 6px;
    background: #e5e7eb;
    border-radius: 3px;
    overflow: hidden;
}

.meter-fill {
    height: 100%;
    background: #3b82f6; /* Blue */
    transition: width 0.2s ease;
}

.meter-fill.high-match { background: #ef4444; /* Red for high spoof match */ }
.meter-fill.perfect { background: #10b981; /* Green for safe match */ }


/* --- Forensic Lens V6 (Threat-Aware X-Ray) --- */

/* 1. ANCHOR: The Target (Matched Skeleton) */
.f-anchor {
    color: #374151; /* Dark Gray (Neutral) */
    font-weight: 700;
    opacity: 0.9;
}

/* 2. PAYLOAD: The Spoof (Homoglyph) */
.f-payload {
    color: #dc2626; /* Bright Red */
    font-weight: 900;
    background-color: #fee2e2;
    border-bottom: 2px solid #ef4444;
    padding: 0 1px;
    border-radius: 2px;
}

/* 3. FORMAT DRIFT: Normalization Equivalence (New) */
.f-format {
    color: #d97706; /* Amber */
    font-weight: 800;
    background-color: #fef3c7;
    border-bottom: 2px dotted #d97706;
    padding: 0 1px;
}

/* 4. INTERNAL THREAT: Injection inside Match (New) */
/* e.g. "admin<ZWSP>istrator" */
.f-threat-internal {
    color: #ffffff;
    background-color: #dc2626; /* Solid Red background */
    font-weight: 800;
    outline: 2px solid #dc2626; /* Hard outline to pop */
    border-radius: 2px;
    padding: 0 1px;
    z-index: 5;
    position: relative;
}

/* 5. RESIDUAL THREAT: Tail/Head Injection (New) */
.f-threat-resid {
    color: #ffffff;
    background-color: #7c3aed; /* Violet */
    font-weight: 800;
    padding: 0 2px;
    border-radius: 2px;
}

/* 6. NOISE: Unmatched Context */
.f-noise {
    color: #94a3b8; /* Slate-400 */
    font-weight: 400;
    opacity: 0.4;
    filter: grayscale(100%);
}

/* --- Metric Matrix V2 (Stacked Grid) --- */
.verdict-matrix {
    display: flex;
    flex-direction: column; /* CHANGE: Stack rows vertically */
    gap: 12px;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px dashed var(--color-border-light);
}

/* New: Container for a horizontal row of metrics */
.v-metric-row-group {
    display: flex;
    gap: 10px;
    width: 100%;
}

.v-metric {
    flex: 1;
    background: #ffffff;
    border: 1px solid var(--color-border-light);
    border-radius: 6px;
    padding: 8px 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center; /* Center align for cleaner grid */
    min-width: 0;
    text-align: center;
}

.v-metric-label {
    font-size: 0.65rem;
    text-transform: uppercase;
    color: #64748b; /* Slate-500 */
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: 0.05em;
    display: block;
}

.v-metric-val {
    font-size: 0.85rem;
    font-weight: 800;
    color: #111827; /* Slate-900 */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-family: var(--font-mono); /* Force Mono for technical values */
    width: 100%;
}

/* Detail Text inside metric (Optional) */
.v-metric-detail {
    font-size: 0.65rem;
    color: #9ca3af;
    font-weight: 500;
    font-family: var(--font-sans);
    margin-top: 2px;
}

/* Skeleton Code Styling (Wrapping Enabled) */
.v-code-block {
    color: #3b82f6; 
    font-weight: 700; 
    font-size: 0.85em; 
    background: #eff6ff; 
    padding: 4px 6px; 
    border-radius: 4px;
    border: 1px solid #dbeafe;
    
    /* WRAPPING MAGIC */
    white-space: pre-wrap;      /* Wrap text naturally */
    word-break: break-all;      /* Break long strings like URLs */
    display: block;             /* Fill width */
    font-family: var(--font-mono);
    max-height: 150px;          /* Optional cap if it gets HUGE */
    overflow-y: auto;           /* Scroll if it exceeds max height */
}

/* =========================================
   STATISTICAL & LEXICAL PROFILE (Group 2.F)
   ========================================= */

/* 1. The Container Table */
#statistical-profile-table td {
    vertical-align: middle;
    padding-top: 12px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border-subtle);
}

#statistical-profile-table th {
    color: #475569; /* Slate-600 */
    font-weight: 600;
    font-size: 0.85rem;
    letter-spacing: 0.02em;
    vertical-align: middle;
}

/* 2. Interactive Token Links (The Bridge) */
/* Styling for the clickable tokens in the Flooding row */
.stat-link {
    color: #0f172a; /* Slate-900 */
    font-weight: 600;
    text-decoration: none;
    border-bottom: 1px dotted #94a3b8; /* Slate-400 */
    transition: all 0.15s ease-in-out;
    cursor: pointer;
    background-color: rgba(255, 255, 255, 0.5);
    padding: 0 2px;
    border-radius: 2px;
}

.stat-link:hover {
    color: #2563eb; /* Blue-600 */
    border-bottom: 1px solid #2563eb;
    background-color: #eff6ff; /* Blue-50 */
}

/* 3. Mini Code Block (Container for Tokens) */
.mini-code {
    font-family: var(--font-mono);
    font-size: 0.85rem;
    background-color: #f8fafc; /* Slate-50 */
    border: 1px solid #e2e8f0; /* Slate-200 */
    border-radius: 4px;
    padding: 6px 10px;
    display: inline-block;
    color: #334155;
    line-height: 1.6;
    max-width: 100%;
    word-break: break-word;
}

/* 4. Context Details (e.g. "(Unique/Total)") */
.detail-text {
    font-family: var(--font-sans);
    font-size: 0.75rem;
    color: #94a3b8; /* Slate-400 */
    font-weight: 500;
    margin-left: 8px;
    letter-spacing: 0.01em;
}

/* 5. Matrix Labels (Metric Names) */
.matrix-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    color: #64748b;
    font-weight: 700;
    letter-spacing: 0.05em;
    display: inline-block;
}

/* 6. Feature Tags (Right Column Badges) */
/* Used for "Structured", "Rich", "Repetitive" labels */
.feature-tag {
    display: inline-flex;
    align-items: center;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    border: 1px solid transparent;
}

/* Status Colors for Feature Tags */
.feature-tag.flag-row-ok {
    background-color: #ecfdf5; /* Green-50 */
    color: #059669; /* Green-600 */
    border-color: #a7f3d0;
}

.feature-tag.flag-row-warn {
    background-color: #fffbeb; /* Amber-50 */
    color: #d97706; /* Amber-600 */
    border-color: #fde68a;
}

.feature-tag.flag-row-crit {
    background-color: #fef2f2; /* Red-50 */
    color: #dc2626; /* Red-600 */
    border-color: #fecaca;
}

/* 7. Entropy Bar Container Context */
/* Ensure the bar aligns perfectly with the text value */
#statistical-profile-body div[style*="grid-template-columns"] {
    border: 1px solid #f1f5f9;
    padding: 6px 10px;
    border-radius: 4px;
    background: #ffffff;
}

/* =========================================
   STATISTICAL CONSOLE & LEGEND
   ========================================= */

/* The Dynamic Console Strip */
.stat-console-strip {
    background-color: #f8fafc;
    border-top: 1px solid #e2e8f0;
    border-bottom: 1px solid #e2e8f0;
    padding: 12px 16px;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: #475569;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    min-height: 60px;
    transition: background-color 0.2s ease;
}

.stat-console-strip.active {
    background-color: #f1f5f9; /* Slightly darker on hover */
    color: #1e293b;
}

.stat-console-left {
    flex: 2;
    padding-right: 20px;
}

.stat-console-right {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
    border-left: 1px solid #cbd5e1;
    padding-left: 16px;
    min-width: 200px;
}

.sc-key {
    font-weight: 700;
    color: #94a3b8;
    text-transform: uppercase;
    font-size: 0.65rem;
    letter-spacing: 0.05em;
    margin-right: 6px;
}

.sc-main-label {
    font-weight: 800;
    text-transform: uppercase;
    color: #0f172a;
    display: block;
    margin-bottom: 4px;
}

/* The Expandable Legend */
.stat-legend-details {
    background: #fff;
    border-bottom: 1px solid #e2e8f0;
}

.stat-legend-summary {
    padding: 10px 16px;
    font-size: 0.75rem;
    font-weight: 700;
    color: #64748b;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    list-style: none; /* Hide default arrow */
    display: flex;
    justify-content: space-between;
}

.stat-legend-summary::-webkit-details-marker { display: none; }
.stat-legend-summary::after { content: ""; font-size: 0.7em; }
.stat-legend-details[open] .stat-legend-summary::after { content: ""; }

.stat-legend-content {
    padding: 0 16px 16px 16px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    font-size: 0.75rem;
    color: #475569;
}

.sl-col strong {
    display: block;
    color: #1e293b;
    margin-bottom: 6px;
    font-family: var(--font-mono);
}

.sl-item {
    margin-bottom: 4px;
    padding-left: 8px;
    border-left: 2px solid #e2e8f0;
    line-height: 1.4;
}

/* --- [NEW] FORENSIC VITAL SIGNS (Decode Health) --- */
/* High-visibility traffic light for the first row of Integrity Profile */

.integrity-badge {
  font-family: var(--font-mono); /* Use monospace for scientific feel */
  font-size: 0.7rem;
  font-weight: 700;
  padding: 3px 8px;
  border-radius: 4px; /* Sharper corners = more technical */
  text-transform: uppercase;
  letter-spacing: 0.05em;
  white-space: nowrap;
  display: inline-block;
}

/* OK: Healthy */
.integrity-badge-ok {
  color: #166534; 
  background-color: #dcfce7;
  border: 1px solid #bbf7d0;
}

/* WARN: Anomalous / Artifacts */
.integrity-badge-warn {
  color: #9a3412; 
  background-color: #ffedd5;
  border: 1px solid #fed7aa;
}

/* CRIT: Data Corruption / Fatal */
.integrity-badge-crit {
  color: #991b1b; 
  background-color: #fee2e2;
  border: 1px solid #fecaca;
  box-shadow: 0 0 0 1px #ef4444; /* Double border pulse effect */
}

/* --- [NEW] PROTOCOL LENS TAGS (Adversarial Dashboard) --- */
/* Extends existing .th-badge system with IDNA-specific states */

/* Tier 3: Protocol Ambiguity (The Schism) */
/* Violet: Represents "Dual Nature" or "Shapeshifting" */
.th-med { 
  background: #f3e8ff; 
  color: #7e22ce; 
  border: 1px solid #d8b4fe; 
}

/* Tier 4: Ghost / Ignored (The Void) */
/* Gray: Represents disappearance or nullification */
.th-ghost {
  background: #f8fafc; 
  color: #64748b; 
  border: 1px solid #cbd5e1;
  text-decoration: line-through; /* Visual cue for "Ignored" */
  opacity: 0.8;
}

/* Predictive Normalizer Styles */
.predictive-wrapper {
    margin-top: 1.5rem;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    overflow: hidden;
    background: white;
}
.pred-header {
    background: #f8fafc;
    padding: 8px 12px;
    font-weight: 700;
    font-size: 0.85rem;
    color: #475569;
    border-bottom: 1px solid var(--color-border);
}
.pred-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
}
.pred-table th {
    text-align: left;
    padding: 6px 12px;
    background: #f1f5f9;
    color: #64748b;
    font-weight: 600;
}
.pred-table td {
    padding: 6px 12px;
    border-bottom: 1px solid #f1f5f9;
    font-family: var(--font-mono);
}
.pred-row.pred-changed td {
    background: #fffbeb; /* Light yellow for change */
}
.pred-row.pred-danger td {
    background: #fef2f2; /* Light red for danger */
    color: #b91c1c;
}
.pred-len {
    color: #94a3b8;
    font-size: 0.75rem;
}
.pred-footer {
    padding: 8px 12px;
    font-size: 0.75rem;
    color: #64748b;
    background: #f8fafc;
    border-top: 1px solid var(--color-border);
}
.pred-danger-text {
    color: #dc2626;
    font-weight: 700;
}

/* New 4x2 Grid for Profile Buttons */
.profile-copy-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 columns */
    gap: 8px;
    
    /* Spacing to separate it from Top Row and Sanitize Row */
    margin: 8px 0;
    padding: 10px 0;
    border-top: 1px dashed var(--color-border-light);
    border-bottom: 1px dashed var(--color-border-light);
}

/* Compact styling for Profile Buttons to fit the grid */
.prof-btn {
    /* 1. SIZE OVERRIDES (Keep these so they fit the grid) */
    height: 32px !important;       
    font-size: 0.75rem !important; 
    padding: 0 2px !important;
    
    /* 2. VISUAL MATCHING (Fixed to match main buttons) */
    background-color: transparent !important; /* Changed from #f9fafb to match others */
    border: 1px solid #d1d5db !important;     /* Darker border to match others */
    color: #4b5563 !important;                /* Darker text to match others */
    
    /* 3. STANDARD PROPERTIES */
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    
    display: inline-flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
    box-shadow: none !important;
}

/* Hover State - Matching the Violet Theme of the main buttons */
.prof-btn:hover {
    background-color: #f5f3ff !important; /* Violet-50 */
    border-color: #8b5cf6 !important;     /* Violet-500 */
    color: #7c3aed !important;            /* Violet-600 */
    
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(124, 58, 237, 0.1) !important;
    z-index: 2;
}

/* Active/Click State */
.prof-btn:active {
    transform: translateY(0);
    box-shadow: none !important;
}

/* ==========================================================================
   [STAGE 1.5] ADVERSARIAL INTELLIGENCE & FORENSIC VISUAL SYSTEM
   ========================================================================== */

/* --- MODULE 4: ADVERSARIAL DASHBOARD (The "Scoreboard") --- */
#adv-console {
    margin-top: 20px;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    background: #fff;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.adv-header {
    background: #f8fafc;
    padding: 10px 15px;
    border-bottom: 1px solid var(--color-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.adv-title {
    font-weight: 700;
    color: #334155;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.intel-badge {
    font-size: 0.7rem;
    padding: 2px 8px;
    border-radius: 12px;
    font-weight: 700;
    letter-spacing: 0.05em;
}
.intel-badge-safe { background: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
.intel-badge-warn { background: #fef9c3; color: #a16207; border: 1px solid #fde047; }
.intel-badge-danger { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }

/* Top Stats Bar */
.adversarial-stats {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1px;
    background: #e2e8f0; /* Grid lines */
    border-bottom: 1px solid var(--color-border);
}

.stat-box {
    background: #fff;
    padding: 10px;
    text-align: center;
    display: flex;
    flex-direction: column;
}

.stat-label { font-size: 0.65rem; color: #64748b; text-transform: uppercase; font-weight: 600; }
.stat-val { font-size: 1.1rem; font-weight: 700; color: #0f172a; font-family: var(--font-mono); }

.stat-alarm .stat-val { color: #dc2626; }
.stat-alarm .stat-label { color: #ef4444; }

/* Peak Row (Top Offender) */
.peak-row {
    display: flex;
    align-items: center;
    padding: 8px 15px;
    background: #fff1f2;
    border-bottom: 1px solid #fecaca;
    color: #9f1239;
    font-size: 0.85rem;
    gap: 12px;
}
.peak-label { font-weight: 700; font-size: 0.7rem; background: #e11d48; color: #fff; padding: 2px 6px; border-radius: 3px; }
.peak-token { font-family: var(--font-mono); font-weight: 700; background: #fff; padding: 1px 6px; border-radius: 3px; border: 1px solid #fda4af; }
.peak-tags { display: flex; gap: 6px; }
.peak-tag { font-size: 0.7rem; border: 1px solid #f43f5e; padding: 0 6px; border-radius: 10px; background: #fff0f7; }

/* --- MODULE 3: FORENSIC STACK (The Dual View) --- */
.forensic-stack {
    display: flex;
    flex-direction: column;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    margin-top: 15px;
    background: #fff;
}

.stack-separator {
    background: #f1f5f9;
    color: #94a3b8;
    text-align: center;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    padding: 4px;
    border-top: 1px solid var(--color-border);
    border-bottom: 1px solid var(--color-border);
    user-select: none;
}

/* --- VIEW A: X-RAY (DNA Alignment) --- */
.xray-container {
    padding: 15px;
    background: #fafafa;
    overflow-x: auto;
}

.xray-legend-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 10px;
    font-size: 0.7rem;
    color: #64748b;
    border-bottom: 1px solid #e5e7eb;
    padding-bottom: 5px;
}
.xl-item { display: flex; align-items: center; gap: 4px; }
.xl-dot { width: 8px; height: 8px; border-radius: 50%; }
.dot-red { background: #ef4444; }
.dot-gray { background: #cbd5e1; }

.xray-cluster {
    margin-bottom: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 4px;
    background: #fff;
}

.xray-meta {
    background: #f8fafc;
    padding: 4px 8px;
    font-size: 0.65rem;
    color: #94a3b8;
    border-bottom: 1px solid #e2e8f0;
    font-weight: 600;
    text-transform: uppercase;
}

.xray-strip {
    display: flex;
    padding: 8px;
    overflow-x: auto;
    gap: 2px;
}

.xray-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 24px;
    min-width: 24px;
    border-right: 1px dashed #f1f5f9;
}

.x-raw, .x-skel {
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-mono);
    font-size: 1rem;
}

.x-raw { border-bottom: 1px solid #e2e8f0; color: #334155; background: #f8fafc; width: 100%; }
.x-skel { color: #64748b; width: 100%; }

/* Drift Highlights */
.xray-drift .x-raw { background: #fee2e2; color: #dc2626; font-weight: 700; }
.xray-drift .x-skel { background: #fff; color: #dc2626; }

/* Void/Hidden */
.xray-void .x-raw { background: #f3f4f6; color: #9ca3af; font-size: 0.7rem; }
.xray-void .x-skel { color: #d1d5db; font-size: 0.7rem; }

.x-tag {
    font-size: 0.5rem;
    background: #e5e7eb;
    padding: 1px 2px;
    border-radius: 2px;
    color: #4b5563;
}

/* --- VIEW B: CLASSIC STREAM (Cards & Stacks) --- */
.xray-stream-wrapper {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 10px;
}

.cluster-card {
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0,0,0,0.03);
}

.cluster-header {
    background: #f8fafc;
    padding: 6px 10px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.cluster-body {
    padding: 10px;
    font-family: var(--font-mono);
    font-size: 0.95rem;
    line-height: 1.6;
    word-break: break-all;
    background: #fff;
}

/* The "Stacks" inside the stream text */
.xray-stack {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    vertical-align: middle;
    margin: 0 2px;
    border: 1px solid #cbd5e1;
    border-radius: 3px;
    padding: 0 2px;
    background: #f1f5f9;
    cursor: help;
    line-height: 1;
    min-width: 18px;
}

.xray-top { font-size: 0.9rem; font-weight: 700; padding-bottom: 1px; border-bottom: 1px solid #e2e8f0; }
.xray-bot { font-size: 0.55rem; font-weight: 600; text-transform: uppercase; padding-top: 1px; }

/* Threat-Specific Stack Styles */
.stack-bidi { border-color: #fcd34d; background: #fffbeb; color: #b45309; }
.stack-spoof { border-color: #fca5a5; background: #fef2f2; color: #991b1b; }
.stack-invis { border-color: #cbd5e1; background: #f8fafc; color: #64748b; }

.xray-safe { opacity: 0.6; }
.xray-control { color: #94a3b8; font-size: 0.8em; }

/* --- MODULE 2: TOKEN RISK LEDGER --- */
.token-ledger {
    max-height: 300px;
    overflow-y: auto;
    border-top: 1px solid var(--color-border);
}

.token-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
.token-table th { background: #f1f5f9; position: sticky; top: 0; z-index: 10; padding: 6px; text-align: left; color: #475569; font-size: 0.7rem; text-transform: uppercase; }
.token-table td { padding: 6px; border-bottom: 1px solid #f1f5f9; vertical-align: top; }

.token-link { font-family: var(--font-mono); font-weight: 600; color: #2563eb; text-decoration: none; }
.token-link:hover { text-decoration: underline; }
.token-kind { font-size: 0.65rem; color: #94a3b8; margin-top: 1px; }

/* Badges */
.badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; }
.badge-crit { background: #ffe4e6; color: #be123c; border: 1px solid #fda4af; }
.badge-high { background: #ffedd5; color: #c2410c; border: 1px solid #fdba74; }
.badge-warn { background: #fef9c3; color: #a16207; border: 1px solid #fde047; }
.badge-ok   { background: #dcfce7; color: #15803d; border: 1px solid #86efac; }

.script-mixed { color: #c2410c; font-weight: 600; }
.script-single { color: #64748b; }

.trigger-tag { display: inline-block; background: #f3f4f6; border: 1px solid #e5e7eb; padding: 1px 4px; border-radius: 3px; color: #4b5563; font-size: 0.7rem; margin-bottom: 2px; }
.trigger-tag-ok { color: #15803d; font-size: 0.7rem; opacity: 0.8; }

/* --- MODULE 5: PAYLOAD ALERT --- */
.payload-alert {
    margin: 10px 0;
    border: 2px solid #dc2626;
    border-radius: 6px;
    overflow: hidden;
    background: #fff;
    animation: pulse-border 2s infinite;
}

.pa-header {
    background: #dc2626;
    color: #fff;
    padding: 6px 10px;
    font-weight: 700;
    font-size: 0.8rem;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
}

.pa-body { padding: 10px; }

.pa-layers {
    font-size: 0.7rem;
    color: #6b7280;
    margin-bottom: 8px;
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
}

.layer-badge {
    background: #fee2e2;
    color: #991b1b;
    padding: 1px 5px;
    border-radius: 3px;
    border: 1px solid #fecaca;
    font-family: var(--font-mono);
}

.pa-content code {
    display: block;
    background: #1e293b;
    color: #4ade80;
    padding: 8px;
    border-radius: 4px;
    font-family: var(--font-mono);
    font-size: 0.85rem;
    margin-top: 4px;
    word-break: break-all;
}

.pa-waf {
    margin-top: 8px;
    font-size: 0.75rem;
    color: #dc2626;
    background: #fef2f2;
    padding: 4px 8px;
    border-radius: 4px;
    border: 1px solid #fecaca;
}

/* --- PREDICTIVE TABLE --- */
.predictive-wrapper {
    margin-top: 15px;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    overflow: hidden;
}

.pred-header { background: #f8fafc; padding: 6px 10px; font-size: 0.75rem; font-weight: 700; color: #475569; border-bottom: 1px solid #e2e8f0; }
.pred-table { width: 100%; border-collapse: collapse; font-size: 0.8rem; }
.pred-table th { text-align: left; background: #fff; color: #64748b; font-weight: 600; padding: 6px; border-bottom: 2px solid #f1f5f9; }
.pred-table td { padding: 6px; border-bottom: 1px solid #f1f5f9; }

.pred-row.pred-changed { background: #fffbeb; }
.pred-row.pred-danger { background: #fef2f2; }
.pred-form { font-weight: 700; color: #64748b; width: 60px; }
.pred-val { font-family: var(--font-mono); word-break: break-all; }

/* --- ANIMATIONS --- */
@keyframes pulse-border {
    0% { border-color: #dc2626; box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.4); }
    70% { border-color: #b91c1c; box-shadow: 0 0 0 6px rgba(220, 38, 38, 0); }
    100% { border-color: #dc2626; box-shadow: 0 0 0 0 rgba(220, 38, 38, 0); }
}

/* --- NEW HUD V2 LAYOUT --- */

/* Grid Structure */
.hud-grid-row-1 {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 12px;
}

.hud-verdict-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* The 4-Column Layout */
    gap: 12px;
    margin-bottom: 12px;
}

.hud-grid-row-2 {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 8px;
}

/* Verdict Card Styling */
.hud-verdict-card {
    border-radius: 6px;
    padding: 10px 12px;
    border: 1px solid;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 90px;
}

.v-header {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    opacity: 0.8;
    letter-spacing: 0.05em;
}

.v-main {
    margin-top: 4px;
}

.v-verdict {
    font-size: 1.1rem;
    font-weight: 800;
    font-family: var(--font-mono);
    line-height: 1.2;
}

.v-score {
    font-size: 0.7rem;
    opacity: 0.6;
    margin-top: 2px;
}

.v-footer {
    margin-top: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    border-top: 1px solid rgba(0,0,0,0.05);
    padding-top: 6px;
}

.v-sub-val {
    font-family: var(--font-mono);
    font-weight: 700;
}

/* Severity Themes */
.v-bg-crit { background: #fef2f2; border-color: #fecaca; color: #991b1b; }
.v-text-crit { color: #dc2626; }

.v-bg-warn { background: #fffbeb; border-color: #fde68a; color: #92400e; }
.v-text-warn { color: #d97706; }

.v-bg-ok { background: #f0fdf4; border-color: #bbf7d0; color: #166534; }
.v-text-ok { color: #15803d; }

/* ==========================================================================
   FORENSIC HUD V2 ("The Sprawl")
   Target ID: #forensic-hud
   ========================================================================== */

#forensic-hud {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
    margin-bottom: 24px;
    font-family: var(--font-sans);
}

/* --- ROW 1: THE COUNTS (Merged 8-Column Grid) --- */
.hud-grid-row-1 {
    display: grid;
    /* 8 Columns: 3 Volumetric + 5 Structural */
    grid-template-columns: repeat(8, 1fr); 
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

/* --- ROWS 2-5: LEDGER ROWS (Detail View) --- */
.hud-detail-row {
    display: flex;
    align-items: center;
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 6px;
    overflow: hidden;
    min-height: 80px; /* Slightly taller for icons */
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    transition: transform 0.1s ease, box-shadow 0.1s ease;
    cursor: alias; /* Suggests jumping to detail view */
}

.hud-detail-row:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.08);
}

/* LEFT: The Verdict Header (Fixed Width) */
.hud-detail-left {
    flex: 0 0 200px; /* Fixed width for alignment */
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 16px;
    border-right: 1px solid rgba(0,0,0,0.05);
}

/* Icon Container */
.h-icon-box {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.h-icon-box svg {
    width: 100%;
    height: 100%;
    stroke-width: 2px;
}

.h-meta {
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.h-title {
    font-size: 0.65rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 2px;
    opacity: 0.8;
}

.h-verdict {
    font-size: 1.1rem;
    font-weight: 800;
    font-family: var(--font-mono);
    line-height: 1.1;
    text-transform: uppercase;
}

.h-score {
    font-size: 0.7rem;
    font-family: var(--font-mono);
    opacity: 0.7;
    margin-top: 2px;
}

/* RIGHT: The Chip Container */
.hud-detail-right {
    flex: 1;
    display: flex;
    align-items: center; /* Vertically center the row of chips */
    justify-content: flex-start !important; /* FORCE LEFT ALIGNMENT */
    flex-wrap: wrap;
    padding: 12px 16px;
    gap: 8px;
    background-color: #ffffff;
    align-content: center; /* Center lines vertically */
}

/* --- CHIPS (The Data) --- */
.hud-chip {
    display: inline-flex;
    align-items: center;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 4px;
    border: 1px solid transparent;
    white-space: nowrap;
    font-family: var(--font-mono);
}

.chip-dim {
    background-color: #f3f4f6;
    color: #9ca3af;
    font-style: italic;
    font-family: var(--font-sans);
}

.chip-ok {
    background-color: #f0fdf4;
    color: #166534;
    border-color: #bbf7d0;
}

.chip-warn {
    background-color: #fffbeb;
    color: #b45309;
    border-color: #fde68a;
}

.chip-crit {
    background-color: #fef2f2;
    color: #991b1b;
    border-color: #fecaca;
}

/* --- THEMES (Row Colors) --- */
/* Critical */
.bg-crit { background-color: #fef2f2; }
.border-crit { border-left: 4px solid #ef4444; }
.text-crit { color: #991b1b; }
.text-crit svg { stroke: #ef4444; }

/* Warning */
.bg-warn { background-color: #fffbeb; }
.border-warn { border-left: 4px solid #f59e0b; }
.text-warn { color: #92400e; }
.text-warn svg { stroke: #f59e0b; }

/* OK */
.bg-ok { background-color: #f0fdf4; }
.border-ok { border-left: 4px solid #10b981; }
.text-ok { color: #166534; }
.text-ok svg { stroke: #10b981; }

/* --- RESPONSIVE --- */
@media (max-width: 1300px) {
    .hud-grid-row-1 {
        grid-template-columns: repeat(4, 1fr); /* Break to 2 rows of 4 */
    }
}

@media (max-width: 768px) {
    .hud-detail-row {
        flex-direction: column;
        height: auto;
    }
    .hud-detail-left {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid #f3f4f6;
        flex: 0 0 auto;
    }
}

/* --- THEME: NEUTRAL (The "Waiting" Regime) --- */
.bg-neutral { background-color: #f9fafb; } /* Very light gray */
.border-neutral { border-left: 4px solid #d1d5db; } /* Gray border */
.text-neutral { color: #6b7280; } /* Dark gray text */
.text-neutral svg { stroke: #9ca3af; } /* Muted icon stroke */

/* ==========================================================================
   STATUS LINE (RESTORED DESIGN + VISIBILITY FIX)
   ========================================================================== */

/* --- LEFT STATUS (Input: Ready) --- */
#status-line {
    display: inline-flex !important; /* Restore Pill Shape */
    align-items: center;
    padding: 2px 12px;
    border-radius: 999px;
    font-size: 0.85rem;
    font-family: var(--font-mono);
    font-weight: 600;
    border: 1px solid transparent;
    transition: all 0.2s ease;
    margin-top: 8px; /* Keep spacing */
    
    /* FORCE VISIBILITY */
    opacity: 1 !important;
    visibility: visible !important;
    min-height: 24px;
    color: #374151; /* Default text color if no class */
}

#status-line.status-loading {
    background-color: #f3f4f6;
    color: #6b7280;
    border-color: #e5e7eb;
}

#status-line.status-ready {
    background-color: #f0fdf4; 
    border-color: #bbf7d0;      
    color: #000000;            
}

#status-line.status-revealed {
    background-color: #ffffff;
    color: #2563eb; 
    border-color: #60a5fa;
    box-shadow: 0 1px 3px rgba(37, 99, 235, 0.15);
}

/* --- RIGHT STATUS (Forensic Pill) --- */
.status-details {
    display: inline-flex;
    align-items: center;
    margin: 0; 
    padding: 2px 12px;
    border-radius: 999px;
    font-size: 0.85rem;
    font-family: var(--font-mono);
    font-weight: 600;
    border: 1px solid transparent;
    
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.status-details.clean {
    opacity: 1;
    visibility: visible;
    background-color: #f0fdf4;
    border-color: #bbf7d0;
    color: #000000; 
}

.status-details.warn {
    opacity: 1;
    visibility: visible;
    background-color: #fffbeb;
    color: #000000;
    border-color: #fcd34d;
}

.status-details.success {
    opacity: 1;
    visibility: visible;
    background-color: #ecfdf5;
    color: #047857;
    border-color: #6ee7b7;
}

/* --- ICON RESTORATION --- */
#status-line.status-ready svg,
.status-details.clean svg {
    stroke: #15803d !important;   
    stroke-width: 3;
    margin-left: 8px !important;  
    margin-right: 0 !important;
}

/* FIX METADATA WRAPPING */
.hud-console .console-col {
    white-space: normal !important; /* Allow text to wrap */
    overflow: visible;              /* Show overflow */
    word-break: break-word;         /* Break long words if needed */
    padding-right: 12px;            /* Add spacing between cols */
}

/* --- STATUS BAR LAYOUT (Close the Gap) --- */
/* Assuming the container ID is #status-bar-container or similar */
/* If you don't know the ID, this generic selector targets the area */
.status-bar-wrapper, 
#status-line-container { 
    display: flex;
    align-items: center;
    justify-content: flex-start; /* FIX: Push everything Left (closes gap) */
    gap: 16px; /* Define exact gap between Status Pill and Dropdown */
    width: 100%;
    margin-top: 8px;
}

/* =========================================
   HUD STEPPER STATUS (The Left Pillar)
   ========================================= */

/* [FIX] increased specificity (.status-details.status-hud-active) 
   to override the default .status-details hidden state defined later in the file */
.status-details.status-hud-active {
    display: inline-flex !important;
    align-items: center;
    gap: 6px;
    padding: 2px 10px;
    margin-left: 12px;
    
    /* The "Pill" Look */
    background-color: #fffbeb; /* Amber-50 */
    border: 1px solid #fcd34d; /* Amber-200 */
    border-radius: 9999px;
    
    /* Typography */
    font-family: var(--font-mono);
    font-size: 0.75rem;
    font-weight: 600;
    color: #b45309; /* Amber-700 */
    
    /* Animation & Visibility Force */
    animation: fadeIn 0.2s ease-out;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    
    /* CRITICAL: Override the default hidden state */
    opacity: 1 !important;
    visibility: visible !important;
}

.status-details.status-hud-active svg {
    color: #b45309;
}

/* =========================================
   HERO ROW INTERACTIVE COUNTER (The Middle Pillar)
   ========================================= */

/* Update the Hero Row to support 3 columns */
.hud-detail-row {
    /* Existing styles remain... */
    display: flex;
    align-items: stretch; /* Ensure all cols are same height */
    gap: 0; /* Remove gap, handle via padding/borders */
}

/* 1. Left (Header) - Existing, just ensuring sizing */
.hud-detail-left {
    flex: 0 0 190px; /* Fixed width */
}

/* 2. Center (The Interactive Counter) - NEW */
.hud-detail-center {
    flex: 0 0 70px; /* Fixed width for the number */
    display: flex;
    align-items: center;
    justify-content: center;
    border-right: 1px solid rgba(0,0,0,0.05);
    background-color: #ffffff;
}

/* The Clickable Number */
.interactive-count {
    font-family: var(--font-mono);
    font-size: 1.4rem;
    font-weight: 700;
    color: #d1d5db; /* Default muted color */
    cursor: default;
    padding: 4px 12px;
    border-radius: 4px;
    transition: all 0.2s ease;
    user-select: none;
}

/* Active State (Clickable) */
.interactive-count.active {
    cursor: pointer;
    color: #d97706; /* Amber */
    background-color: #fffbeb;
    border: 1px solid #fcd34d;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.interactive-count.active:hover {
    transform: scale(1.1);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    color: #b45309;
    border-color: #f59e0b;
}

/* Critical Override */
.interactive-count.active.crit {
    color: #dc2626;
    background-color: #fef2f2;
    border-color: #fca5a5;
}

/* 3. Right (Chips) - Existing, ensure it takes remaining space */
.hud-detail-right {
    flex: 1;
}

/* Force the center column to stack vertically */
.hud-detail-center {
    display: flex;
    flex-direction: column;       /* <--- CRITICAL: Stacks items top-to-bottom */
    align-items: center;          /* Centers them horizontally */
    justify-content: center;      /* Centers them vertically */
    min-width: 60px;              /* Ensures stable width */
    padding: 3 12px;
    line-height: 2;               /* Tightens vertical spacing */
}

/* Ensure the counter number is big and block-like */
.interactive-count {
    display: inline-block;
    font-size: 1.5rem;            /* Adjust size as needed */
    font-weight: 800;
    margin-top: 4px;              /* Push it down slightly from the label */
    padding: 0 8px;               /* Horizontal padding inside the red box */
    line-height: 1.2;             /* Tighter height to prevent vertical bloat */
    border-radius: 4px;           /* Subtle rounding for the background */
}

/* =========================================
   INVISIBLE ATLAS (Forensic Legend v3.0)
   ========================================= */

/* 1. Main Container */
.atlas-content {
  display: block;
  background-color: #ffffff;
  border: 1px solid #cbd5e1;
  border-radius: 8px; /* Softer corners */
  margin-top: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

/* 2. Description Header */
.atlas-desc {
  padding: 4px 4px;
  font-size: 0.9rem;
  color: #334155;
  background-color: #ffffff;
  border-bottom: 1px solid #e2e8f0;
  line-height: 1.5;
}

/* 3. Summary Ribbon (Metrics) */
.atlas-summary-bar {
  display: flex;
  flex-direction: row;
  align-items: center;
  background-color: #ffffff;
  border-bottom: 1px solid #e2e8f0;
  height: 80px; /* Taller for better vertical rhythm */
  overflow-x: auto;
  scrollbar-width: thin;
}

.atlas-sum-metric {
  flex: 0 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  padding: 0 20px;
  border-right: 1px solid #f1f5f9;
  transition: background-color 0.2s;
}

.atlas-sum-metric:hover {
  background-color: #f8fafc;
}

.atlas-sum-metric.main {
  background-color: #ffffff;
  border-right: 2px solid #e2e8f0;
}

.sum-label {
  font-size: 0.7rem;
  font-weight: 800;
  color: #64748b;
  letter-spacing: 0.05em;
  margin-bottom: 6px;
  text-transform: uppercase;
}

.sum-val {
  font-family: "SF Mono", "Segoe UI Mono", "Roboto Mono", monospace;
  font-size: 1.4rem;
  font-weight: 700;
  color: #1e293b;
}

/* Ribbon Colors */
.sum-val.safe    { color: #166534; } /* Green */
.sum-val.ghost   { color: #7c3aed; } /* Purple */
.sum-val.neutral { color: #64748b; } /* Gray */
.sum-val.warn    { color: #d97706; } /* Amber */
.sum-val.crit    { color: #dc2626; } /* Red */

/* 4. The Data Table (The Core Fix) */
.atlas-table {
  width: auto;
  border-collapse: separate; /* Allows distinct border styling */
  border-spacing: 0;
  font-size: 0.85rem;
  text-align: center;
  white-space: nowrap;
  flex-wrap: nowrap;
  padding: 8px 8px;
}

/* Header Styling */
.atlas-table th {
  background-color: #ffffff;
  color: #475569;
  font-weight: 700;
  font-size: 0.75rem;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  border-bottom: 2px solid #e2e8f0;
  border-right: 1px solid #f1f5f9; /* Subtle column separator */
  vertical-align: middle;
  text-align: center;
  white-space: nowrap;
  flex-wrap: nowrap;
  padding: 8px 8px;
}

.atlas-table th:last-child {
  border-right: none;
}

/* Cell Styling */
.atlas-table td {
  border-bottom: 1px solid #f1f5f9;
  border-right: 1px solid #f8fafc; /* Very subtle separator */
  vertical-align: middle;
  color: #334155;
  text-align: center;
  vertical-align: middle;
  white-space: nowrap;
  flex-wrap: nowrap;
  padding: 8px 8px;
}

.atlas-table tr:hover td {
  background-color: #f8fafc;
}

/* 5. Column Specifics (Addressing the "Depression") */

/* Symbol Column */
.atlas-table td:nth-child(1) {
  text-align: center;
  background-color: #fcfcfc; /* Slight tint for ID column */
  white-space: nowrap;
  flex-wrap: nowrap;
  padding: 8px 8px;
}

/* Code Column (The Fix) */
.code-col {
  font-family: "SF Mono", "Segoe UI Mono", "Roboto Mono", monospace;
  font-weight: 600;
  color: #475569;
  font-size: 0.8rem;
  /* Ensure it doesn't wrap U+XXXX */
  white-space: nowrap;
  flex-wrap: nowrap;
  text-align: center;
  padding: 8px 8px;
}

/* Name Column (The Taming) */
.name-col {
  /* This combination forces the column to truncate instead of expanding */
  width: 100%;
  white-space: nowrap;
  flex-wrap: nowrap;
  text-overflow: ellipsis;
  color: #1e293b;
  font-weight: 500;
  text-align: center;
}

/* Count Column */
.count-col {
  text-align: center;
  font-family: "SF Mono", "Segoe UI Mono", "Roboto Mono", monospace;
  font-weight: 700;
  color: #0f172a;
  white-space: nowrap;
  flex-wrap: nowrap;
  text-align: center;
  padding: 8px 8px;
}

/* 6. Forensic Badges & Properties */

/* Badge Container */
.props-flex {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start;
  gap: 4px;
  white-space: nowrap;
  flex-wrap: nowrap;
  text-align: center;
}

/* FORENSIC SPECIMEN CHIP */
.atlas-glyph {
  /* Typography */
  font-family: "SF Mono", "Consolas", "Liberation Mono", Menlo, monospace;
  font-size: 0.75rem;
  font-weight: 700;
  color: #334155; /* Slate 700 - Strong, readable text */
  letter-spacing: -0.02em;

  /* The "Chip" Look */
  background-color: #ffffff; /* Clean white background */
  border: 1px solid #cbd5e1; /* Sharp definition */
  border-bottom: 2px solid #94a3b8; /* "Tactile" bottom edge for depth */
  border-radius: 6px; /* Slightly softer corners */
  
  /* Layout */
  padding: 4px 10px; /* Wider horizontal padding for "Tag" feel */
  display: inline-block;
  min-width: 60px; /* Enforces uniformity for short tags like [RLO] */
  text-align: center;
  
  /* Interaction Hint */
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.atlas-badge {
  display: inline-block;
  font-size: 0.65rem;
  font-weight: 700;
  text-transform: uppercase;
  padding: 8px 8px;
  border-radius: 12px; /* Capsule shape */
  border: 1px solid transparent;
  white-space: nowrap;
}

/* Badge Themes */
.atlas-badge-neutral { background: #f1f5f9; color: #64748b; border-color: #e2e8f0; }
.atlas-badge-ghost   { background: #f3e8ff; color: #7e22ce; border-color: #d8b4fe; }
.atlas-badge-safe    { background: #f0fdf4; color: #166534; border-color: #bbf7d0; }
.atlas-badge-warn    { background: #fffbeb; color: #b45309; border-color: #fde68a; }
.atlas-badge-high    { background: #ffedd5; color: #c2410c; border-color: #fdba74; }
.atlas-badge-crit    { background: #fef2f2; color: #991b1b; border-color: #fca5a5; }

/* 7. Forensic Micro-Properties (Physics & Stability) */
.prop-badge {
  font-family: "SF Mono", "Segoe UI Mono", "Roboto Mono", monospace;
  font-size: 0.65rem;
  font-weight: 600;
  padding: 8px 8px;
  border-radius: 4px;
  border: 1px solid transparent;
  cursor: help;
  white-space: nowrap;
  letter-spacing: -0.02em;
}

/* Property Colors */
.prop-zero   { background: #f1f5f9; color: #64748b; border-color: #cbd5e1; } /* Neutral */
.prop-wide   { background: #f0f9ff; color: #0369a1; border-color: #bae6fd; } /* Info */
.prop-gc     { background: #ffffff; color: #475569; border-color: #e2e8f0; font-weight: 700; box-shadow: 0 1px 2px rgba(0,0,0,0.05); } 
.prop-ghost  { background: #faf5ff; color: #7e22ce; border-color: #e9d5ff; } /* Special */
.prop-stable { background: #f0fdf4; color: #15803d; border-color: #bbf7d0; opacity: 0.8; }
.prop-crit   { background: #fef2f2; color: #991b1b; border-color: #fca5a5; }
.prop-warn   { background: #fffbeb; color: #b45309; border-color: #fde68a; }
.prop-info   { background: #eff6ff; color: #1d4ed8; border-color: #bfdbfe; }

/* 8. Action Button */
.atlas-btn {
  font-size: 0.7rem;
  font-weight: 700;
  color: #4338ca;
  background: #eef2ff;
  border: 1px solid #c7d2fe;
  border-radius: 4px;
  cursor: pointer;
  text-transform: uppercase;
  transition: all 0.2s;
  padding: 8px 8px;
}

.atlas-btn:hover {
  background: #4f46e5;
  color: #ffffff;
  border-color: #4338ca;
  box-shadow: 0 2px 4px rgba(79, 70, 229, 0.2);
}

/* Empty State */
.empty-state {
  padding: 0px;
  text-align: center;
  color: #94a3b8;
  font-style: italic;
  font-size: 0.9rem;
}

/* --- LEGEND BAR (Forensic Dimensions) --- */
.atlas-legend-bar {
  display: flex;
  flex-direction: row;
  gap: 40px; /* Space between definitions */
  padding: 10px 10px;
  border-bottom: 1px solid #e2e8f0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  font-size: 1.2rem;
  color: #64748b;
  overflow-x: auto; /* Safety scroll for small screens */
  margin-right: 30px;
}

.legend-header {
  font-weight: 800;
  color: #334155;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-right: 8px;
  margin-left: 10px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
  font-size: 0.9rem;
}

.legend-key {
  font-family: "SF Mono", "Segoe UI Mono", "Roboto Mono", monospace;
  font-weight: 700;
  color: #475569;
  background: #e2e8f0;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.9rem;
}

.legend-val {
  font-weight: 500;
  color: #64748b;
}


/* --- METADATA WORKBENCH HEADER (SOTA V3) --- */

.metadata-header-panel {
    background: #fdfbff; /* Subtle violet tint for Anomaly context */
    border: 1px solid #e5e7eb;
    border-left: 4px solid #8b5cf6; /* Violet Accent to match Anomaly logic */
    border-radius: 4px;
    padding: 12px 16px;
    margin-bottom: 12px;
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

/* Row 1: Scope & Definition */
.metadata-scope-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 10px;
    margin-bottom: 10px;
    border-bottom: 1px solid #f3f4f6;
}

.scope-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.scope-badge {
    background: #8b5cf6;
    color: #fff;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 3px 6px;
    border-radius: 3px;
    letter-spacing: 0.05em;
    font-family: 'JetBrains Mono', monospace; /* Technical font */
    display: inline-flex;
    align-items: center;
}

.scope-mime {
    font-size: 0.65rem;
    color: #8b5cf6;
    font-weight: 600;
    font-family: 'JetBrains Mono', monospace;
    opacity: 0.9;
}

.scope-desc {
    font-size: 0.75rem;
    color: #6b7280;
    line-height: 1.2;
    text-align: right;
}

/* Row 2: Sensor Legend */
.metadata-sensor-row {
    display: flex;
    align-items: center;
    gap: 12px;
}

.sensor-label {
    font-size: 0.65rem;
    font-weight: 700;
    color: #9ca3af;
    letter-spacing: 0.05em;
    white-space: nowrap;
}

.sensor-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.sensor-chip {
    display: inline-flex;
    align-items: center;
    font-size: 0.65rem;
    color: #4b5563;
    background: #fff;
    padding: 2px 8px;
    border: 1px solid #e5e7eb;
    border-radius: 12px; /* Pill shape */
    font-weight: 600;
    letter-spacing: 0.02em;
    cursor: help;
    transition: all 0.15s ease;
}

.sensor-chip:hover {
    border-color: #d8b4fe;
    color: #7c3aed;
    background: #f5f3ff;
}

/* The CSS-generated Dot (Replaces Emoji) */
.sensor-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    background-color: #d1d5db; /* Inactive Gray */
    border-radius: 50%;
    margin-right: 6px;
    transition: background-color 0.2s;
}

/* Active State on Hover */
.sensor-chip:hover .sensor-dot {
    background-color: #8b5cf6; /* Violet active state */
    box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.2);
}

/* --- METADATA INPUT PLACEHOLDER LOGIC --- */

/* Only shows when the div is completely empty */
.metadata-editable-box:empty::before {
    content: attr(data-placeholder);
    color: #9ca3af; /* Muted placeholder gray */
    pointer-events: none; /* Allows clicks to pass through to the cursor */
    font-style: italic;
    display: block; /* Ensures it renders correctly */
}

/* Optional: Focus state styling for better UX */
.metadata-editable-box:focus {
    outline: none;
    border-color: #8b5cf6 !important; /* Violet focus ring */
    background-color: #ffffff !important;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

/* [BLOCK 9] TOPOLOGY CSS REFERENCE */

.topo-evidence-box {
    margin-top: 8px;
    padding-top: 6px;
    border-top: 1px solid var(--border-subtle);
}

.topo-evidence-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.topo-chip-stream {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    max-height: 60px; /* Force Scroll */
    overflow-y: auto; /* Enable Scroll */
    scrollbar-width: thin;
}

.topo-chip {
    font-size: 0.75rem;
    font-family: var(--font-mono);
    padding: 2px 6px;
    border-radius: 3px;
    background: var(--bg-surface);
    border: 1px solid var(--border-subtle);
    cursor: default;
}

.chip-syntax {
    color: var(--color-crit); /* Red Text for Quotes */
    border-color: var(--color-crit-dim);
    background: var(--bg-crit-faint);
}

.chip-geo {
    color: var(--color-warn); /* Amber Text for Raggedness */
    border-color: var(--color-warn-dim);
    background: var(--bg-warn-faint);
}

/* [BLOCK 9] GLITCHMAP PANEL CSS */

.glitch-panel {
    border-left: 3px solid var(--color-warn); /* Amber accent */
}

.gl-diagnosis {
    margin: 8px 0;
    font-size: 0.85rem;
    font-family: var(--font-mono);
}

.gl-diag-label { color: var(--text-muted); }
.gl-diag-val { color: var(--text-main); font-weight: 600; }

/* Density Gauge */
.gl-gauge-wrapper { margin-bottom: 12px; }
.gl-gauge-label { font-size: 0.7rem; color: var(--text-muted); margin-bottom: 2px; }
.gl-gauge-track {
    height: 4px;
    background: var(--bg-surface-dim);
    border-radius: 2px;
    overflow: hidden;
}
.gl-gauge-fill { height: 100%; }

/* Matrix Table */
.gl-matrix-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.75rem;
    font-family: var(--font-mono);
}

.gl-matrix-table th {
    text-align: left;
    color: var(--text-muted);
    font-weight: normal;
    padding-bottom: 4px;
    border-bottom: 1px solid var(--border-subtle);
}

.glitch-row td { padding: 4px 0; vertical-align: middle; }

.gl-cell-art { width: 1%; white-space: nowrap; }
.gl-pill {
    background: var(--bg-warn-faint);
    color: var(--color-warn-dark);
    padding: 1px 5px;
    border-radius: 3px;
    border: 1px solid var(--color-warn-dim);
    font-weight: bold;
}

.gl-cell-arrow { color: var(--text-muted); padding: 0 6px; }

.gl-cell-hyp { color: var(--text-success); opacity: 0.9; }
.gl-ghost { font-style: italic; }

.gl-cell-fam { color: var(--text-muted); font-size: 0.7rem; }
.gl-cell-cnt { text-align: right; padding-right: 8px; font-weight: 600; }
.gl-cell-loc { text-align: right; }

.gl-more {
    text-align: center;
    color: var(--text-muted);
    font-style: italic;
    padding-top: 6px;
}

/* --- FORENSIC UI SYSTEM V2 --- */
:root {
    --fx-font-mono: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
    --fx-font-sans: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    --fx-col-crit: #e11d48; /* Rose-600 */
    --fx-col-warn: #d97706; /* Amber-600 */
    --fx-col-safe: #059669; /* Emerald-600 */
    --fx-col-info: #2563eb; /* Blue-600 */
    --fx-col-slate: #475569;
    --fx-bg-subtle: #f8fafc;
    --fx-border: #e2e8f0;
}

.fx-card {
    background: #fff;
    border: 1px solid var(--fx-border);
    border-radius: 8px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    margin-bottom: 20px;
    overflow: hidden;
    font-family: var(--fx-font-sans);
}

.fx-header {
    padding: 12px 16px;
    border-bottom: 1px solid var(--fx-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--fx-bg-subtle);
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--fx-col-slate);
    letter-spacing: 0.05em;
    text-transform: uppercase;
}

.fx-badge {
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 800;
}
.fx-badge.ok { background: #d1fae5; color: var(--fx-col-safe); }
.fx-badge.warn { background: #fef3c7; color: var(--fx-col-warn); }
.fx-badge.crit { background: #ffe4e6; color: var(--fx-col-crit); }

/* --- MODULE 1: TOPOLOGY (Grid Physics) --- */
.topo-layout { display: flex; flex-direction: column; }
.topo-metrics { display: flex; padding: 16px; align-items: center; gap: 24px; border-bottom: 1px solid var(--fx-border); }
.topo-stat-big { display: flex; flex-direction: column; }
.ts-val { font-family: var(--fx-font-mono); font-size: 1.5rem; font-weight: 700; color: #0f172a; }
.ts-dim { color: #94a3b8; font-weight: 300; margin: 0 2px; }
.ts-lbl { font-size: 0.65rem; color: #64748b; font-weight: 600; text-transform: uppercase; }

.topo-bar-container { flex: 1; display: flex; flex-direction: column; justify-content: center; }
.tb-meta { display: flex; justify-content: space-between; font-size: 0.7rem; color: #64748b; margin-bottom: 6px; }
.tb-track { height: 8px; background: #f1f5f9; border-radius: 4px; overflow: hidden; }
.tb-fill { height: 100%; transition: width 0.3s ease; }
.tb-fill.ok { background: var(--fx-col-safe); }
.tb-fill.crit { background: var(--fx-col-crit); }

.topo-console { background: #1e293b; padding: 10px; font-family: var(--fx-font-mono); font-size: 0.7rem; color: #e2e8f0; max-height: 120px; overflow-y: auto; }
.tc-row { display: flex; gap: 10px; margin-bottom: 4px; padding: 2px 0; border-bottom: 1px solid #334155; }
.tc-idx { color: #94a3b8; min-width: 40px; }
.tc-type-geo { color: #fcd34d; font-weight: 700; } /* Geometry = Amber */
.tc-type-syn { color: #f87171; font-weight: 700; } /* Syntax = Red */

/* --- MODULE 2: DECODE HEALTH (Medical Chart) --- */
.glitch-dashboard { padding: 0; }
.diagnosis-strip { padding: 12px 16px; display: flex; gap: 12px; align-items: center; border-bottom: 1px dashed var(--fx-border); }
.diag-icon { font-size: 1.2rem; }
.diag-main { font-weight: 700; color: #334155; font-size: 0.9rem; }
.diag-meta { font-size: 0.75rem; color: #64748b; margin-left: auto; }

.artifact-grid { display: grid; grid-template-columns: auto 1fr auto; }
.ag-row { display: contents; }
.ag-cell { padding: 8px 16px; border-bottom: 1px solid var(--fx-border); font-size: 0.8rem; align-self: center; }
.ag-source { font-family: var(--fx-font-mono); color: #b91c1c; background: #fff1f2; border-radius: 4px; padding: 2px 6px; display: inline-block;}
.ag-arrow { color: #94a3b8; font-size: 0.8rem; padding: 0 8px; }
.ag-target { font-family: var(--fx-font-mono); color: var(--fx-col-safe); font-weight: 700; }
.ag-fam { font-size: 0.65rem; color: #64748b; text-transform: uppercase; background: #f1f5f9; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
.ag-count { font-family: var(--fx-font-mono); font-weight: 700; color: #334155; text-align: right; }
.ag-loc { text-align: right; font-size: 0.75rem; }
.ag-loc a { color: var(--fx-col-info); text-decoration: none; }

/* --- MODULE 3: WHITESPACE (Substrate) --- */
.ws-panel { padding: 16px; }
.ws-alert-box { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
.ws-alert { padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; display: flex; gap: 8px; align-items: center; }
.ws-alert.crit { background: #fff1f2; border: 1px solid #fecdd3; color: #9f1239; }
.ws-alert.info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }

.ws-spectrum { height: 24px; display: flex; border-radius: 6px; overflow: hidden; margin-bottom: 16px; border: 1px solid var(--fx-border); }
.ws-seg { height: 100%; transition: width 0.3s; position: relative; }
.ws-seg:hover::after { content: attr(title); position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #000; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; white-space: nowrap; pointer-events: none; margin-bottom: 4px; }

/* Whitespace Colors */
.bg-sp { background: #cbd5e1; } /* Space = Grey */
.bg-lf { background: #3b82f6; } /* LF = Blue */
.bg-ls { background: #ef4444; } /* LS = Red */
.bg-tab { background: #eab308; } /* TAB = Yellow */
.bg-crlf { background: #a855f7; } /* CRLF = Purple */

.ws-legend { display: flex; flex-wrap: wrap; gap: 12px; font-size: 0.75rem; color: #475569; }
.wl-item { display: flex; align-items: center; gap: 6px; }
.wl-dot { width: 8px; height: 8px; border-radius: 50%; }
.wl-val { font-family: var(--fx-font-mono); font-weight: 700; color: #0f172a; margin-left: 4px;}



/* ==========================================================================
   FORENSIC FOOTER (Stage 1.7 Advanced UI)
   Design: Clean White, Lab Instrument Aesthetic, High Readability
   ========================================================================== */

/* 1. The Wrapper (Animation & Positioning) */
#inspector-forensic-footer {
    margin-top: 16px;
    width: 100%;
    min-height: 0;
    animation: forensicSlideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
}

/* 2. The Card (Structure & Depth) */
.forensic-footer {
    display: flex;
    font-family: 'IBM Plex Mono', 'Menlo', 'Consolas', monospace;
    width: 100%;
    background: #ffffff;
    border-radius: 8px; /* Softer corners */
    /* Elegant, multi-layer shadow for "floating" effect */
    box-shadow: 
        0 1px 3px rgba(0, 0, 0, 0.04), 
        0 4px 12px rgba(0, 0, 0, 0.03);
    overflow: hidden;
    border: 1px solid rgba(0,0,0,0.08); /* Fallback border */
}

/* 3. The Verdict Spine (Left Column) */
.forensic-left {
    flex: 0 0 190px; /* Slightly wider for better breathing room */
    padding: 16px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    z-index: 1;
}

/* Typography for the Verdict */
.f-label {
    font-size: 0.6rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 700;
    opacity: 0.85;
    margin-bottom: 6px;
}

.f-level {
    font-size: 1.35rem; /* Large impact font */
    font-weight: 800;
    letter-spacing: -0.03em;
    margin-bottom: 6px;
    line-height: 1;
}

.f-verdict {
    font-size: 0.75rem;
    font-weight: 600;
    line-height: 1.35;
    margin-bottom: 12px;
}

/* 4. The Data Canvas (Right Column) */
.forensic-right {
    flex: 1;
    padding: 16px 24px;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 12px; /* Consistent rhythm between sections */
}

/* 5. The "Context Lenses" (Code / DNS / Text Boxes) */
/* Targeting the specific flex container generated by Python */
.forensic-right > div:first-child {
    display: flex;
    gap: 12px;
    width: 100%;
}

/* The Individual Lens Cards */
.forensic-right > div:first-child > div {
    /* Refine the inline styles with CSS polish */
    box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: default;
}

.forensic-right > div:first-child > div:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.06);
}

/* 6. Highlights & Details */
.f-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.forensic-badge {
    display: inline-block;
    font-size: 0.6rem;
    font-weight: 700;
    padding: 3px 7px;
    border-radius: 4px;
    background: rgba(255,255,255,0.7); /* Translucent glass effect */
    backdrop-filter: blur(4px);
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    margin-bottom: 2px;
}

/* 7. Context / Notes Section */
.f-ctx {
    font-size: 0.75rem;
    color: #6b7280;
    /* Subtle separation line */
    padding-top: 10px;
    border-top: 1px dashed #e5e7eb;
}

/* 8. Animation Keyframes */
@keyframes forensicSlideIn {
    from { 
        opacity: 0; 
        transform: translateY(-8px) scale(0.99); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
    }
}

/* Mobile Responsiveness */
@media (max-width: 700px) {
    .forensic-footer {
        flex-direction: column;
    }
    .forensic-left {
        flex: 0 0 auto;
        border-right: none !important;
        border-bottom: 1px solid rgba(0,0,0,0.1);
        padding: 12px 16px;
    }
    .forensic-right > div:first-child {
        flex-wrap: wrap;
    }
}

/* =========================================
   ATOMIC PROFILE (Forensic Identity Card V2)
   Design: Hierarchical Stack, High-Contrast Triage
   ========================================= */

/* The Container */
.atomic-profile-container {
    display: flex;
    flex-direction: column;
    background: #ffffff;
    border: 1px solid #e2e8f0;
    border-radius: 0px;
    overflow: hidden;
    height: 100%;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 
                0 2px 4px -1px rgba(0, 0, 0, 0.03);
}

/* Row 1: Header */
.atomic-header {
    background: #f8fafc;
    color: #64748b;
    font-family: var(--font-sans, system-ui, sans-serif);
    font-size: 0.65rem;
    font-weight: 800;
    letter-spacing: 0.1em;
    padding: 10px 0;
    border-bottom: 1px solid #e2e8f0;
    text-transform: uppercase;
    text-align: center;
}

/* The Body Wrapper */
.atomic-body {
    padding: 14px;
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
    gap: 8px; /* Spacing between the major blocks */
}

/* --- BLOCK 1: TIER BOX (The Big Number) --- */
.atomic-tier-box {
    width: 100%;
    padding: 10px 0;
    border-radius: 6px;
    text-align: center;
    border: 1px solid transparent;
}

.tier-label {
    font-size: 1.6rem; /* Huge Font as requested */
    font-weight: 900;
    line-height: 1;
    letter-spacing: -0.02em;
    font-family: var(--font-mono);
}

/* --- BLOCK 2: VERDICT BOX (The Classification) --- */
.atomic-verdict-box {
    width: 100%;
    padding: 6px 0;
    border-radius: 4px;
    text-align: center;
    border: 1px solid transparent;
}

.verdict-label {
    font-size: 0.85rem; /* Smaller than Tier */
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

/* --- BLOCK 3: ARCHETYPE (The Role) --- */
.atomic-archetype-group {
    margin-top: 10px;
    margin-bottom: 10px;
    text-align: center;
    width: 100%;
}

.subhero-label {
    font-size: 0.6rem;
    font-weight: 700;
    color: #94a3b8; /* Muted Gray */
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 4px;
}

.subhero-val {
    font-size: 0.95rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: -0.01em;
}

/* --- BLOCK 4: VITALS STACK (Rows not Columns) --- */
.atomic-vital-stack {
    display: flex;
    flex-direction: column;
    width: 100%;
    gap: 8px; /* Space between rows */
    margin-top: auto; /* Push to bottom */
    padding-top: 12px;
    border-top: 1px dashed #e2e8f0;
}

.vital-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    line-height: 1.2;
}

.vital-key {
    font-weight: 700; /* Bold like 'NEXT' */
    color: var(--color-text-muted); /* Use the same dark gray base */
    opacity: 0.6; /* Apply the same transparency */
    font-size: 0.65rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.vital-val {
    font-weight: 700;
    color: #64748b; /* Darker gray for values */
    font-family: var(--font-mono);
}

/* --- COLOR THEMES (Backgrounds & Text) --- */

/* Theme Logic: 
   Tier Box = Light BG + Strong Text + Border
   Verdict Box = Very Light BG + Strong Text
*/

/* TIER 0: SAFE (Emerald) */
.tier-theme-0 .atomic-tier-box {
    background-color: #ecfdf5; border-color: #d1fae5; color: #047857;
}
.tier-theme-0 .atomic-verdict-box {
    background-color: #f0fdf4; color: #059669; /* Softer Green */
}

/* TIER 1: NOTE (Blue) */
.tier-theme-1 .atomic-tier-box {
    background-color: #eff6ff; border-color: #dbeafe; color: #1d4ed8;
}
.tier-theme-1 .atomic-verdict-box {
    background-color: #f5f8ff; color: #2563eb;
}

/* TIER 2: ANOMALY (Amber) */
.tier-theme-2 .atomic-tier-box {
    background-color: #fffbeb; border-color: #fef3c7; color: #b45309;
}
.tier-theme-2 .atomic-verdict-box {
    background-color: #fffdf5; color: #d97706;
}

/* TIER 3: SUSPICIOUS (Orange) */
.tier-theme-3 .atomic-tier-box {
    background-color: #fff7ed; border-color: #ffedd5; color: #c2410c;
}
.tier-theme-3 .atomic-verdict-box {
    background-color: #fffaf5; color: #ea580c;
}

/* TIER 4: CRITICAL (Red) */
.tier-theme-4 .atomic-tier-box {
    background-color: #fef2f2; border-color: #fee2e2; color: #b91c1c;
}
.tier-theme-4 .atomic-verdict-box {
    background-color: #fff5f5; color: #dc2626;
}

/* --- ATOMIC STACK VISUALIZER (Pedagogy Engine) --- */

/* The Collapsible Container */
.atomic-stack-details {
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
    font-family: var(--font-sans);
}

.atomic-stack-summary {
    font-size: 0.7rem;
    font-weight: 700;
    color: #64748b;
    padding: 6px 10px;
    cursor: pointer;
    list-style: none; /* Hide default triangle */
    display: flex;
    justify-content: space-between;
    align-items: center;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: #f1f5f9;
}

.atomic-stack-summary:hover {
    color: #3b82f6; /* Blue hover */
    background: #eff6ff;
}

.atomic-stack-summary::-webkit-details-marker { display: none; }
.atomic-stack-summary::after { content: "+"; font-size: 1.1em; font-weight: 400; }
.atomic-stack-details[open] .atomic-stack-summary::after { content: ""; }

/* The Stack Body */
.atomic-stack-body {
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0; /* Arrows handle spacing */
    background: #ffffff;
    border-top: 1px solid #e2e8f0;
}

/* Individual Layers */
.as-layer {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding: 4px;
    border: 1px solid transparent;
    border-radius: 4px;
    transition: background 0.2s;
}

.as-layer:hover {
    background: #f8fafc;
    border-color: #f1f5f9;
}

/* Labels (Physics Type) */
.as-label {
    font-size: 0.55rem;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #94a3b8;
    margin-bottom: 2px;
}

/* Values (The Data) */
.as-value {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    font-weight: 600;
    color: #1e293b;
    text-align: center;
    word-break: break-all;
    line-height: 1.3;
}

/* Special Styles for Layers */
.as-val-glyph { font-size: 1.5rem; line-height: 1; }
.as-val-scalar { color: #475569; }
.as-val-utf16  { color: #d97706; } /* Amber for Runtime */
.as-val-utf8   { color: #2563eb; } /* Blue for Network */

/* The Connector Arrow */
.as-arrow {
    color: #cbd5e1;
    font-size: 0.8rem;
    line-height: 0.8;
    margin: 2px 0;
}
